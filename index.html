<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini Chat ‚Äì okos√≠tott verzi√≥</title>
<style>
  :root{--bg:#0f1216;--card:#151a21;--ink:#e8ecf1;--muted:#a7b0bc;--accent:#7c5cff;}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(135deg,#0d1117,#111926);}
  .center{min-height:100svh;display:grid;place-items:center;padding:16px}
  .card{width:min(980px,100%);background:var(--card);border:1px solid #232b36;border-radius:20px;
        box-shadow:0 10px 30px rgba(0,0,0,.35);color:var(--ink);overflow:hidden}
  .hero{padding:28px 24px;border-bottom:1px solid #232b36;display:flex;gap:16px;align-items:center}
  .badge{padding:4px 10px;border:1px solid #303a47;border-radius:999px;font-size:12px;color:var(--muted)}
  .h1{font-size:22px;margin:4px 0 2px} .muted{color:var(--muted);font-size:14px}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:16px;padding:16px}
  .stack{display:flex;flex-direction:column;gap:10px}
  label{font-size:13px;color:var(--muted)} input{width:100%;padding:12px 14px;border-radius:12px;
        border:1px solid #2a3442;background:#0f141b;color:var(--ink);outline:none}
  input:focus{border-color:#3b4657;box-shadow:0 0 0 3px rgba(124,92,255,.15)}
  .row{display:flex;gap:10px;align-items:center}
  .btn{appearance:none;border:none;padding:12px 16px;border-radius:12px;background:var(--accent);color:white;
       font-weight:600;cursor:pointer}
  .btn.secondary{background:#222b36;color:var(--ink);border:1px solid #313c49}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  /* chat */
  .chat{height:60svh;min-height:380px;max-height:70svh;overflow:auto;padding:16px;display:flex;flex-direction:column;gap:10px;background:#0e1319}
  .bubble{max-width:80%;padding:10px 12px;border-radius:14px;line-height:1.35;font-size:15px;white-space:pre-wrap;word-wrap:break-word}
  .bot{align-self:flex-start;background:#141b23;border:1px solid #2b3542}
  .me{align-self:flex-end;background:#1b2430;border:1px solid #334051}
  .footer{display:flex;gap:8px;padding:12px;border-top:1px solid #232b36;background:#0f141b}
  .brand{font-size:12px;color:#8b95a5}
  .typing{font-size:12px;color:#95a0b5;padding-left:6px}
  .small{font-size:12px;color:#9aa6b6}
  .hidden{display:none}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, monospace; background:#202734; border:1px solid #2f3a4a; padding:2px 6px; border-radius:6px; font-size:12px;}
</style>
</head>
<body>
<div class="center">
  <!-- √úDV K√âPERNY≈ê -->
  <div class="card" id="screen-welcome">
    <div class="hero">
      <div class="badge">Mini Chat</div>
      <div>
        <div class="h1">Az oldalt l√©trehozta: <strong>H.T</strong> ‚Äî Kellemes besz√©lget√©st! üéâ</div>
        <div class="muted">Add meg a beceneved (opcion√°lis), azt√°n katt a Kezd√©sre √©s m√°r indul is a chat.</div>
      </div>
    </div>
    <div class="grid">
      <div class="stack">
        <label for="nickname">Becen√©v (opcion√°lis)</label>
        <input id="nickname" placeholder="pl. Zsanett" />
        <div class="row">
          <button class="btn" id="startBtn">Kezd√©s</button>
          <button class="btn secondary" id="skipBtn">N√©v n√©lk√ºl</button>
        </div>
        <div class="small">
          Tipp: a besz√©lget√©st √©s a nevet <strong>helyben</strong> elmentj√ºk (localStorage), hogy √∫jranyit√°skor is megmaradjon.
        </div>
      </div>
      <div class="stack">
        <div class="brand">Mit tud ez a verzi√≥?</div>
        <div class="small">
          ‚Ä¢ K√∂sz√∂n, small talk, id≈ë/d√°tum ‚Ä¢ Egyszer≈± sz√°mol√°s <span class="kbd">calc 3*(4+5)</span><br>
          ‚Ä¢ <strong>Unit-konverzi√≥k</strong> (cm‚Üîm, kg‚Üîg, ¬∞C‚Üî¬∞F) ‚Ä¢ <strong>To-Do</strong> lista (<span class="kbd">/todo add</span>, <span class="kbd">/todo list</span>, <span class="kbd">/todo done 1</span>)<br>
          ‚Ä¢ <strong>Kis tud√°sb√°zis</strong> + ‚Äûokos‚Äù keres√©s ‚Ä¢ √ârme/dob√≥kocka ‚Ä¢ Id√©zet, motiv√°ci√≥<br>
          ‚Ä¢ Alap <strong>hangulatfelismer√©s</strong> ‚Üí empatikus v√°lasz<br>
          ‚Ä¢ (El≈ëk√©sz√≠tve: saj√°t LLM-proxy k√©s≈ëbbre)
        </div>
      </div>
    </div>
  </div>

  <!-- CHAT -->
  <div class="card hidden" id="screen-chat">
    <div class="hero">
      <div class="badge" id="brand-badge">Az oldalt l√©trehozta: H.T ‚Äî Kellemes besz√©lget√©st!</div>
      <div>
        <div class="h1">Mini Chat</div>
        <div class="muted">√çrj √ºzenetet, √©s v√°laszolok. üòä <span class="typing" id="typing"></span></div>
      </div>
    </div>
    <div class="chat" id="chat"></div>
    <div class="footer">
      <input id="input" placeholder="√çrj ide... (Enter = k√ºld√©s) ‚Äî /help a parancsokhoz" />
      <button class="btn" id="sendBtn">K√ºld√©s</button>
    </div>
  </div>
</div>

<script>
/* =================== √ÅLLAPOT + MEM√ìRIA =================== */
const LS_KEY = "mini_chat_state_v3";
const state = { name: null, history: [], todos: [] };
function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
function loadState(){
  try{
    const obj = JSON.parse(localStorage.getItem(LS_KEY) || "{}");
    state.name = obj?.name || null;
    state.history = Array.isArray(obj?.history) ? obj.history.slice(-300) : [];
    state.todos = Array.isArray(obj?.todos) ? obj.todos.slice(0,200) : [];
  }catch(_){}
}
loadState();

/* =================== KIS TUD√ÅSB√ÅZIS + HASONL√ìS√ÅG =================== */
const KB = [
  {q:"mi az a gpt", a:"Egy nagy nyelvi modell (LLM), ami sz√∂veget √©rtelmez √©s gener√°l."},
  {q:"hogyan sz√°moljak t√∂rtet", a:"√ñsszead√°s: a/b + c/d = (ad+bc)/bd. Szorz√°s: (a/b)*(c/d) = ac/bd. Oszt√°s: (a/b)/(c/d) = ad/bc."},
  {q:"mi a pubg", a:"A PUBG egy battle royale j√°t√©k: sok j√°t√©kos egy szigeten, utols√≥k√©nt talpon maradni a c√©l."},
  {q:"mi a gta v", a:"A GTA V a Rockstar Games ny√≠lt vil√°g√∫ akci√≥j√°t√©ka, hatalmas elad√°sokkal √©s n√©pszer≈± GTA Online m√≥ddal."},
  {q:"mi az a rag", a:"Retrieval-Augmented Generation: k√ºls≈ë tud√°s visszakeres√©se + generat√≠v v√°lasz."},
  {q:"mi az ai", a:"Mesters√©ges intelligencia: olyan rendszerek, amelyek tipikusan emberi √©rtelmet ig√©nyl≈ë feladatokat oldanak meg."},
];
function tokenize(s){
  return s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")
          .replace(/[^a-z0-9√°√©√≠√≥√∂≈ë√∫√º≈±\s]/gi," ")
          .split(/\s+/).filter(Boolean);
}
function jaccard(a,b){
  const A = new Set(a), B = new Set(b);
  let inter = 0; for(const x of A) if(B.has(x)) inter++;
  return inter / (A.size + B.size - inter + 1e-9);
}
function kbSearch(query){
  const qTok = tokenize(query);
  if(!qTok.length) return null;
  let best = null, bestScore = 0;
  for(const item of KB){
    const score = jaccard(qTok, tokenize(item.q));
    if(score > bestScore){ bestScore = score; best = item; }
  }
  return (bestScore >= 0.22) ? best : null;
}

/* =================== MINI ESZK√ñZ√ñK / PARANCSOK =================== */
const rnd = (...a)=>a[Math.floor(Math.random()*a.length)];
function nowText(){
  const d = new Date(), pad = n=>String(n).padStart(2,'0');
  return `Most ${d.getFullYear()}.${pad(d.getMonth()+1)}.${pad(d.getDate())}. ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())} van.`;
}
function setNameFromText(t){
  let m = t.match(/(?:h√≠vj\s+([^,!.?:;]+?)\s*-?nek|a\s+nevem\s+([^,!.?:;]+))/i)
        || t.match(/(?:call\s+me\s+([^,!.?:;]+)|my\s+name\s+is\s+([^,!.?:;]+))/i);
  if(m){
    const name = (m[1]||m[2]||"").trim();
    if(name){ state.name = name; saveState(); return name; }
  }
  return null;
}
function safeCalc(t){
  const m = t.match(/(?:^|\b)(?:calc|sz√°mold\s+ki|=)?\s*([0-9+\-*/().\s]+)$/i);
  if(!m) return null;
  const expr = m[1].trim();
  if(!/^[0-9+\-*/().\s]+$/.test(expr)) return "Csak sz√°mok √©s + - * / ( ) enged√©lyezett.";
  try{
    const val = Function(`"use strict"; return (${expr})`)();
    if(typeof val !== "number" || !isFinite(val)) throw 0;
    return `${expr} = ${val}`;
  }catch(e){
    return "Nem tudtam kisz√°molni. Pr√≥b√°ld: calc (2+3*4)/5";
  }
}
/* Unit konverzi√≥k: cm<->m, kg<->g, C<->F */
function convertUnits(t){
  let m;
  m = t.match(/\b(\d+(?:[.,]\d+)?)\s*cm\b\s*(?:in|->)\s*m\b/i);
  if(m){ const v=parseFloat(m[1].replace(",","."));
         return `${v} cm = ${v/100} m`; }
  m = t.match(/\b(\d+(?:[.,]\d+)?)\s*m\b\s*(?:in|->)\s*cm\b/i);
  if(m){ const v=parseFloat(m[1].replace(",","."));
         return `${v} m = ${v*100} cm`; }
  m = t.match(/\b(\d+(?:[.,]\d+)?)\s*kg\b\s*(?:in|->)\s*g\b/i);
  if(m){ const v=parseFloat(m[1].replace(",","."));
         return `${v} kg = ${v*1000} g`; }
  m = t.match(/\b(\d+(?:[.,]\d+)?)\s*g\b\s*(?:in|->)\s*kg\b/i);
  if(m){ const v=parseFloat(m[1].replace(",","."));
         return `${v} g = ${v/1000} kg`; }
  m = t.match(/\b(\-?\d+(?:[.,]\d+)?)\s*([cC])\b\s*(?:in|->)\s*[fF]\b/);
  if(m){ const v=parseFloat(m[1].replace(",","."));
         return `${v} ¬∞C = ${v*9/5+32} ¬∞F`; }
  m = t.match(/\b(\-?\d+(?:[.,]\d+)?)\s*[fF]\b\s*(?:in|->)\s*[cC]\b/);
  if(m){ const v=parseFloat(m[1].replace(",","."));
         return `${v} ¬∞F = ${(v-32)*5/9} ¬∞C`; }
  return null;
}
/* To-Do: /todo add sz√∂veg | /todo list | /todo done 2 */
function todoCommand(t){
  if(/^\/todo\s+add\s+/.test(t)){
    const txt = t.replace(/^\/todo\s+add\s+/,"").trim();
    if(!txt) return "√çrj valamit: /todo add bev√°s√°rl√°s";
    state.todos.push({text:txt, done:false}); saveState();
    return `Hozz√°adva: ‚Äú${txt}‚Äù`;
  }
  if(/^\/todo\s+list\b/.test(t)){
    if(!state.todos.length) return "√úres a lista. Adj hozz√° √≠gy: /todo add valami";
    const lines = state.todos.map((it,i)=>`${i+1}. [${it.done?"x":" "}] ${it.text}`);
    return "Teend≈ëk:\n"+lines.join("\n");
  }
  if(/^\/todo\s+done\s+\d+/.test(t)){
    const n = parseInt(t.match(/done\s+(\d+)/)[1],10);
    if(!state.todos[n-1]) return "Nincs ilyen sorsz√°m.";
    state.todos[n-1].done = true; saveState();
    return `K√©sznek jel√∂lve: ${n}.`;
  }
  return null;
}
/* Hangulat (nagyon alap kulcsszavas) */
function sentimentReply(t){
  const s = t.toLowerCase();
  if(/(szomor|rossz kedv|depi|sz*r nap)/.test(s)){
    return rnd("Sajn√°lom, hogy √≠gy √©rzed. Itt vagyok veled. ‚ù§Ô∏è",
               "K√ºld√∂k egy virtu√°lis √∂lel√©st. Ha ki√≠rod, k√∂nnyebb lesz. ü§ó");
  }
  if(/(boldog|√∂r√ºl|j√≥ kedv|kir√°ly)/.test(s)){
    return rnd("De j√≥ ezt hallani! üéâ", "Szuper! üòÑ Mes√©lj m√©g!");
  }
  return null;
}
/* Egyebek */
function coin(t){ if(/\b(√©rme|coin|fej|√≠r√°s)/i.test(t)) return rnd("Fej!","√çr√°s!"); return null; }
function dice(t){ if(/\b(kocka|dice|dobj)/i.test(t)) return "Dob√°s: "+(1+Math.floor(Math.random()*6)); return null; }
function quote(t){
  if(/\b(idezet|id√©zet|quote|motiv)/i.test(t)){
    return rnd(
      "‚ÄûA kitart√°s hossz√∫ fut√°s; sok r√∂vid fut√°s egym√°s ut√°n.‚Äù ‚Äì W. Eliot",
      "‚ÄûA holnapot ma √©p√≠ted.‚Äù",
      "‚ÄûA kudarc csak visszajelz√©s, nem v√©g√°llom√°s.‚Äù"
    );
  }
  return null;
}

/* =================== Opcion√°lis LLM csatlakoz√≥ (proxyval) =================== */
const LLM_CONFIG = { enabled:false, endpoint:"", apiKey:"", model:"" };
async function callLLM(messages){ if(!LLM_CONFIG.enabled) return null; try{
  const res = await fetch(LLM_CONFIG.endpoint, {
    method:"POST",
    headers:{ "Content-Type":"application/json",
      ...(LLM_CONFIG.apiKey?{"Authorization":"Bearer "+LLM_CONFIG.apiKey}:{}) },
    body: JSON.stringify({ model: LLM_CONFIG.model, messages, temperature:0.7 })
  });
  if(!res.ok) throw 0;
  const data = await res.json();
  return data.reply || data.choices?.[0]?.message?.content || null;
}catch(_){ return null; }}

/* =================== V√ÅLASZGENER√ÅL√ÅS (pipeline) =================== */
function ruleBasedRespond(t){
  // n√©v
  if(setNameFromText(t)){
    return rnd(`Ok√©, ${state.name}! Megjegyeztem.`,`Rendben, √≠gy sz√≥l√≠talak: ${state.name}.`);
  }
  // k√∂sz√∂n√©s
  if(/^(szia|hell[o√≥]|hali|cs[≈ëo])/i.test(t)){
    return state.name ? rnd(`Szia, ${state.name}!`,`Na szeva, ${state.name}!`) : rnd("Szia!","Hell√≥!","Cs≈ë!");
  }
  // hogy vagy
  if(/hogy\s+vagy|how\s+are\s+you/i.test(t)){
    return state.name ? rnd(`J√≥l vagyok, ${state.name}! Te?`,`Szuper√ºl, ${state.name}. Miben seg√≠tsek?`)
                      : rnd("Megvagyok, k√∂szi! Te?","Kir√°lyul! Mizu?");
  }
  // id≈ë/d√°tum
  if(/mennyi\s+az\s+id[≈ëo]|h[√°a]ny\s+√≥ra|d[√°a]tum|^id≈ë$|^time$/i.test(t)) return nowText();
  // parancsok
  if(/^\/help\b/i.test(t)){
    return [
      "Parancsok:",
      "‚Ä¢ /help ‚Äî ez a lista",
      "‚Ä¢ /clear ‚Äî el≈ëzm√©nyek t√∂rl√©se",
      "‚Ä¢ /todo add SZ√ñVEG | /todo list | /todo done N",
      "‚Ä¢ Sz√°mol√°s: calc 3*(4+5)  ‚Äî csak + - * / ( )",
      "‚Ä¢ Konverzi√≥k: 180 cm -> m, 2.5 m -> cm, 5 kg -> g, 500 g -> kg, 20 C -> F, 68 F -> C",
      "‚Ä¢ √ârme: fej vagy √≠r√°s | Kocka: dobj/kocka/dice",
      "‚Ä¢ Id√©zet/motiv√°ci√≥: ‚Äûid√©zet‚Äù, ‚Äûmotiv√°ci√≥‚Äù",
      "‚Ä¢ Becs. be√°ll√≠t√°s: ‚ÄûH√≠vj XY-nek‚Äù / ‚ÄûA nevem XY‚Äù"
    ].join("\n");
  }
  if(/^\/clear\b/i.test(t)){ state.history=[]; saveState(); return "T√∂r√∂ltem a helyi el≈ëzm√©nyeket."; }
  // to-do
  const td = todoCommand(t); if(td) return td;
  // kalkul√°tor
  const c = safeCalc(t); if(c) return c;
  // konverzi√≥
  const conv = convertUnits(t); if(conv) return conv;
  // √©rme/kocka/id√©zet
  const coinAns = coin(t); if(coinAns) return coinAns;
  const diceAns = dice(t); if(diceAns) return diceAns;
  const quoteAns = quote(t); if(quoteAns) return quoteAns;
  // hangulat
  const mood = sentimentReply(t); if(mood) return mood;
  return null;
}

async function smartRespond(text){
  // 1) szab√°lyok/parancsok
  const rule = ruleBasedRespond(text);
  if(rule) return rule;

  // 2) kis tud√°sb√°zis (RAG-light)
  const kb = kbSearch(text);
  if(kb) return kb.a;

  // 3) opcion√°lis LLM (ha k√©s≈ëbb bek√∂t√∂d proxyval)
  const messages = [
    {role:"system", content:"Magyarul, r√∂viden √©s bar√°ts√°gosan v√°laszolj. Ha nem tudod, mondd meg ≈ëszint√©n."},
    ...state.history.slice(-8).map(x => ({role: x.who==="me" ? "user":"assistant", content: x.text})),
    {role:"user", content:text}
  ];
  const llm = await callLLM(messages);
  if(llm) return llm;

  // 4) fallback
  return rnd(
    "Ezt m√©g tanulom. Mondd m√°sk√©pp, k√©rlek!",
    "Nem vagyok biztos benne. Tudsz p√©ld√°t √≠rni?",
    "Hmm‚Ä¶ ez neh√©z. Pr√≥b√°ld r√∂videbben!"
  );
}

/* =================== UI =================== */
const $ = sel => document.querySelector(sel);
const chatEl = $("#chat"), inputEl = $("#input"), typingEl = $("#typing");

function addBubble(text, who="bot"){
  const div = document.createElement("div");
  div.className = `bubble ${who==="me"?"me":"bot"}`;
  div.textContent = text;
  chatEl.appendChild(div);
  chatEl.scrollTop = chatEl.scrollHeight;
  state.history.push({who, text});
  saveState();
}
function botReplyLater(text, delay=400){
  typingEl.textContent = "‚Ä¶gondolkodom";
  setTimeout(()=>{ addBubble(text,"bot"); typingEl.textContent = ""; }, delay);
}
async function send(){
  const v = inputEl.value.trim();
  if(!v) return;
  addBubble(v,"me");
  inputEl.value = "";
  const r = await smartRespond(v);
  botReplyLater(r, 250 + Math.min(1200, v.length*15));
}
$("#sendBtn").addEventListener("click", send);
inputEl.addEventListener("keydown", e=>{ if(e.key === "Enter"){ send(); }});

/* k√©perny≈ë v√°lt√°s + el≈ëzm√©nyek visszat√∂lt√©se */
function restoreHistory(){
  $("#brand-badge").textContent = "Az oldalt l√©trehozta: H.T ‚Äî Kellemes besz√©lget√©st!";
  chatEl.innerHTML = "";
  for(const msg of state.history){ addBubble(msg.text, msg.who); }
}
$("#startBtn").addEventListener("click", ()=>{
  const nick = $("#nickname").value.trim();
  if(nick){ state.name = nick; saveState(); }
  $("#screen-welcome").classList.add("hidden");
  $("#screen-chat").classList.remove("hidden");
  if(state.history.length===0){
    addBubble(rnd(
      state.name?`Szia, ${state.name}! Kezdhetj√ºk. üòä`:"Szia! Kezdhetj√ºk. üòä",
      "Hell√≥! Miben seg√≠thetek?",
      "Cs≈ë! √çrj egy √ºzenetet."
    ));
    if(state.name){ addBubble(`Megjegyeztem a neved: ${state.name}.`); }
  }else{
    restoreHistory();
  }
});
$("#skipBtn").addEventListener("click", ()=>{
  $("#screen-welcome").classList.add("hidden");
  $("#screen-chat").classList.remove("hidden");
  if(state.history.length===0){
    addBubble("Szia! Kezdhetj√ºk. üòä");
  }else{
    restoreHistory();
  }
});
</script>
</body>
</html>

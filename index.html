<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>J√°t√©kok gy≈±jtem√©ny</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{--txt:#e9eefc;--muted:#9db0d4;--border:rgba(255,255,255,.16);
--glass:rgba(15,24,45,.72);--btn1:#2e5fff;--btn2:#1b47d8;--good:#57d79e;--bad:#ff6b6b}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,sans-serif;color:var(--txt);background:#070b14;overflow:hidden;height:100vh}
.bg{position:fixed;inset:-10% -10%;z-index:-1;filter:blur(40px);
 background:radial-gradient(40% 35% at 15% 20%,#2e5fff66,transparent 65%),
           radial-gradient(45% 35% at 85% 80%,#57d79e66,transparent 70%),
           radial-gradient(70% 60% at 50% 50%,#8a2eff33,transparent 70%),#090f1c;
 animation:bgMove 16s ease-in-out infinite alternate}
@keyframes bgMove{0%{transform:scale(1)}100%{transform:scale(1.1) translate(2%,2%)}}
.hide{display:none!important}
.center{display:flex;align-items:center;justify-content:center;height:100%}

/* auth */
.overlay{position:fixed;inset:0;display:grid;place-items:center;z-index:9999;
 background:#0008;backdrop-filter:blur(8px)}
.card{width:min(95vw,400px);padding:20px;border-radius:20px;background:var(--glass);
 border:1px solid var(--border)}
.tabs{display:flex;gap:8px;margin:12px 0}
.tabs button{flex:1;padding:10px;border-radius:12px;border:0;background:#0f2142;color:var(--muted);cursor:pointer}
.tabs .active{background:var(--btn1);color:#fff}
.form label{font-size:13px;color:var(--muted);display:block;margin:6px 2px}
.form input{width:100%;padding:10px;border-radius:12px;border:1px solid var(--border);background:#0f2142;color:var(--txt)}
.btn{padding:10px 14px;border-radius:12px;border:0;cursor:pointer;
 background:linear-gradient(180deg,var(--btn1),var(--btn2));color:#fff;font-weight:700}
.btn.secondary{background:#0f2142;color:var(--txt);border:1px solid var(--border)}
.note{font-size:13px}
.ok{color:var(--good)}.err{color:var(--bad)}
</style>
</head>
<body>
<div class="bg"></div>

<!-- LOGIN -->
<div id="auth" class="overlay">
 <div class="card">
   <h3>Bel√©p√©s / Regisztr√°ci√≥</h3>
   <div class="tabs">
     <button id="tabL" class="active">Bel√©p√©s</button>
     <button id="tabR">Regisztr√°ci√≥</button>
   </div>
   <form id="formL" class="form">
     <label>Email</label><input name="email" type="email" required>
     <label>Jelsz√≥</label><input name="password" type="password" required minlength="6">
     <div id="msgL" class="note"></div>
     <button class="btn" type="submit">Bel√©p√©s</button>
   </form>
   <form id="formR" class="form hide">
     <label>N√©v</label><input name="name" required>
     <label>Email</label><input name="email" type="email" required>
     <label>Jelsz√≥</label><input name="password" type="password" required minlength="6">
     <div id="msgR" class="note"></div>
     <button class="btn" type="submit">Regisztr√°ci√≥</button>
   </form>
 </div>
</div>
<!-- WELCOME + LOGOUT -->
<div id="welcome" class="hide" style="position:fixed;top:10px;left:10px;background:#0f2142;padding:6px 12px;border-radius:12px;display:flex;gap:10px;align-items:center;z-index:1000">
 <span id="who"></span>
 <button id="logout" class="btn secondary">Kijelentkez√©s</button>
</div>

<!-- J√ÅT√âKOK MEN√ú -->
<section id="screen-menu" class="screen active" style="padding:80px 20px">
  <h2 style="margin:0 0 14px;font-size:28px">üéÆ J√°t√©kok men√º</h2>
  <p class="muted">V√°lassz egy j√°t√©kot! A j√°t√©k k√ºl√∂n k√©perny≈ën ny√≠lik meg.</p>
  <div style="display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))">
    <div class="card"><h3>üß† Mem√≥ria</h3><p class="muted">120 lap, neh√©z m√≥d.</p><button class="btn" onclick="openScreen('screen-memory')">Megnyit√°s</button></div>
    <div class="card"><h3>üêç K√≠gy√≥</h3><p class="muted">Sebess√©g √°ll√≠that√≥.</p><button class="btn" onclick="openScreen('screen-snake');snakeStart()">Megnyit√°s</button></div>
    <div class="card"><h3>‚úäüñê‚úå K≈ë‚ÄìPap√≠r‚ÄìOll√≥</h3><p class="muted">Hagyom√°nyos √©s modern -1 m√≥d.</p><button class="btn" onclick="openScreen('screen-rps')">Megnyit√°s</button></div>
    <div class="card"><h3>‚ö° Reflex</h3><p class="muted">Reakci√≥id≈ë teszt 5 k√∂rben.</p><button class="btn" onclick="openScreen('screen-reflex')">Megnyit√°s</button></div>
    <div class="card"><h3>üçÑ Saj√°t Ugr√°l√≥s</h3><p class="muted">T√∂lts fel k√©pet a f≈ëh≈ësh√∂z √©s az ellens√©ghez!</p><button class="btn" onclick="openScreen('screen-mario');marioStart()">Megnyit√°s</button></div>
  </div>
</section>

<!-- MEM√ìRIA K√âPERNY≈ê -->
<section id="screen-memory" class="screen hide" style="padding:80px 20px">
 <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
 <h3>üß† Mem√≥ria (120 lap)</h3>
 <button class="btn" onclick="startMemory()">√öjrakezd√©s</button>
 <div id="memory-grid" style="display:grid;gap:6px;margin-top:12px"></div>
 <p id="memory-status" class="muted"></p>
</section>

<!-- K√çGY√ì K√âPERNY≈ê -->
<section id="screen-snake" class="screen hide" style="padding:80px 20px">
 <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
 <h3>üêç K√≠gy√≥</h3>
 <div style="margin:10px 0">
   <button class="btn" onclick="snakeStart()">Start / Reset</button>
   <button class="btn secondary" onclick="setSnakePreset(4)">Lass√∫</button>
   <button class="btn secondary" onclick="setSnakePreset(8)">K√∂zepes</button>
   <button class="btn secondary" onclick="setSnakePreset(12)">Gyors</button>
   <input id="sn-speed" type="range" min="3" max="15" value="8" step="1" oninput="setSnakeSpeed(this.value)">
 </div>
 <canvas id="snake" width="800" height="480" style="background:#0c162b;border:1px solid var(--border);border-radius:10px;max-width:100%"></canvas>
 <div class="hud">
   <div>Pont: <b id="sn-score">0</b></div>
   <div>Rekord: <b id="sn-best">0</b></div>
   <div>Sebess√©g: <b id="sn-speed-label">8</b> fps</div>
 </div>
</section>

<!-- K≈ê-PAP√çR-OLL√ì K√âPERNY≈ê -->
<section id="screen-rps" class="screen hide" style="padding:80px 20px">
 <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
 <h3>‚úäüñê‚úå K≈ë‚ÄìPap√≠r‚ÄìOll√≥</h3>
 <div class="mode-tabs" style="margin:10px 0">
   <button id="rps-mode-classic" class="active">Hagyom√°nyos</button>
   <button id="rps-mode-modern">Modern (-1 vesztes)</button>
 </div>
 <div style="display:flex;gap:8px;flex-wrap:wrap">
   <button class="rps-btn" onclick="rpsChoose('rock')">‚úä K≈ë</button>
   <button class="rps-btn" onclick="rpsChoose('paper')">üñê Pap√≠r</button>
   <button class="rps-btn" onclick="rpsChoose('scissors')">‚úå Oll√≥</button>
 </div>
 <div class="hud">
   <div>Te: <b id="rps-you">0</b></div>
   <div>G√©p: <b id="rps-bot">0</b></div>
   <div>M√≥d: <b id="rps-mode-label">Hagyom√°nyos</b></div>
 </div>
 <div id="rps-last" class="muted"></div>
</section>

<!-- REFLEX K√âPERNY≈ê -->
<section id="screen-reflex" class="screen hide" style="padding:80px 20px">
 <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
 <h3>‚ö° Reflex j√°t√©k</h3>
 <button class="btn" onclick="refStart()">Ind√≠t√°s</button>
 <div id="refbox" style="margin-top:10px;height:200px;display:grid;place-items:center;border:1px dashed var(--border);border-radius:12px;background:#0f2142;color:#fff">Kattints az Ind√≠t√°sra!</div>
 <div class="hud">
   <div>K√∂r: <b id="ref-round">0</b>/5</div>
   <div>Utols√≥: <b id="ref-last">‚Äì</b> ms</div>
   <div>√Åtlag: <b id="ref-avg">‚Äì</b> ms</div>
   <div>Top: <b id="ref-best">‚Äì</b> ms</div>
 </div>
</section>

<!-- MARIO K√âPERNY≈ê -->
<section id="screen-mario" class="screen hide" style="padding:80px 20px">
 <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
 <h3>üçÑ Saj√°t Ugr√°l√≥s</h3>
 <div style="margin:10px 0;display:flex;gap:10px;flex-wrap:wrap">
   <label class="btn secondary">J√°t√©kos k√©p<input id="player-file" type="file" accept="image/*" style="display:none"></label>
   <label class="btn secondary">Ellens√©g k√©p<input id="enemy-file" type="file" accept="image/*" style="display:none"></label>
   <button class="btn" onclick="marioStart()">Start / Reset</button>
   <button class="btn secondary" onclick="marioClearImages()">Alap k√©pek</button>
 </div>
 <canvas id="mario" width="1000" height="360" style="background:#0c162b;border:1px solid var(--border);border-radius:10px;max-width:100%"></canvas>
 <div class="hud">
   <div>Pont: <b id="mario-score">0</b></div>
   <div>Rekord: <b id="mario-best">0</b></div>
 </div>
</section>
<script>
/* ---------- K√∂z√∂s: k√©perny≈ëv√°lt√°s (anim√°lt) ---------- */
function openScreen(id){
  // minden screen elrejt√©se
  document.querySelectorAll('.screen').forEach(s=>{
    s.classList.add('hide');
    s.classList.remove('active');
  });
  // c√©l k√©perny≈ë megnyit√°sa
  const el = document.getElementById(id);
  el.classList.remove('hide');
  // kis k√©sleltet√©ssel aktiv√°ljuk, hogy legyen √°tmenet
  requestAnimationFrame(()=> el.classList.add('active'));
  // felg√∂rget√©s
  window.scrollTo({top:0, behavior:'smooth'});
}
</script>

<script>
/* ---------- Bel√©p√©s/Regisztr√°ci√≥ (LocalStorage + s√≥zott SHA-256) ---------- */
(()=>{"use strict";
  const $=s=>document.querySelector(s);
  const auth=$("#auth"), tabL=$("#tabL"), tabR=$("#tabR"), formL=$("#formL"), formR=$("#formR"), msgL=$("#msgL"), msgR=$("#msgR");
  const welcome=$("#welcome"), who=$("#who"), logout=$("#logout");
  const K_USERS="au_users_v1", K_ME="au_me_v1";
  const load=(k,def)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? def }catch{ return def } };
  const save=(k,v)=> localStorage.setItem(k, JSON.stringify(v));

  function afterLogin(){
    auth.style.display="none";
    welcome.classList.remove("hide");
    const me=load(K_ME,null);
    if(me) who.textContent = `${me.name||'Felhaszn√°l√≥'} (${me.email})`;
    openScreen('screen-menu');
  }

  async function sha256(str){
    const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
    return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
  }
  function salt(len=16){ const a=new Uint8Array(len); crypto.getRandomValues(a); return Array.from(a).map(b=>b.toString(16).padStart(2,"0")).join(""); }

  function setTab(which){
    if(which==="L"){ tabL.classList.add("active"); tabR.classList.remove("active"); formL.classList.remove("hide"); formR.classList.add("hide"); msgL.textContent=""; msgR.textContent=""; }
    else { tabR.classList.add("active"); tabL.classList.remove("active"); formR.classList.remove("hide"); formL.classList.add("hide"); msgL.textContent=""; msgR.textContent=""; }
  }
  tabL.onclick=()=>setTab("L");
  tabR.onclick=()=>setTab("R");

  formR.addEventListener("submit", async (e)=>{
    e.preventDefault();
    const name=formR.name.value.trim(), email=formR.email.value.trim().toLowerCase(), pw=formR.password.value;
    if(!name||!email||pw.length<6){ msgR.textContent="T√∂lts ki minden mez≈ët (min. 6 karakter jelsz√≥)."; msgR.className="note err"; return; }
    const users=load(K_USERS,{});
    if(users[email]){ msgR.textContent="Ezzel az e-maillel m√°r van fi√≥k."; msgR.className="note err"; return; }
    const s=salt(), h=await sha256(pw+s);
    users[email]={name,email,salt:s,hash:h,createdAt:new Date().toISOString()};
    save(K_USERS, users);
    save(K_ME, {name,email,loginAt:new Date().toISOString()});
    afterLogin();
  });

  formL.addEventListener("submit", async (e)=>{
    e.preventDefault();
    const email=formL.email.value.trim().toLowerCase(), pw=formL.password.value;
    const users=load(K_USERS,{});
    const u=users[email];
    if(!u){ msgL.textContent="Nincs ilyen felhaszn√°l√≥."; msgL.className="note err"; return; }
    const h=await sha256(pw+u.salt);
    if(h!==u.hash){ msgL.textContent="Hib√°s jelsz√≥."; msgL.className="note err"; return; }
    save(K_ME, {name:u.name, email:u.email, loginAt:new Date().toISOString()});
    afterLogin();
  });

  logout.onclick=()=>{ localStorage.removeItem(K_ME); location.reload(); };

  // Auto-login
  if(localStorage.getItem(K_ME)){ afterLogin(); }
})();
</script>

<script>
/* ---------- Mem√≥ria (60 p√°r = 120 lap) ---------- */
let memFirst=null, memLock=false, memPairs=0;
function startMemory(){
  const grid=document.getElementById("memory-grid");
  grid.innerHTML=""; document.getElementById("memory-status").textContent="";
  memFirst=null; memLock=false; memPairs=0;

  // r√°cs ‚Äì sok oszlop, hogy kevesebbet kelljen g√∂rgetni
  const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
  const cols = vw>=1200?15:vw>=900?12:vw>=700?10:8;
  grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

  const base=["üî•","‚ùÑÔ∏è","üåô","üåç","‚≠ê","üçÄ","‚ö°","üíé","üéµ","üé≤","üß©","üéØ","üöÄ","üåà","üçé","üçå","üçì","ü•ù","ü••","üåπ","üåª","üçÑ","üåµ","üêç","üê¢","ü¶ä","ü¶Å","üê∏","ü¶ë","üê¨","ü¶â","ü¶Ñ","üêâ","üëë","‚öîÔ∏è","üõ°Ô∏è","üèπ","üïπÔ∏è","üé®","üìö","üß≠","üîÆ","üí°","üß®","üéÅ","üéÜ","üèÜ","üìÄ","üì∑","üé¨","üé§","üéπ","ü•Å","üéª","üõ∏","üè∞","üß±","üö¶","üóø"];
  const symbols=[]; for(let i=0;i<60;i++) symbols.push(base[i%base.length]);
  let cards=[...symbols,...symbols]; cards.sort(()=>Math.random()-0.5);

  cards.forEach(sym=>{
    const div=document.createElement("div");
    div.className="mcard"; div.dataset.sym=sym;
    div.onclick=()=>memFlip(div);
    grid.appendChild(div);
  });
}
function memFlip(card){
  if(memLock||card.classList.contains("revealed")||card.classList.contains("matched")) return;
  card.classList.add("revealed"); card.textContent=card.dataset.sym;
  if(!memFirst){ memFirst=card; }
  else{
    if(memFirst.dataset.sym===card.dataset.sym){
      memFirst.classList.add("matched"); card.classList.add("matched"); memPairs++;
      if(memPairs===60) document.getElementById("memory-status").textContent="üéâ Nyert√©l! Minden p√°r megvan!";
      memFirst=null;
    }else{
      memLock=true;
      setTimeout(()=>{
        card.classList.remove("revealed"); card.textContent="";
        memFirst.classList.remove("revealed"); memFirst.textContent="";
        memFirst=null; memLock=false;
      },650);
    }
  }
}
// amikor megnyitod a k√©perny≈ët, automatikus init
document.getElementById('screen-memory').addEventListener('transitionend', e=>{
  if(e.target.id==='screen-memory' && e.target.classList.contains('active')) startMemory();
});
</script>

<script>
/* ---------- K√≠gy√≥ (√°ll√≠that√≥ sebess√©g) ---------- */
let snCtx, snGrid=20, snX, snY, snVX, snVY, snTrail, snTail, snAppleX, snAppleY, snScore=0, snLoop, snSpeed=8, lastT=0, accT=0;
function setSnakeSpeed(val){ snSpeed=+val; document.getElementById('sn-speed-label').textContent=snSpeed; }
function setSnakePreset(v){ document.getElementById('sn-speed').value=v; setSnakeSpeed(v); }
function snakeStart(){
  const c=document.getElementById("snake"); snCtx=c.getContext("2d");
  snX=10; snY=10; snVX=1; snVY=0; snTrail=[]; snTail=5; snScore=0; lastT=performance.now(); accT=0;
  spawnApple(); updateHud();
  if(snLoop) cancelAnimationFrame(snLoop);
  snLoop=requestAnimationFrame(snakeLoop);
}
function spawnApple(){
  const c=document.getElementById("snake");
  snAppleX=Math.floor(Math.random()*(c.width/snGrid));
  snAppleY=Math.floor(Math.random()*(c.height/snGrid));
}
function updateHud(){
  document.getElementById("sn-score").textContent=snScore;
  const best=+localStorage.getItem("sn_best")||0;
  if(snScore>best){ localStorage.setItem("sn_best", snScore); }
  document.getElementById("sn-best").textContent=+localStorage.getItem("sn_best")||0;
}
function snakeLoop(ts){
  const c=document.getElementById("snake");
  const stepMs = 1000/snSpeed;
  accT += (ts - lastT); lastT = ts;

  while(accT >= stepMs){
    snX+=snVX; snY+=snVY;
    const maxX=Math.floor(c.width/snGrid), maxY=Math.floor(c.height/snGrid);
    if(snX<0) snX=maxX-1; if(snX>=maxX) snX=0; if(snY<0) snY=maxY-1; if(snY>=maxY) snY=0;

    for(let i=0;i<snTrail.length;i++){
      if(snTrail[i].x===snX && snTrail[i].y===snY){ snTail=5; snScore=0; break; }
    }
    snTrail.push({x:snX,y:snY});
    while(snTrail.length>snTail) snTrail.shift();

    if(snAppleX===snX && snAppleY===snY){ snTail++; snScore++; updateHud(); spawnApple(); }

    accT -= stepMs;
  }

  // draw
  snCtx.fillStyle="#0c162b"; snCtx.fillRect(0,0,c.width,c.height);
  snCtx.fillStyle="#57d79e"; snCtx.fillRect(snAppleX*snGrid, snAppleY*snGrid, snGrid-2, snGrid-2);
  snCtx.fillStyle="#6ea8ff"; for(const p of snTrail){ snCtx.fillRect(p.x*snGrid, p.y*snGrid, snGrid-2, snGrid-2); }

  snLoop=requestAnimationFrame(snakeLoop);
}
// ir√°ny√≠t√°s
addEventListener("keydown", e=>{
  const k=e.key.toLowerCase();
  if(k==="arrowleft"||k==="a"){ if(snVX!==1){ snVX=-1; snVY=0; } }
  if(k==="arrowright"||k==="d"){ if(snVX!==-1){ snVX=1; snVY=0; } }
  if(k==="arrowup"||k==="w"){ if(snVY!==1){ snVY=-1; snVX=0; } }
  if(k==="arrowdown"||k==="s"){ if(snVY!==-1){ snVY=1; snVX=0; } }
});
</script>

<script>
/* ---------- K≈ë‚ÄìPap√≠r‚ÄìOll√≥ (klasszikus + modern -1) ---------- */
let rpsYou=0, rpsBot=0, rpsMode="classic";
const rpsWins={rock:"scissors", paper:"rock", scissors:"paper"};
function rpsSetMode(m){
  rpsMode=m;
  document.getElementById("rps-mode-label").textContent=(m==="classic"?"Hagyom√°nyos":"Modern (-1 vesztes)");
  document.getElementById("rps-mode-classic").classList.toggle("active", m==="classic");
  document.getElementById("rps-mode-modern").classList.toggle("active", m==="modern");
}
document.getElementById("rps-mode-classic").onclick=()=>rpsSetMode("classic");
document.getElementById("rps-mode-modern").onclick=()=>rpsSetMode("modern");
function rpsReset(){ rpsYou=0; rpsBot=0; rpsUpdate(); document.getElementById("rps-last").textContent=""; }
function rpsUpdate(){ document.getElementById("rps-you").textContent=rpsYou; document.getElementById("rps-bot").textContent=rpsBot; }
function icon(x){ return x==="rock"?"‚úä":(x==="paper"?"üñê":"‚úå"); }
function rpsChoose(you){
  const choices=["rock","paper","scissors"]; const bot=choices[Math.floor(Math.random()*3)];
  let msg=`Te: ${icon(you)} | G√©p: ${icon(bot)} ‚Üí `;
  if(you===bot){ msg+="D√∂ntetlen."; }
  else if(rpsWins[you]===bot){ msg+="Nyert√©l! "; rpsYou += 1; }
  else{ msg+="Vesztett√©l. "; if(rpsMode==="modern"){ rpsYou -= 1; } rpsBot += 1; }
  rpsUpdate(); document.getElementById("rps-last").textContent=msg;
}
</script>

<script>
/* ---------- Reflex j√°t√©k ---------- */
const K_REF="ref_best_v1"; let refRound=0, refWaiting=false, refStartTime=0, refTimes=[];
function refStart(){
  refRound=0; refTimes=[]; document.getElementById("ref-last").textContent="‚Äì"; document.getElementById("ref-avg").textContent="‚Äì";
  nextRound();
}
function nextRound(){
  refRound++; if(refRound>5){ finishRef(); return; }
  document.getElementById("ref-round").textContent=refRound;
  const box=document.getElementById("refbox");
  box.style.background="#0f2142"; box.textContent="V√°rj...";
  refWaiting=true;
  const delay=600+Math.random()*1800;
  setTimeout(()=>{ box.style.background="#1f8f54"; box.textContent="KATT!"; refWaiting=false; refStartTime=performance.now(); }, delay);
}
document.getElementById("refbox").addEventListener("click", ()=>{
  const box=document.getElementById("refbox");
  if(refRound===0) return;
  if(refWaiting){ box.style.background="#b63a3a"; box.textContent="Korai! - √∫jra"; setTimeout(nextRound,650); return; }
  const t=Math.round(performance.now()-refStartTime);
  refTimes.push(t);
  document.getElementById("ref-last").textContent=t;
  const avg=Math.round(refTimes.reduce((a,b)=>a+b,0)/refTimes.length);
  document.getElementById("ref-avg").textContent=avg;
  setTimeout(nextRound,550);
});
function finishRef(){
  const avg=Math.round(refTimes.reduce((a,b)=>a+b,0)/refTimes.length);
  const best=+localStorage.getItem(K_REF)||9999;
  if(avg<best) localStorage.setItem(K_REF, avg);
  document.getElementById("ref-best").textContent=localStorage.getItem(K_REF) || avg;
  const box=document.getElementById("refbox"); box.style.background="#0f2142"; box.textContent="K√©sz! √öjra az Ind√≠t√°ssal."
}
// init toplista √©rt√©k
document.getElementById("ref-best").textContent=localStorage.getItem(K_REF)||"‚Äì";
</script>

<script>
/* ---------- Saj√°t Ugr√°l√≥s (Mario-s) ‚Äì j√°t√©kos/ellens√©g k√©p felt√∂lt√©ssel ---------- */
(()=>{"use strict";
  const K_PLAYER="mario_player_img_v1", K_ENEMY="mario_enemy_img_v1", K_BEST="mario_best_v1";
  const cvs=document.getElementById("mario"), ctx=cvs.getContext("2d");
  let running=false, last=0, acc=0, step=18; // rajz friss√≠t√©s ms
  let player, groundY=260, gravity=0.75, jumpV=-13;
  let obstacles=[], enemies=[], score=0, best=+localStorage.getItem(K_BEST)||0;
  const dpr=Math.max(1,Math.floor(window.devicePixelRatio||1));
  function fit(){ const cssW=cvs.parentElement.clientWidth; const cssH=360;
    cvs.style.width=cssW+"px"; cvs.style.height=cssH+"px"; cvs.width=Math.floor(cssW*dpr); cvs.height=Math.floor(cssH*dpr); ctx.setTransform(dpr,0,0,dpr,0,0); }
  fit(); addEventListener("resize", fit);

  // alap k√©pek (svg base64)
  const imgPlayerDef=new Image(); imgPlayerDef.src="data:image/svg+xml;base64,"+btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='48' height='48'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='#ff6a6a'/><stop offset='1' stop-color='#ffb86a'/></linearGradient></defs><rect width='48' height='48' rx='10' fill='url(#g)'/><circle cx='24' cy='16' r='7' fill='#fff'/><rect x='13' y='25' width='22' height='14' rx='7' fill='#fff'/></svg>`);
  const imgPipe=new Image(); imgPipe.src="data:image/svg+xml;base64,"+btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='36' height='48'><rect width='36' height='48' fill='#2ecc71'/><rect y='0' width='36' height='10' fill='#27ae60'/></svg>`);
  const imgEnemyDef=new Image(); imgEnemyDef.src="data:image/svg+xml;base64,"+btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='40' height='28'><rect width='40' height='28' rx='6' fill='#8e44ad'/><circle cx='14' cy='12' r='3' fill='#fff'/><circle cx='26' cy='12' r='3' fill='#fff'/><rect x='10' y='20' width='20' height='4' rx='2' fill='#fff'/></svg>`);

  const imgPlayer=new Image(), imgEnemy=new Image();
  imgPlayer.src=localStorage.getItem(K_PLAYER)||imgPlayerDef.src;
  imgEnemy.src=localStorage.getItem(K_ENEMY)||imgEnemyDef.src;

  function resetPlayer(){ player={ x:60, y:groundY-44, vy:0, w:44, h:44, jump(){ if(this.y>=groundY-this.h-0.5){ this.vy=jumpV; } } } }
  function spawn(){ const w=36, h=40+Math.floor(Math.random()*60), vx=-(2.5+score*0.01); obstacles.push({x:cvs.width/dpr,y:groundY-h,w,h,vx}); if(Math.random()<0.6){ enemies.push({x:cvs.width/dpr+120,y:groundY-28,w:40,h:28,vx:-(3+score*0.015)}); } }
  function rect(a,b){ return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y }
  function stepGame(dt){
    ctx.clearRect(0,0,cvs.width,cvs.height);
    // f√∂ld s√°v
    ctx.fillStyle="#152542"; ctx.fillRect(0, groundY+44, cvs.width, 10);
    ctx.fillStyle="#1b2a48"; ctx.fillRect(0, groundY+20, cvs.width, 24);

    // player fizika
    player.vy+=gravity; player.y+=player.vy; if(player.y>groundY-player.h){ player.y=groundY-player.h; player.vy=0; }

    // akad√°lyok/ellens√©g
    obstacles.forEach(o=>{ o.x+=o.vx; ctx.drawImage(imgPipe,o.x,o.y,o.w,o.h); });
    enemies.forEach(en=>{ en.x+=en.vx; ctx.drawImage(imgEnemy,en.x,en.y,en.w,en.h); });

    // player rajz (lekerek√≠tett maszk)
    ctx.save(); ctx.beginPath(); ctx.roundRect(player.x,player.y,player.w,player.h,10); ctx.clip(); ctx.drawImage(imgPlayer,player.x,player.y,player.w,player.h); ctx.restore();

    // pont
    score += dt*0.01; document.getElementById("mario-score").textContent=Math.floor(score); document.getElementById("mario-best").textContent=best;

    // takar√≠t√°s √©s √ºtk√∂z√©sek
    obstacles=obstacles.filter(o=>o.x+o.w>-50); enemies=enemies.filter(e=>e.x+e.w>-50);
    for(const o of obstacles){ if(rect(player,o)) return gameOver(); }
    for(const e of enemies){ if(rect(player,e)) return gameOver(); }
  }
  function gameOver(){
    running=false;
    best=Math.max(best,Math.floor(score)); localStorage.setItem(K_BEST,best);
    ctx.fillStyle="rgba(0,0,0,.45)"; ctx.fillRect(0,0,cvs.width,cvs.height);
    ctx.fillStyle="#fff"; ctx.font="bold 24px Inter, sans-serif"; ctx.textAlign="center";
    ctx.fillText("üí• Game Over ‚Äì Start/Reset!", cvs.width/2/dpr, 140);
  }
  function loop(t){ if(!running) return; const dt=t-last||16; last=t; acc+=dt;
    while(acc>=step){ stepGame(step); if(Math.random()<0.025) spawn(); acc-=step; }
    requestAnimationFrame(loop);
  }
  function reset(){ score=0; obstacles=[]; enemies=[]; resetPlayer(); acc=0; last=performance.now(); }

  // publikus
  window.marioStart=function(){ reset(); running=true; loop(); }
  window.marioClearImages=function(){ localStorage.removeItem(K_PLAYER); localStorage.removeItem(K_ENEMY); imgPlayer.src=imgPlayerDef.src; imgEnemy.src=imgEnemyDef.src; resetPlayer(); }

  // input
  addEventListener("keydown", e=>{ const k=e.key.toLowerCase(); if(k===" "||k==="arrowup"||k==="w"){ e.preventDefault(); player?.jump(); } }, {passive:false});
  cvs.addEventListener("pointerdown", ()=> player?.jump());

  // felt√∂lt√©sek
  document.getElementById("player-file").addEventListener("change",ev=>{
    const f=ev.target.files?.[0]; if(!f) return; const rd=new FileReader();
    rd.onload=()=>{ try{ localStorage.setItem(K_PLAYER, rd.result); imgPlayer.src=rd.result; resetPlayer(); }catch(e){} };
    rd.readAsDataURL(f);
  });
  document.getElementById("enemy-file").addEventListener("change",ev=>{
    const f=ev.target.files?.[0]; if(!f) return; const rd=new FileReader();
    rd.onload=()=>{ try{ localStorage.setItem(K_ENEMY, rd.result); imgEnemy.src=rd.result; }catch(e){} };
    rd.readAsDataURL(f);
  });

  // init
  resetPlayer();
})();
</script>

</body>
</html>
<style>
  /* Mem√≥ria k√°rtya: biztos sz√≠n/m√©ret az emojihoz */
  .mcard{ color:#fff !important; font-size:28px !important; }
</style>

<script>
/* --- 1) K√©perny≈ëv√°lt√°s: "screen:open" esem√©ny k√ºld√©se --- */
(function(){
  const _openScreen = window.openScreen;
  window.openScreen = function(id){
    // eredeti m≈±k√∂d√©s
    _openScreen(id);
    // jelezz√ºk, hogy megny√≠lt a k√©perny≈ë (k√∂vetkez≈ë event loopban)
    setTimeout(()=>window.dispatchEvent(new CustomEvent('screen:open',{detail:{id}})),0);
  };
})();
</script>

<script>
/* --- 2) Mario: biztos v√°szon-m√©retez√©s, miel≈ëtt indul --- */
(function(){
  // ha ezek a f√ºggv√©nyek m√©g nincsenek, l√©p√ºnk ki csendben
  const cvs = document.getElementById('mario');
  if(!cvs) return;

  // illeszked≈ë m√©retez√©s akkor is, ha eddig rejtett volt a szekci√≥
  function marioFit(){
    const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
    const cssW = Math.max(320, Math.min(1000, cvs.parentElement.clientWidth || 1000));
    const cssH = 360;
    cvs.style.width = cssW + 'px';
    cvs.style.height = cssH + 'px';
    cvs.width = Math.floor(cssW * dpr);
    cvs.height = Math.floor(cssH * dpr);
    const ctx = cvs.getContext('2d');
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.marioFit = marioFit;

  // wrap-oljuk a marioStart-ot, hogy mindig legyen fit() indul√°s el≈ëtt
  if(typeof window.marioStart === 'function'){
    const _marioStart = window.marioStart;
    window.marioStart = function(){
      marioFit();
      _marioStart();
    };
  }

  // amikor megny√≠lik a Mario k√©perny≈ë, m√©retezz√ºnk √©s (ha akarod) automatikusan indulhat
  window.addEventListener('screen:open', (e)=>{
    if(e.detail && e.detail.id === 'screen-mario'){
      marioFit();
      // opcion√°lis auto-start: vedd ki a kommentet, ha szeretn√©d
      // window.marioStart();
    }
  });

  // ablakm√©ret v√°ltoz√°sra is igaz√≠t√°s
  window.addEventListener('resize', ()=>{
    const scr = document.getElementById('screen-mario');
    if(scr && scr.classList.contains('active')) marioFit();
  });
})();
</script>

<script>
/* --- 3) Mem√≥ria: automatikus ind√≠t√°s k√©perny≈ënyit√°skor --- */
(function(){
  window.addEventListener('screen:open', (e)=>{
    if(e.detail && e.detail.id === 'screen-memory'){
      if(typeof window.startMemory === 'function') window.startMemory();
    }
  });
})();
</script>

<script>
/* --- 4) Extra: ha a Snake k√©perny≈ëre l√©psz, ind√≠thatjuk/√°ll√≠tjuk a sebess√©get --- */
(function(){
  window.addEventListener('screen:open', (e)=>{
    if(e.detail && e.detail.id === 'screen-snake'){
      if(typeof window.setSnakeSpeed === 'function'){
        const s = document.getElementById('sn-speed');
        if(s){ window.setSnakeSpeed(s.value); }
      }
    }
  });
})();
</script>

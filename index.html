<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>B√ºntet≈ër√∫g√°s ‚Äì 5 l√∂v√©s | HTML5 Canvas</title>
<style>
  :root { --bg:#0f172a; --panel:#111827; --accent:#22c55e; --muted:#9ca3af; --text:#e5e7eb; }
  * { box-sizing: border-box; }
  body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background: radial-gradient(1000px 600px at 50% 0%, #0b1229, #0a1022 60%, #070d1c); color: var(--text); display: grid; place-items: center; min-height: 100vh; }
  .wrap { width: min(1000px, 96vw); }
  header { display:flex; gap:12px; align-items:center; justify-content:space-between; margin: 16px 0 10px; }
  .title { font-size: clamp(18px, 2.4vw, 24px); font-weight: 700; letter-spacing: .2px; }
  .panel { background: linear-gradient(180deg, #141a2e, #0f1629); border: 1px solid #1f2937; padding: 12px; border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
  .row { display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
  label { font-size: 13px; color: var(--muted); }
  select, button { appearance: none; border:1px solid #243041; background:#0c1324; color:var(--text); padding:10px 12px; border-radius:12px; font-weight:600; }
  select { min-width: 180px; }
  button { cursor: pointer; transition: transform .05s ease, box-shadow .2s ease, background .2s; }
  button.primary { background: linear-gradient(180deg, #1f9b58, #158f50); border-color:#1f9b58; box-shadow: 0 8px 20px rgba(34,197,94,.25); }
  button:hover { filter: brightness(1.06); }
  button:active { transform: translateY(1px); }
  .hud { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:10px; }
  .stats { font-weight:700; letter-spacing:.3px; }
  .hint { font-size: 13px; color: var(--muted); }
  canvas { width: 100%; height: auto; display:block; background: #1b3b1b; border-radius: 16px; border:1px solid #234a23; }
  .toast { position: fixed; left: 50%; bottom: 20px; transform: translateX(-50%); background:#0b1224; border:1px solid #1e293b; padding:10px 14px; border-radius:12px; font-weight:600; color:#cbd5e1; box-shadow: 0 10px 30px rgba(0,0,0,.35); opacity:.95; }
  .badge { padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid #334155; color:#cbd5e1; background:#0b1224; }
  .hidden { display:none; }
  .result { display:flex; align-items:center; gap:10px; font-weight:800; }
  .result .you { color:#86efac; }
  .result .opp { color:#fca5a5; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">‚öΩ B√ºntet≈ër√∫g√°s ‚Äì 5 l√∂v√©s</div>
      <div class="badge">HTML5 Canvas ‚Ä¢ Eg√©r: h√∫zd & engedd</div>
    </header>

    <div class="panel" id="menu">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <div>
            <label for="teamA">Te v√°logatottad</label><br/>
            <select id="teamA"></select>
          </div>
          <div>
            <label for="teamB">Ellenf√©l</label><br/>
            <select id="teamB"></select>
          </div>
          <div>
            <label for="difficulty">Neh√©zs√©g</label><br/>
            <select id="difficulty">
              <option value="easy">Kezd≈ë (lass√∫ kapus)</option>
              <option value="normal" selected>K√∂z√©p</option>
              <option value="hard">Halad√≥ (gyors kapus)</option>
            </select>
          </div>
        </div>
        <button id="startBtn" class="primary">‚ñ∂Ô∏è Meccs ind√≠t√°sa</button>
      </div>
      <div class="hint" style="margin-top:8px">Tipp: fogd meg a labd√°t, h√∫zd h√°tra/oldalra, majd engedd el! Az oldalir√°ny kicsit g√∂rb√≠ti a l√∂v√©st.</div>
    </div>

    <canvas id="game" width="1000" height="620"></canvas>

    <div class="hud">
      <div class="stats" id="scoreBox">Hungary 0 ‚Äì 0 Opponent | L√∂v√©s: 1 / 5</div>
      <div class="result hidden" id="finalBox">
        <span class="you">Te:</span><span id="youScore">0</span>
        <span>‚Äì</span>
        <span class="opp">Ellenf√©l:</span><span id="oppScore">0</span>
        <button id="restartBtn" style="margin-left:10px">üîÑ √öj meccs</button>
      </div>
      <div class="hint" id="hintBox">Fogd meg a labd√°t, h√∫zd h√°tra, engedd el. R: Reset l√∂v√©s</div>
    </div>
  </div>

  <div class="toast hidden" id="toast">G√ì√ì√ìL! üéâ</div>

<script>
(() => {
  // ======= Be√°ll√≠t√°sok / csapatok =======
  const COUNTRIES = [
    { name: "Hungary",    kit:"#e11d48", alt:"#16a34a" },
    { name: "England",    kit:"#f59e0b", alt:"#1d4ed8" },
    { name: "Germany",    kit:"#111827", alt:"#e5e7eb" },
    { name: "France",     kit:"#1d4ed8", alt:"#e11d48" },
    { name: "Spain",      kit:"#ef4444", alt:"#f59e0b" },
    { name: "Italy",      kit:"#2563eb", alt:"#22c55e" },
    { name: "Portugal",   kit:"#991b1b", alt:"#22c55e" },
    { name: "Netherlands",kit:"#ea580c", alt:"#111827" },
    { name: "Brazil",     kit:"#22c55e", alt:"#eab308" },
    { name: "Argentina",  kit:"#60a5fa", alt:"#e5e7eb" },
    { name: "Croatia",    kit:"#ef4444", alt:"#e5e7eb" },
    { name: "Belgium",    kit:"#111827", alt:"#f59e0b" }
  ];

  const teamASelect = document.getElementById('teamA');
  const teamBSelect = document.getElementById('teamB');
  const diffSelect  = document.getElementById('difficulty');
  const scoreBox    = document.getElementById('scoreBox');
  const hintBox     = document.getElementById('hintBox');
  const finalBox    = document.getElementById('finalBox');
  const youScoreEl  = document.getElementById('youScore');
  const oppScoreEl  = document.getElementById('oppScore');
  const toast       = document.getElementById('toast');

  function fillTeams() {
    teamASelect.innerHTML = '';
    teamBSelect.innerHTML = '';
    for (const c of COUNTRIES) {
      const o1 = document.createElement('option'); o1.value=o1.textContent=c.name;
      const o2 = document.createElement('option'); o2.value=o2.textContent=c.name;
      teamASelect.appendChild(o1); teamBSelect.appendChild(o2);
    }
    // defaultok
    teamASelect.value = "Hungary";
    teamBSelect.value = "Germany";
  }
  fillTeams();

  // ======= Canvas / j√°t√©k√°llapot =======
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const W = canvas.width, H = canvas.height;
  const GOAL = { x1: 280, x2: 720, y: 120, depth: 36, postW: 6, postH: 70 };
  const SPOT = { x: W/2, y: H - 130 };

  let state = 'menu'; // 'aim' | 'flying' | 'dead' | 'gameover'
  let shots = 0, maxShots = 5;
  let goals = 0, oppGoals = 0;

  // labda
  const ball = { x: SPOT.x, y: SPOT.y, r: 12, vx: 0, vy: 0, spin: 0, dragging: false };
  let keeper = { w: 70, h: 22, y: GOAL.y + 10, t: 0, speed: 1.1, react: 0.45, dive:false, dx:0 };

  let teamA = COUNTRIES[0], teamB = COUNTRIES[2];

  function setDifficulty() {
    const d = diffSelect.value;
    if (d === 'easy')   { keeper.speed = 0.8; keeper.react = 0.25; }
    if (d === 'normal') { keeper.speed = 1.1; keeper.react = 0.45; }
    if (d === 'hard')   { keeper.speed = 1.5; keeper.react = 0.65; }
  }
  setDifficulty();

  // ======= UI =======
  const startBtn = document.getElementById('startBtn');
  const restartBtn = document.getElementById('restartBtn');
  const menu = document.getElementById('menu');

  startBtn.addEventListener('click', () => {
    teamA = COUNTRIES.find(c=>c.name===teamASelect.value) || COUNTRIES[0];
    teamB = COUNTRIES.find(c=>c.name===teamBSelect.value) || COUNTRIES[1];
    setDifficulty();
    resetMatch();
    menu.classList.add('hidden');
    state='aim';
  });
  restartBtn.addEventListener('click', () => {
    resetMatch();
    finalBox.classList.add('hidden');
    scoreBox.classList.remove('hidden');
    hintBox.textContent = "Fogd meg a labd√°t, h√∫zd h√°tra, engedd el. R: Reset l√∂v√©s";
    state='aim';
  });

  function resetMatch() {
    shots=0; goals=0; oppGoals=0;
    resetBall(true);
    updateHUD();
  }

  function resetBall(center=false) {
    ball.x = center ? SPOT.x : SPOT.x;
    ball.y = SPOT.y;
    ball.vx = ball.vy = 0; ball.spin = 0; ball.dragging=false;
  }

  function updateHUD() {
    scoreBox.textContent = `${teamA.name} ${goals} ‚Äì ${oppGoals} ${teamB.name} | L√∂v√©s: ${Math.min(shots+1, maxShots)} / ${maxShots}`;
    youScoreEl.textContent = goals; oppScoreEl.textContent = oppGoals;
  }

  function showToast(txt, ms=1200) {
    toast.textContent = txt;
    toast.classList.remove('hidden');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.add('hidden'), ms);
  }

  // ======= Rajzol√°s =======
  function drawField() {
    // f≈±
    ctx.fillStyle = "#1b3b1b";
    ctx.fillRect(0,0,W,H);
    // cs√≠kok
    for (let i=0;i<10;i++){
      ctx.fillStyle = i%2? "#1d421d" : "#194019";
      ctx.fillRect(0, H - i*60 - 60, W, 60);
    }
    // 16-os
    ctx.strokeStyle = "#e5e7eb"; ctx.lineWidth = 2;
    roundedRect(GOAL.x1-120, GOAL.y, (GOAL.x2-GOAL.x1)+240, 250, 40);
    ctx.stroke();

    // kapu (fels≈ë vonal + kapuf√°k)
    ctx.lineWidth = 5; ctx.strokeStyle = "#ffffff";
    ctx.beginPath(); ctx.moveTo(GOAL.x1, GOAL.y); ctx.lineTo(GOAL.x2, GOAL.y); ctx.stroke();
    ctx.fillStyle="#ffffff";
    ctx.fillRect(GOAL.x1-GOAL.postW/2, GOAL.y, GOAL.postW, GOAL.postH);
    ctx.fillRect(GOAL.x2-GOAL.postW/2, GOAL.y, GOAL.postW, GOAL.postH);
    // h√°l√≥ √°rny√©k
    ctx.globalAlpha = 0.08; ctx.fillStyle = "#ffffff";
    for (let i=0;i<10;i++){
      ctx.fillRect(GOAL.x1, GOAL.y + i*6, GOAL.x2-GOAL.x1, 2);
    }
    ctx.globalAlpha = 1;

    // tizenegyes pont
    ctx.fillStyle = "#ffffff"; ctx.beginPath();
    ctx.arc(SPOT.x, SPOT.y, 3, 0, Math.PI*2); ctx.fill();

    // csapat "mezek" (HUD jelz√©s a p√°ly√°n)
    drawShirt(60, 24, teamA.kit);
    drawShirt(W-60, 24, teamB.kit);
    ctx.fillStyle = "#cbd5e1";
    ctx.font = "700 14px system-ui"; ctx.textAlign = "left";
    ctx.fillText(teamA.name, 80, 30);
    ctx.textAlign = "right"; ctx.fillText(teamB.name, W-80, 30);
  }

  function roundedRect(x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }

  function drawShirt(x,y,color){
    ctx.save();
    ctx.translate(x,y);
    ctx.fillStyle = color;
    ctx.strokeStyle = "#0b1224"; ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(-16,6); ctx.lineTo(-22,-6); ctx.lineTo(-8,-12);
    ctx.lineTo(0,-4); ctx.lineTo(8,-12); ctx.lineTo(22,-6);
    ctx.lineTo(16,6); ctx.lineTo(16,18); ctx.lineTo(-16,18);
    ctx.closePath(); ctx.fill(); ctx.stroke();
    ctx.restore();
  }

  function drawBall() {
    ctx.fillStyle = "#ffffff"; ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
    ctx.strokeStyle="#111827"; ctx.lineWidth=2; ctx.stroke();
  }

  function drawKeeper() {
    const x = keeperX();
    ctx.fillStyle = "#c7d2fe";
    roundRectFill(x - keeper.w/2, keeper.y, keeper.w, keeper.h, 6);
    // kis "k√©z" jelek
    ctx.fillStyle = "#bfdbfe";
    ctx.fillRect(x - keeper.w/2 - 6, keeper.y + keeper.h/2 - 4, 6, 8);
    ctx.fillRect(x + keeper.w/2,     keeper.y + keeper.h/2 - 4, 6, 8);
  }

  function roundRectFill(x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
    ctx.fill();
  }

  // ======= Kapus mozg√°s =======
  function keeperX() {
    // Alap: szinuszmozg√°s
    const amp = (GOAL.x2 - GOAL.x1 - keeper.w) / 2;
    const cx = (GOAL.x1 + GOAL.x2) / 2;
    let x = cx + amp * Math.sin(keeper.t);
    // Ha reag√°lt a l√∂v√©sre: kicsit igyekszik az el≈ëre jelzett c√©l fel√©
    if (keeper.dive) {
      x += keeper.dx * 0.6; // s√∫lyozott r√°seg√≠t√©s
    }
    return x;
  }

  function keeperRectAt(x) {
    return { x: x - keeper.w/2, y: keeper.y, w: keeper.w, h: keeper.h };
  }

  function collideBallRect(b, r) {
    // K√∂r-t√©glalap √ºtk√∂z√©s
    const cx = Math.max(r.x, Math.min(b.x, r.x + r.w));
    const cy = Math.max(r.y, Math.min(b.y, r.y + r.h));
    const dx = b.x - cx, dy = b.y - cy;
    return (dx*dx + dy*dy) <= b.r*b.r;
  }

  // ======= J√°t√©kciklus =======
  let last = 0;
  function loop(ts) {
    const dt = (ts - last) / 1000 || 0.016; last = ts;
    update(dt);
    draw();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  function update(dt) {
    if (state === 'menu') return;

    // Kapus f√°zisa
    keeper.t += dt * keeper.speed;

    if (state === 'flying') {
      // g√∂rb√ºlet
      ball.vx += ball.spin * Math.abs(ball.vy) * 0.0009;
      // lassul√°s
      ball.vx *= 0.999; ball.vy *= 0.9992;
      // poz friss√≠t√©s
      ball.x += ball.vx * dt; ball.y += ball.vy * dt;

      // kapufa visszapattan√°s
      const leftPost = { x: GOAL.x1 - 3, y: GOAL.y, w: 6, h: GOAL.postH };
      const rightPost= { x: GOAL.x2 - 3, y: GOAL.y, w: 6, h: GOAL.postH };
      if (collideBallRect(ball, leftPost) || collideBallRect(ball, rightPost)) {
        ball.vx = -ball.vx * 0.6; ball.vy *= 0.75;
        showToast("Kapufa! üòµ", 800);
      }

      // kapus √ºtk√∂z√©s
      const kr = keeperRectAt(keeperX());
      if (collideBallRect(ball, kr)) {
        // egyszer≈± pattan√°s: vissza lefel√©
        ball.vy = Math.abs(ball.vy) * 0.6;
        ball.vx *= 0.5;
        state = 'dead';
        showToast("V√©d√©s! üß§", 800);
        postShot(false);
      }

      // g√≥lvonal √°tl√©p√©s (k√∂z√© tartom√°ny)
      if (ball.y <= GOAL.y && ball.x > GOAL.x1 && ball.x < GOAL.x2) {
        state = 'dead';
        showToast("G√ì√ì√ìL! üéâ");
        postShot(true);
      }

      // Kiment / nagyon lelassult
      if (ball.y < -50 || ball.y > H+60 || (Math.abs(ball.vx)+Math.abs(ball.vy) < 8)) {
        state = 'dead';
        if (!(ball.y <= GOAL.y && ball.x > GOAL.x1 && ball.x < GOAL.x2)) {
          showToast("Mell√©... üò¨", 800);
          postShot(false);
        }
      }
    }
  }

  function postShot(scored) {
    if (scored) goals++;
    shots++;
    updateHUD();

    // Egyszer≈± ellenf√©l-szimul√°ci√≥: minden k√∂rben kap es√©lyt (neh√©zs√©g-f√ºgg≈ë)
    simulateOpponent();

    setTimeout(() => {
      if (shots >= maxShots) {
        endMatch();
      } else {
        resetBall(true);
        state = 'aim';
      }
    }, 650);
  }

  function simulateOpponent() {
    // A neh√©zs√©gt≈ël f√ºgg≈ëen kb. mennyi g√≥lt r√∫g ellen√ºnk
    // (csak statisztikailag: nem l√∂vi meg k√©perny≈ën)
    const d = diffSelect.value;
    let p = 0.52;
    if (d === 'easy') p = 0.36;
    if (d === 'normal') p = 0.52;
    if (d === 'hard') p = 0.68;
    if (Math.random() < p) oppGoals++;
  }

  function endMatch() {
    state = 'gameover';
    scoreBox.classList.add('hidden');
    finalBox.classList.remove('hidden');
    youScoreEl.textContent = goals;
    oppScoreEl.textContent = oppGoals;
    if (goals > oppGoals) showToast("Gy≈ëzelem! üèÜ", 2000);
    else if (goals < oppGoals) showToast("Veres√©g... üò¢", 2000);
    else showToast("D√∂ntetlen! ü§ù", 2000);
  }

  function draw() {
    drawField();
    drawKeeper();

    // c√©lz√≥vonal h√∫z√°s k√∂zben
    if (ball.dragging) {
      ctx.strokeStyle = "#fde68a"; ctx.lineWidth = 2;
      ctx.beginPath(); ctx.moveTo(ball.x, ball.y);
      ctx.lineTo(mouse.x, mouse.y);
      ctx.stroke();
      // er≈ë sk√°la
      const dx = ball.x - mouse.x, dy = ball.y - mouse.y;
      const p = Math.min(1, Math.hypot(dx,dy) / 180);
      ctx.fillStyle = "#fde68a"; ctx.globalAlpha=0.9;
      ctx.fillRect(20, H-34, 200*p, 10);
      ctx.strokeStyle="#e5e7eb"; ctx.strokeRect(20, H-34, 200, 10);
      ctx.globalAlpha=1;
    }

    drawBall();

    // inform√°ci√≥s felirat
    ctx.fillStyle="#cbd5e1";
    ctx.font="600 14px system-ui"; ctx.textAlign="center";
    if (state==='aim' && !ball.dragging) {
      ctx.fillText("Fogd meg a labd√°t, h√∫zd h√°tra/oldalra, majd engedd el a l√∂v√©shez!", W/2, H-12);
    } else if (state==='flying') {
      ctx.fillText("L√∂v√©s folyamatban...", W/2, H-12);
    } else if (state==='gameover') {
      ctx.fillText("V√©ge ‚Äì kattints √öj meccs-re a fenti s√°vban!", W/2, H-12);
    }
  }

  // ======= Input =======
  const mouse = { x:0, y:0 };
  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    const sx = W / rect.width;
    const sy = H / rect.height;
    mouse.x = (e.clientX - rect.left) * sx;
    mouse.y = (e.clientY - rect.top) * sy;
  });

  canvas.addEventListener('mousedown', (e) => {
    if (state!=='aim') return;
    const dx = mouse.x - ball.x, dy = mouse.y - ball.y;
    if (dx*dx + dy*dy <= (ball.r+18)*(ball.r+18)) {
      ball.dragging = true;
      hintBox.textContent = "H√∫zd vissza a c√©lvonalon, engedd el a l√∂v√©shez!";
    }
  });

  window.addEventListener('mouseup', () => {
    if (state!=='aim' || !ball.dragging) return;
    // kil√∂v√©s
    const dx = ball.x - mouse.x;
    const dy = ball.y - mouse.y;
    const power = Math.hypot(dx, dy);
    const scale = 6.2; // pix/s
    ball.vx = dx * scale;
    ball.vy = dy * scale;
    // spin: oldalir√°ny ar√°nyos
    ball.spin = Math.max(-1, Math.min(1, dx / 220));
    ball.dragging = false;
    state = 'flying';
    hintBox.textContent = "L√∂v√©s!";

    // Kapus "reakci√≥": k√©sleltetve mozdul a becs√ºlt c√©l fel√©
    const aimX = ball.x + (ball.vx / Math.max(Math.abs(ball.vy), 1)) * (ball.y - GOAL.y);
    const clampedAim = Math.max(GOAL.x1+20, Math.min(GOAL.x2-20, aimX));
    const delay = 110 + (1 - keeper.react) * 200; // ms
    setTimeout(() => {
      const targetMid = (GOAL.x1 + GOAL.x2)/2;
      const toAim = clampedAim - targetMid;
      keeper.dx = toAim / 6;
      keeper.dive = true;
      setTimeout(()=> keeper.dive=false, 600);
    }, delay);
  });

  window.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 'r') {
      resetBall(true);
      state='aim';
      hintBox.textContent = "Resetelve. Fogd meg a labd√°t, h√∫zd h√°tra, engedd el!";
    }
  });

  // ======= Seg√©d =======
  // Eszk√∂zsoron vissza a men√ºbe, ha akarod √∫j csapatokkal
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && state!=='menu') {
      menu.classList.remove('hidden');
      state='menu';
    }
  });

})();
</script>
</body>
</html>

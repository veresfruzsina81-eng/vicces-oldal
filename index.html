<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tam√°s Mesters√©ges (AI)</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
  <style>
    :root{
      --maxw: 980px;
      --text: #eaf0f7; --muted:#b8c2d3;
      --glass: rgba(18,22,28,.58);
      --border: 1px solid rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --user1: #ffb23c; --user2:#ffa21a;
    }
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#0b1015 fixed center/cover no-repeat;
      background-image:url("bg_tamas.jpg");
      -webkit-font-smoothing:antialiased;
    }
    .glass{background:var(--glass); border:var(--border);
      border-radius:26px; box-shadow:var(--shadow);
      backdrop-filter: blur(10px) saturate(120%);
      -webkit-backdrop-filter: blur(10px) saturate(120%);}
    header{
      position:sticky; top:0; z-index:10;
      max-width:var(--maxw); margin:16px auto 0; padding:16px 20px;
    }
    header h1{margin:0; font-size:28px; font-weight:800}
    header .sub{margin-top:6px; color:var(--muted)}
    main{max-width:var(--maxw); margin:0 auto; padding:16px}
    .panel{display:flex; flex-direction:column; min-height:460px; height:calc(100dvh - 220px); padding:16px}
    .msgs{overflow:auto; padding:6px 6px 14px; scroll-behavior:smooth}
    .row{display:flex; margin:10px 0}
    .msg{
      max-width:min(720px,90%); padding:16px 18px; border-radius:22px;
      box-shadow:0 6px 18px rgba(0,0,0,.18); word-wrap:break-word;
      text-shadow:0 1px 2px rgba(0,0,0,.35)
    }
    .bot{background:rgba(0,0,0,.55)}
    .user{margin-left:auto; color:#221;
      background:linear-gradient(180deg,var(--user1),var(--user2))}
    .tools{display:flex; gap:12px; margin:10px 0 0 6px; flex-wrap:wrap}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:10px 14px;
      border-radius:14px; background:rgba(0,0,0,.5); border:1px solid rgba(255,255,255,.08);
      cursor:pointer; user-select:none}
    .composer{position:sticky; bottom:0; left:0; right:0; display:flex; gap:10px; align-items:center;
      padding:12px; margin-top:12px; background:linear-gradient(180deg,transparent 0,rgba(0,0,0,.35) 60%); border-radius:20px}
    .box{flex:1; padding:12px 16px; border-radius:16px; border:1px solid rgba(0,0,0,.06);
      background:rgba(255,255,255,.88); color:#111; outline:none}
    .send{border:0; border-radius:16px; padding:12px 18px; font-weight:700; cursor:pointer;
      background:linear-gradient(180deg,#ffbf56,#ffa21a); color:#1e1606; box-shadow:0 6px 18px rgba(0,0,0,.2)}
    footer{max-width:var(--maxw); margin:8px auto 20px; text-align:center; color:var(--muted); text-shadow:0 1px 2px rgba(0,0,0,.5)}
    @media (prefers-color-scheme:light){
      :root{ --text:#0e141b; --muted:#4a5a6a; }
      .bot{background:rgba(255,255,255,.8); text-shadow:none}
      .chip{background:rgba(255,255,255,.7); color:#0e141b; border-color:rgba(0,0,0,.06)}
    }
  </style>
</head>
<body>
  <header class="glass">
    <h1>Tam√°s Mesters√©ges (AI)</h1>
    <div class="sub">Halad√≥ fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens</div>
  </header>

  <main>
    <section class="panel glass" aria-label="Besz√©lget√©s">
      <div id="msgs" class="msgs"></div>
      <div class="composer">
        <input id="input" class="box" type="text" placeholder="√çrj ide‚Ä¶  Enter = k√ºld√©s" />
        <button id="send" class="send">K√ºld√©s</button>
      </div>
    </section>
  </main>

  <footer>¬© Tam√°s AI ‚Äî v√©dett oldal. B√°rmilyen m√°sol√°s jogs√©rt√©snek min≈ës√ºl.</footer>

  <script>
    const msgs = document.getElementById('msgs');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');

    // nyit√≥ √ºzenet
    addBot("Szia! Itt vagyok neked, seg√≠tek mindenben. √çrj b√°tran! üòä");

    function addRow(html){
      const d=document.createElement('div'); d.className='row'; d.innerHTML=html;
      msgs.appendChild(d); msgs.scrollTop=msgs.scrollHeight;
    }
    function esc(s){return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}

    function addUser(text){
      addRow(`<div class="msg user">${esc(text)}</div>`);
    }
    function addBot(text){
      const id = 'm'+Math.random().toString(36).slice(2);
      addRow(`
        <div class="msg bot" id="${id}">
          ${esc(text)}
          <div class="tools">
            <button class="chip" onclick="speak('${id}')">üîä Felolvas√°s</button>
            <button class="chip" onclick="copyMsg('${id}')">üìã M√°sol√°s</button>
          </div>
        </div>
      `);
    }

    window.copyMsg = (id)=>{
      const el = document.getElementById(id);
      const txt = el?.childNodes[0]?.textContent || '';
      navigator.clipboard.writeText(txt).catch(()=>{});
    };
    window.speak = (id)=>{
      try{
        const t = document.getElementById(id).childNodes[0].textContent;
        const u = new SpeechSynthesisUtterance(t); u.lang='hu-HU'; u.rate=1.02;
        speechSynthesis.cancel(); speechSynthesis.speak(u);
      }catch(_){}
    };

    async function send(){
      const text = input.value.trim();
      if(!text) return;
      addUser(text);
      input.value='';

      // √°tmeneti ‚ÄûGondolkodom‚Ä¶‚Äù
      const thinkingId = 'm'+Math.random().toString(36).slice(2);
      addRow(`<div class="msg bot" id="${thinkingId}">Gondolkodom‚Ä¶</div>`);

      try{
        const r = await fetch('/.netlify/functions/chat', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ message: text })
        });
        const holder = document.getElementById(thinkingId);
        if(!r.ok){ if(holder) holder.remove(); addBot('Szerver hiba üòï Pr√≥b√°ld meg k√©s≈ëbb!'); return; }
        const data = await r.json();
        if(holder) holder.remove();
        addBot(data.reply || 'Rendben! Hogyan seg√≠thetek m√©g?');
      }catch(e){
        const holder = document.getElementById(thinkingId);
        if(holder) holder.remove();
        addBot('Bocsi, most √©pp nem √©rem el a szervert. Pr√≥b√°ld √∫jra! üòä');
      }
    }

    sendBtn.addEventListener('click', send);
    input.addEventListener('keydown', e=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }
    });
  </script>
</body>
</html>

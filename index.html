<!doctype html>
<html lang="hu" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tam√°s Mesters√©ges (AI)</title>
  <style>
    body {
      margin:0;
      font-family:sans-serif;
      color:#e8eef6;
      height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;

      /* h√°tt√©r vissza√°ll√≠tva */
      background:#0b0f14;
      background-image: radial-gradient(transparent, rgba(0,0,0,.35)), url('/bg_tamas.jpg');
      background-size: cover;
      background-position: 50% 30%;
      background-attachment: fixed;
    }

    header {
      text-align:center;
      margin-bottom:10px;
    }
    header .ttl {
      font-size:18px;
      font-weight:700;
    }
    header .sub {
      font-size:12px;
      color:#9fb0c3;
    }

    .card {
      background:rgba(0,0,0,.35);
      border-radius:18px;
      display:flex;
      flex-direction:column;
      width:95%;
      max-width:900px;
      height:80vh;
    }

    .chatlog {
      flex:1;
      overflow-y:auto;
      padding:12px;
    }

    .row { margin:8px 0; display:flex; }
    .row.bot { justify-content:flex-start; }
    .row.user { justify-content:flex-end; }
    .row.info { justify-content:center; }

    .bubble {
      padding:10px 14px;
      border-radius:16px;
      max-width:75%;
      white-space:pre-wrap;
      word-wrap:break-word;
    }
    .bot .bubble { background:#243447; color:#fff; }
    .user .bubble { background:#ffb84d; color:#000; }
    .info .bubble { background:#1b2838; color:#9fb0c3; }
    .bubble img { max-width:200px; border-radius:8px; display:block; }

    .composerBar {
      display:flex;
      gap:6px;
      align-items:center;
      padding:8px;
      background:rgba(0,0,0,.5);
      border-radius:0 0 18px 18px;
    }
    .composerBar input {
      flex:1;
      background:transparent;
      border:0;
      color:#e8eef6;
      font-size:15px;
      outline:none;
    }
    .icon-btn {
      background:none;
      border:0;
      cursor:pointer;
      font-size:18px;
      color:#e8eef6;
    }
    .send {
      background:#ffb84d;
      border:0;
      padding:8px 16px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
    }

    footer {
      font-size:12px;
      color:#9fb0c3;
      text-align:center;
      margin-top:8px;
    }
  </style>
</head>
<body>
  <header>
    <div class="ttl">Tam√°s Mesters√©ges (AI)</div>
    <div class="sub">Halad√≥ fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens</div>
  </header>

  <section class="card">
    <div id="log" class="chatlog">
      <div class="row bot info">
        <div class="bubble">Szia! Itt vagyok neked, seg√≠tek mindenben. √çrj b√°tran! üòä</div>
      </div>
    </div>

    <div class="composerBar">
      <input id="txt" autocomplete="off" placeholder="√çrj ide‚Ä¶ Enter = k√ºld√©s" />
      <input type="file" id="imgUpload" accept="image/*" style="display:none" />
      <button class="icon-btn" id="imgBtn" title="K√©p felt√∂lt√©s">üì∑</button>
      <button class="icon-btn" id="ttsBtn" title="Felolvas√°s">üîä</button>
      <button class="send" id="sendBtn">K√ºld√©s</button>
    </div>
  </section>

  <footer>
    ¬© Tam√°s AI ‚Äî v√©dett oldal. B√°rmilyen m√°sol√°s jogs√©rt√©snek min≈ës√ºl.
  </footer>

<script>
const log=document.getElementById('log');
const txt=document.getElementById('txt');
const sendBtn=document.getElementById('sendBtn');
const imgBtn=document.getElementById('imgBtn');
const imgUpload=document.getElementById('imgUpload');
let uploadedImageBase64=null;

function addRow(kind,content,isHtml=false){
  const r=document.createElement('div');r.className='row '+kind;
  const b=document.createElement('div');b.className='bubble';
  if(isHtml){b.innerHTML=content}else{b.textContent=content}
  r.appendChild(b);log.appendChild(r);log.scrollTop=log.scrollHeight;
}

async function fileToCompressedDataURL(file,maxW=1280,quality=0.85){
  const img=new Image();
  const dataURL=await new Promise((res,rej)=>{
    const r=new FileReader();
    r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(file);
  });
  img.src=dataURL;await new Promise(r=>img.onload=r);
  const canvas=document.createElement('canvas');
  const scale=Math.min(1,maxW/img.width);
  canvas.width=Math.round(img.width*scale);
  canvas.height=Math.round(img.height*scale);
  const ctx=canvas.getContext('2d');
  ctx.drawImage(img,0,0,canvas.width,canvas.height);
  return canvas.toDataURL('image/jpeg',quality);
}

imgBtn.addEventListener('click',()=>imgUpload.click());
imgUpload.addEventListener('change',async()=>{
  const file=imgUpload.files[0];if(!file)return;
  uploadedImageBase64=await fileToCompressedDataURL(file);
  addRow('user',`<img src="${uploadedImageBase64}" alt="felt√∂lt√∂tt k√©p"/>`,true);
  ask();
});

async function ask(){
  const text=(txt.value||'').trim();
  if(!text && !uploadedImageBase64) return;
  if(text) addRow('user',text);
  txt.value='';
  try{
    const r=await fetch('/.netlify/functions/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({message:text,image:uploadedImageBase64})
    });
    const data=await r.json();
    addRow('bot',data.reply||'...');
  }catch(e){
    addRow('bot','Hiba: '+e.message);
  }
  uploadedImageBase64=null;
}

sendBtn.addEventListener('click',ask);
txt.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();ask();}
});
</script>
</body>
</html>

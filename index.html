<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tam√°s Mesters√©ges (AI)</title>
  <link rel="icon" href="data:," />
  <style>
    :root{
      --bg: #0b0f14;
      --panel: rgba(17, 21, 28, .55);
      --panel-strong: rgba(17, 21, 28, .7);
      --text: #eaf2ff;
      --muted: #afbbca;
      --accent1: #ffb547;
      --accent2: #ff8a00;
      --glass: 10px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;
      color:var(--text); background:var(--bg);
      background-image: url("bg_tamas.jpg");
      background-size: cover; background-position:center;
      background-attachment: fixed;
    }
    .shade{position:fixed; inset:0; background:rgba(0,0,0,.25)}
    header{
      position:sticky; top:0; z-index:10; margin:16px;
      padding:16px 20px; border-radius:24px;
      background:var(--panel); backdrop-filter: blur(12px);
      box-shadow: 0 8px 40px rgba(0,0,0,.35);
    }
    header h1{margin:0; font-size:28px; letter-spacing:.3px}
    header .sub{color:var(--muted); margin-top:6px}
    .toolbar{position:absolute; right:16px; top:16px}
    .switch{
      padding:10px 14px; border-radius:14px;
      background:rgba(255,255,255,.06); color:#fff; border:1px solid rgba(255,255,255,.12);
      cursor:pointer; user-select:none
    }
    main{
      max-width:900px; margin:0 auto; padding:12px 14px 120px;
    }
    .panel{
      margin:14px; padding:14px; border-radius:24px;
      background:var(--panel); backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.08);
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    /* √úzenetek */
    .msg{max-width:780px; margin:18px auto; padding:0}
    .bubble{
      display:inline-block; max-width:100%;
      padding:16px 18px; border-radius:22px;
      word-wrap:break-word; line-height:1.45; letter-spacing:.2px;
      box-shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    .user .bubble{
      background: linear-gradient(180deg, var(--accent1), var(--accent2));
      color:#232323; font-weight:600;
    }
    .bot .bubble{
      background: rgba(12,14,18,.70);
      border:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(8px);
      color: var(--text);
    }

    /* Bot akci√≥gombok (felolvas√°s / m√°sol√°s) */
    .actions{display:flex; gap:12px; margin:12px 6px 0}
    .chip{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:14px; cursor:pointer;
      background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.14);
      color:#e9f2ff; font-weight:600; user-select:none;
    }
    .chip:hover{background: rgba(255,255,255,.12)}
    .chip .ico{font-size:18px}

    /* Input s√°v */
    .composer{
      position: fixed; left:0; right:0; bottom:0; z-index:10;
      display:flex; justify-content:center; padding:16px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,.55) 30%, rgba(0,0,0,.75));
    }
    .composer .box{
      width:min(920px, 96%); display:flex; gap:12px;
      padding:16px; border-radius:20px;
      background: rgba(17,21,28,.72); backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 30px rgba(0,0,0,.45);
    }
    .composer textarea{
      flex:1; resize:none; height:48px; padding:14px 16px; border-radius:12px;
      background: rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.14);
      color:#fff; outline:none; font-size:16px;
    }
    .composer button{
      min-width:110px; border:0; border-radius:14px; padding:0 18px;
      font-weight:700; font-size:16px; cursor:pointer;
      color:#232323; background: linear-gradient(180deg, var(--accent1), var(--accent2));
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
    }
    .composer button:disabled{opacity:.6; cursor:default}

    /* Copyright */
    footer{
      position:fixed; left:0; right:0; bottom:84px; z-index:5;
      text-align:center; color:rgba(255,255,255,.85); font-size:14px;
      text-shadow: 0 2px 16px rgba(0,0,0,.55);
    }

    /* Mobil finomhangol√°s */
    @media (max-width:640px){
      header{margin:10px; border-radius:20px}
      header h1{font-size:24px}
      .bubble{font-size:16px}
      .composer .box{width:98%}
      footer{font-size:13px}
    }
  </style>
</head>
<body>
  <div class="shade" aria-hidden="true"></div>

  <header>
    <h1>Tam√°s Mesters√©ges (AI)</h1>
    <div class="sub">Halad√≥ fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens</div>
    <div class="toolbar"><div id="theme" class="switch">Light / Dark<br><small>(auto)</small></div></div>
  </header>

  <main id="chat">
    <!-- k√∂sz√∂nt√©s -->
    <div class="msg bot panel">
      <div class="bubble">Szia! Itt vagyok neked, seg√≠tek mindenben. √çrj b√°tran! üòä</div>
      <div class="actions">
        <div class="chip speak"><span class="ico">üîä</span>Felolvas√°s</div>
        <div class="chip copy"><span class="ico">üìù</span>M√°sol√°s</div>
      </div>
    </div>
  </main>

  <footer>¬© Tam√°s AI ‚Äî v√©dett oldal. B√°rmilyen m√°sol√°s jogs√©rt√©snek min≈ës√ºl.</footer>

  <section class="composer">
    <div class="box">
      <textarea id="input" placeholder="√çrj ide‚Ä¶  Enter = k√ºld√©s"></textarea>
      <button id="send">K√ºld√©s</button>
    </div>
  </section>

<script>
  const chat = document.getElementById('chat');
  const ta   = document.getElementById('input');
  const btn  = document.getElementById('send');

  // kis seg√©d: bot √ºzenet DOM + felolvas√°s/m√°sol√°s
  function addBot(text){
    const m = document.createElement('div');
    m.className = 'msg bot panel';
    m.innerHTML = `
      <div class="bubble">${escapeHtml(text)}</div>
      <div class="actions">
        <div class="chip speak"><span class="ico">üîä</span>Felolvas√°s</div>
        <div class="chip copy"><span class="ico">üìù</span>M√°sol√°s</div>
      </div>`;
    chat.appendChild(m);
    m.querySelector('.speak').onclick = () => speak(text);
    m.querySelector('.copy').onclick  = () => copy(text);
    scroll();
  }
  function addUser(text){
    const m = document.createElement('div');
    m.className = 'msg user';
    m.innerHTML = `<div class="bubble">${escapeHtml(text)}</div>`;
    chat.appendChild(m); scroll();
  }
  function scroll(){ window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'}); }
  function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

  // Felolvas√°s
  function speak(text){
    try{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'hu-HU';
      speechSynthesis.speak(u);
    }catch(e){ console.warn(e); }
  }
  // M√°sol√°s
  async function copy(text){
    try{ await navigator.clipboard.writeText(text); }catch(e){}
  }

  // K√ºld√©s
  async function send(){
    const text = ta.value.trim();
    if(!text) return;
    addUser(text);
    ta.value=''; ta.focus(); btn.disabled=true;

    try{
      const r = await fetch('/.netlify/functions/chat', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ message: text })
      });
      if(!r.ok) throw new Error('HTTP '+r.status);
      const data = await r.json();
      addBot(data.reply || 'Hopp, most nem √©rtem el a modellt. Pr√≥b√°ld √∫jra p√°r m√°sodperc m√∫lva. üôÇ');
    }catch(e){
      console.error(e);
      addBot('Bocsi, most √©pp nem √©rem el a szervert. √çrj m√°sk√©nt: mit szeretn√©l pontosan? üòä');
    }finally{
      btn.disabled=false;
    }
  }
  btn.onclick = send;
  ta.addEventListener('keydown', (e)=>{
    if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }
  });

  // t√©ma v√°lt√°s ‚Äì most csak vizu√°lis jel
  document.getElementById('theme').onclick = ()=> {
    document.body.classList.toggle('light');
  };
</script>
</body>
</html>

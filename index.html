<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini AI Chat (CPU fallback)</title>
<style>
  :root{--bg:#0f1216;--card:#151a21;--ink:#e8ecf1;--muted:#a7b0bc;--accent:#7c5cff;}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(135deg,#0d1117,#111926);}
  .center{min-height:100svh;display:grid;place-items:center;padding:16px}
  .card{width:min(900px,100%);background:var(--card);border:1px solid #232b36;border-radius:20px;
        box-shadow:0 10px 30px rgba(0,0,0,.35);color:var(--ink);overflow:hidden}
  .hero{padding:28px 24px;border-bottom:1px solid #232b36;display:flex;gap:16px;align-items:center}
  .badge{padding:4px 10px;border:1px solid #303a47;border-radius:999px;font-size:12px;color:var(--muted)}
  .h1{font-size:22px;margin:4px 0 2px} .muted{color:var(--muted);font-size:14px}
  .chat{height:65svh;min-height:380px;overflow:auto;padding:16px;display:flex;flex-direction:column;gap:10px;background:#0e1319}
  .bubble{max-width:80%;padding:10px 12px;border-radius:14px;line-height:1.35;font-size:15px;white-space:pre-wrap;word-wrap:break-word}
  .bot{align-self:flex-start;background:#141b23;border:1px solid #2b3542}
  .me{align-self:flex-end;background:#1b2430;border:1px solid #334051}
  .footer{display:flex;gap:8px;padding:12px;border-top:1px solid #232b36;background:#0f141b}
  .typing{font-size:12px;color:#95a0b5;padding-left:6px}
</style>
</head>
<body>
<div class="center">
  <div class="card">
    <div class="hero">
      <div class="badge">Mini AI Chat</div>
      <div>
        <div class="h1">Az oldalt l√©trehozta: H.T ‚Äî Kellemes besz√©lget√©st! üéâ</div>
        <div class="muted">Ez a verzi√≥ CPU-n is fut, √≠gy mindig m≈±k√∂dik (lassabb lehet els≈ëre).</div>
      </div>
    </div>
    <div class="chat" id="chat"></div>
    <div class="footer">
      <input id="input" placeholder="√çrj ide... (Enter = k√ºld√©s)" />
      <button id="sendBtn">K√ºld√©s</button>
    </div>
    <div class="typing" id="typing"></div>
  </div>
</div>

<!-- WebLLM bet√∂lt√©se -->
<script src="https://unpkg.com/@mlc-ai/web-llm/dist/index.min.js"></script>
<script>
let engine = null;
let ready = false;
// CPU-bar√°t kis modell
const MODEL = "Qwen2.5-0.5B-Instruct-q0f16-MLC";

async function init(){
  try{
    engine = await webllm.CreateMLCEngine(MODEL,{
      initProgressCallback:(p)=>{
        document.getElementById("typing").textContent = 
          `Modell bet√∂lt√©se: ${Math.round((p.progress||0)*100)}%`;
      },
      // k√©nyszer√≠tett CPU fallback
      gpuDisabled: true
    });
    ready = true;
    document.getElementById("typing").textContent = "";
    addBubble("Szia! A mini AI k√©szen √°ll, √≠rj b√°tran. ü§ñ","bot");
  }catch(e){
    addBubble("Nem siker√ºlt bet√∂lteni a mini AI-t üò¢","bot");
  }
}
init();

const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("input");

function addBubble(text, who="bot"){
  const div=document.createElement("div");
  div.className=`bubble ${who==="me"?"me":"bot"}`;
  div.textContent=text;
  chatEl.appendChild(div);
  chatEl.scrollTop=chatEl.scrollHeight;
}

async function send(){
  const v=inputEl.value.trim();
  if(!v) return;
  addBubble(v,"me");
  inputEl.value="";
  document.getElementById("typing").textContent="‚Ä¶gondolkodom";
  if(!ready){ addBubble("A modell m√©g nem √°ll k√©szen.","bot"); return; }
  try{
    const out=await engine.chat.completions.create({
      messages:[{role:"system",content:"Magyarul, bar√°ts√°gosan v√°laszolj r√∂viden."},
                {role:"user",content:v}],
      temperature:0.7
    });
    const reply=out?.choices?.[0]?.message?.content || "Nincs v√°lasz.";
    addBubble(reply,"bot");
  }catch(e){ addBubble("Hiba: "+e,"bot"); }
  document.getElementById("typing").textContent="";
}
document.getElementById("sendBtn").addEventListener("click",send);
inputEl.addEventListener("keydown",e=>{ if(e.key==="Enter") send(); });
</script>
</body>
</html>

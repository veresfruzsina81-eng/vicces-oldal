<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>J√°t√©kok gy≈±jtem√©ny</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --txt:#e9eefc; --muted:#9db0d4; --border:rgba(255,255,255,.16);
  --glass:rgba(15,24,45,.72); --btn1:#2e5fff; --btn2:#1b47d8; --good:#57d79e; --bad:#ff6b6b;
  --pane:rgba(255,255,255,.06)
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,sans-serif;color:var(--txt);background:#070b14;overflow-x:hidden}

.bg{position:fixed;inset:-10% -10%;z-index:-1;filter:blur(40px);
  background:radial-gradient(40% 35% at 15% 20%,#2e5fff66,transparent 65%),
             radial-gradient(45% 35% at 85% 80%,#57d79e66,transparent 70%),
             radial-gradient(70% 60% at 50% 50%,#8a2eff33,transparent 70%),#090f1c;
  animation:bgMove 16s ease-in-out infinite alternate}
@keyframes bgMove{0%{transform:scale(1)}100%{transform:scale(1.1) translate(2%,2%)}}

.hide{display:none!important}
.screen{min-height:100vh;padding:80px 18px 40px;opacity:0;pointer-events:none;transform:translateY(8px);transition:.28s ease}
.screen.active{opacity:1;pointer-events:auto;transform:translateY(0)}
.container{max-width:1200px;margin:0 auto}
.title{margin:0 0 12px;font-size:28px;font-weight:800}
.card{border:1px solid var(--border);border-radius:18px;background:var(--pane);backdrop-filter:blur(10px);padding:16px}
.grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.row{display:flex;gap:8px;flex-wrap:wrap}
.btn{padding:10px 14px;border-radius:12px;border:0;cursor:pointer;color:#fff;font-weight:800;background:linear-gradient(180deg,var(--btn1),var(--btn2))}
.btn.secondary{background:#0f2142;color:var(--txt);border:1px solid var(--border)}
.muted{color:var(--muted)}
.backbar{position:sticky;top:70px;display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;z-index:10}
.gamewrap{border:1px solid var(--border);border-radius:18px;background:var(--pane);backdrop-filter:blur(10px);padding:16px}

.overlay{position:fixed;inset:0;display:grid;place-items:center;z-index:9999;background:#0008;backdrop-filter:blur(8px)}
.card-auth{width:min(94vw,560px);border:1px solid var(--border);border-radius:22px;background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.04));padding:22px}
.tabs{display:flex;gap:8px;margin:12px 0}
.tabs button{flex:1;padding:10px;border-radius:12px;border:0;background:#0f2142;color:var(--muted);cursor:pointer}
.tabs .active{background:var(--btn1);color:#fff}
.form label{font-size:13px;color:var(--muted);display:block;margin:6px 2px}
.form input{width:100%;padding:10px;border-radius:12px;border:1px solid var(--border);background:#0f2142;color:var(--txt)}
.note{font-size:13px}.ok{color:var(--good)}.err{color:var(--bad)}
.welcome{position:fixed;left:12px;top:12px;display:flex;gap:10px;align-items:center;background:#0f2142;padding:6px 12px;border-radius:12px;border:1px solid var(--border);z-index:1000}

/* Memory */
#m-grid{display:grid;gap:6px}
@media(min-width:1200px){#m-grid{grid-template-columns:repeat(15,1fr)}}
@media(min-width:900px) and (max-width:1199px){#m-grid{grid-template-columns:repeat(12,1fr)}}
@media(min-width:700px) and (max-width:899px){#m-grid{grid-template-columns:repeat(10,1fr)}}
@media(max-width:699px){#m-grid{grid-template-columns:repeat(8,1fr)}}
.mcard{background:#1b2a48;border-radius:8px;aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;font-size:28px;color:#fff;user-select:none;cursor:pointer}
.mcard.revealed{background:#2d4e8a}.mcard.matched{background:#2ecc71;color:#fff}

/* Snake */
#snake{background:#0c162b;border:1px solid var(--border);border-radius:10px;width:100%;max-width:800px;height:480px}
.slider{appearance:none;height:6px;border-radius:6px;background:#0f2142;outline:none;width:220px}
.slider::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:linear-gradient(180deg,var(--btn1),var(--btn2))}

/* RPS */
.mode-tabs{display:flex;gap:8px;background:rgba(255,255,255,.06);border:1px solid var(--border);padding:6px;border-radius:999px;justify-content:center}
.mode-tabs button{border:0;padding:8px 12px;border-radius:999px;background:transparent;color:#ccc;font-weight:700;cursor:pointer}
.mode-tabs .active{background:#0f2142;color:#fff}
.rps-choices{display:flex;gap:8px;flex-wrap:wrap}

/* Reflex */
#refbox{display:grid;place-items:center;height:220px;border:1px dashed var(--border);border-radius:12px;background:#0f2142;color:#fff}

/* Runner */
#runCanvas{background:#0c162b;border:1px solid var(--border);border-radius:10px;width:100%;max-width:1000px;height:360px;image-rendering:pixelated}
.hud{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin:8px 0}
</style>
</head>
<body>
<div class="bg"></div>

<!-- AUTH -->
<div id="auth" class="overlay">
  <div class="card-auth">
    <h3>Bel√©p√©s / Regisztr√°ci√≥</h3>
    <div class="tabs">
      <button id="tabL" class="active">Bel√©p√©s</button>
      <button id="tabR">Regisztr√°ci√≥</button>
    </div>
    <form id="formL" class="form">
      <label>Email</label><input name="email" type="email" required>
      <label>Jelsz√≥</label><input name="password" type="password" minlength="6" required>
      <div id="msgL" class="note"></div>
      <button class="btn" type="submit">Bel√©p√©s</button>
    </form>
    <form id="formR" class="form hide">
      <label>N√©v</label><input name="name" required>
      <label>Email</label><input name="email" type="email" required>
      <label>Jelsz√≥</label><input name="password" type="password" minlength="6" required>
      <div id="msgR" class="note"></div>
      <button class="btn" type="submit">Regisztr√°ci√≥</button>
    </form>
  </div>
</div>

<!-- WELCOME BAR -->
<div id="welcome" class="welcome hide">
  <span id="who"></span>
  <button id="logout" class="btn secondary">Kijelentkez√©s</button>
</div>
<!-- MEN√ú -->
<section id="screen-menu" class="screen active">
  <div class="container">
    <h2 class="title">üéÆ J√°t√©kok men√º</h2>
    <p class="muted">V√°lassz egy j√°t√©kot! K√ºl√∂n k√©perny≈ën ny√≠lik meg anim√°ltan.</p>
    <div class="grid">
      <div class="card"><h3>üß† Mem√≥ria</h3><p class="muted">60 p√°r (120 lap)</p><button class="btn" onclick="openScreen('screen-memory')">Megnyit√°s</button></div>
      <div class="card"><h3>üêç K√≠gy√≥</h3><p class="muted">Sebess√©g √°ll√≠that√≥</p><button class="btn" onclick="openScreen('screen-snake');snakeStart()">Megnyit√°s</button></div>
      <div class="card"><h3>‚úäüñê‚úå K≈ë‚ÄìPap√≠r‚ÄìOll√≥</h3><p class="muted">Hagyom√°nyos + Modern (-1)</p><button class="btn" onclick="openScreen('screen-rps')">Megnyit√°s</button></div>
      <div class="card"><h3>‚ö° Reflex</h3><p class="muted">5 k√∂r, √°tlagid≈ë</p><button class="btn" onclick="openScreen('screen-reflex')">Megnyit√°s</button></div>
      <div class="card"><h3>üçÑ Ugr√°l√≥s (Saj√°t f≈ëh≈ës)</h3><p class="muted">Nincsenek falak, csak ellens√©g!</p><button class="btn" onclick="openScreen('screen-runner');runnerStart()">Megnyit√°s</button></div>
    </div>
  </div>
</section>

<!-- MEM√ìRIA -->
<section id="screen-memory" class="screen hide">
  <div class="container">
    <div class="backbar">
      <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
      <button class="btn" onclick="startMemory()">√öjrakezd√©s</button>
    </div>
    <div class="gamewrap">
      <h3>üß† Mem√≥ria (60 p√°r)</h3>
      <div id="m-grid"></div>
      <p id="m-status" class="muted"></p>
    </div>
  </div>
</section>

<!-- SNAKE -->
<section id="screen-snake" class="screen hide">
  <div class="container">
    <div class="backbar">
      <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
      <div class="row">
        <button class="btn" onclick="snakeStart()">Start/Reset</button>
        <button class="btn secondary" onclick="setSnakePreset(4)">Lass√∫</button>
        <button class="btn secondary" onclick="setSnakePreset(8)">K√∂zepes</button>
        <button class="btn secondary" onclick="setSnakePreset(12)">Gyors</button>
        <input id="sn-speed" class="slider" type="range" min="3" max="15" value="8" step="1" oninput="setSnakeSpeed(this.value)">
      </div>
    </div>
    <div class="gamewrap" style="display:grid;place-items:center">
      <canvas id="snake" width="800" height="480"></canvas>
    </div>
    <div class="hud">
      <div>Pont: <b id="sn-score">0</b></div>
      <div>Rekord: <b id="sn-best">0</b></div>
      <div>Sebess√©g: <b id="sn-speed-label">8</b> fps</div>
    </div>
  </div>
</section>

<!-- RPS -->
<section id="screen-rps" class="screen hide">
  <div class="container">
    <div class="backbar">
      <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
      <button class="btn secondary" onclick="rpsReset()">Reset</button>
    </div>
    <div class="gamewrap">
      <h3>‚úäüñê‚úå K≈ë‚ÄìPap√≠r‚ÄìOll√≥</h3>
      <div class="mode-tabs">
        <button id="rps-mode-classic" class="active">Hagyom√°nyos</button>
        <button id="rps-mode-modern">Modern (-1 vesztes)</button>
      </div>
      <div class="rps-choices">
        <button class="btn secondary" onclick="rpsChoose('rock')">‚úä K≈ë</button>
        <button class="btn secondary" onclick="rpsChoose('paper')">üñê Pap√≠r</button>
        <button class="btn secondary" onclick="rpsChoose('scissors')">‚úå Oll√≥</button>
      </div>
      <div class="hud">
        <div>Te: <b id="rps-you">0</b></div>
        <div>G√©p: <b id="rps-bot">0</b></div>
        <div>M√≥d: <b id="rps-mode-label">Hagyom√°nyos</b></div>
      </div>
      <div id="rps-last" class="muted"></div>
    </div>
  </div>
</section>

<!-- REFLEX -->
<section id="screen-reflex" class="screen hide">
  <div class="container">
    <div class="backbar">
      <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
      <button class="btn" onclick="refStart()">Ind√≠t√°s</button>
    </div>
    <div class="gamewrap">
      <h3>‚ö° Reflex j√°t√©k</h3>
      <div id="refbox">Kattints az Ind√≠t√°sra!</div>
      <div class="hud">
        <div>K√∂r: <b id="ref-round">0</b>/5</div>
        <div>Utols√≥: <b id="ref-last">‚Äì</b> ms</div>
        <div>√Åtlag: <b id="ref-avg">‚Äì</b> ms</div>
      <div>Top: <b id="ref-best">‚Äì</b> ms</div>
      </div>
    </div>
  </div>
</section>

<!-- RUNNER (Ugr√°l√≥s, nincsenek falak ‚Äì csak ellens√©g) -->
<section id="screen-runner" class="screen hide">
  <div class="container">
    <div class="backbar">
      <button class="btn secondary" onclick="openScreen('screen-menu')">‚¨Ö Vissza</button>
      <div class="row">
        <label class="btn secondary">J√°t√©kos k√©p
          <input id="run-player-file" type="file" accept="image/*" style="display:none">
        </label>
        <label class="btn secondary">Ellens√©g k√©p
          <input id="run-enemy-file" type="file" accept="image/*" style="display:none">
        </label>
        <button class="btn" onclick="runnerStart()">Start / Reset</button>
        <button class="btn secondary" onclick="runnerClearImages()">Alap k√©pek</button>
      </div>
    </div>

    <div class="gamewrap" style="display:grid;place-items:center">
      <canvas id="runCanvas" width="1000" height="360"></canvas>
    </div>
    <div class="hud">
      <div>Pont: <b id="run-score">0</b></div>
      <div>Rekord: <b id="run-best">0</b></div>
      <div>Szint: <b id="run-level">1</b></div>
      <div class="muted">Ugr√°s: ‚¨Ü / Space ‚Ä¢ K√©pek a b√∂ng√©sz≈ëdben t√°rol√≥dnak (LocalStorage).</div>
    </div>
  </div>
</section>
<script>
/* ===== K√©perny≈ëv√°lt√°s (anim√°lt) ===== */
function openScreen(id){
  document.querySelectorAll('.screen').forEach(s=>{
    s.classList.add('hide'); s.classList.remove('active');
  });
  const el=document.getElementById(id);
  el.classList.remove('hide');
  requestAnimationFrame(()=>el.classList.add('active'));
  window.scrollTo({top:0,behavior:'smooth'});
  // esem√©ny a k√©perny≈ë megnyit√°s√°r√≥l (m√°s moduloknak)
  setTimeout(()=>window.dispatchEvent(new CustomEvent('screen:open',{detail:{id}})),0);
}
</script>

<script>
/* ===== Bel√©p√©s/Regisztr√°ci√≥ (LocalStorage + s√≥zott SHA-256) ===== */
(()=>{"use strict";
  const $=s=>document.querySelector(s);
  const auth=$("#auth"), tabL=$("#tabL"), tabR=$("#tabR"), formL=$("#formL"), formR=$("#formR"), msgL=$("#msgL"), msgR=$("#msgR");
  const welcome=$("#welcome"), who=$("#who"), logout=$("#logout");
  const K_USERS="au_users_v1", K_ME="au_me_v1";
  const load=(k,def)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? def }catch{ return def } };
  const save=(k,v)=> localStorage.setItem(k, JSON.stringify(v));

  function afterLogin(){
    auth.style.display="none";
    welcome.classList.remove("hide");
    const me=load(K_ME,null);
    if(me) who.textContent = `${me.name||'Felhaszn√°l√≥'} (${me.email})`;
    openScreen('screen-menu');
  }
  async function sha256(str){ const buf=await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str)); return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join(""); }
  function salt(len=16){ const a=new Uint8Array(len); crypto.getRandomValues(a); return Array.from(a).map(b=>b.toString(16).padStart(2,"0")).join(""); }

  function setTab(which){
    if(which==="L"){ tabL.classList.add("active"); tabR.classList.remove("active"); formL.classList.remove("hide"); formR.classList.add("hide"); msgL.textContent=""; msgR.textContent=""; }
    else{ tabR.classList.add("active"); tabL.classList.remove("active"); formR.classList.remove("hide"); formL.classList.add("hide"); msgL.textContent=""; msgR.textContent=""; }
  }
  tabL.onclick=()=>setTab("L"); tabR.onclick=()=>setTab("R");

  formR.addEventListener("submit", async (e)=>{
    e.preventDefault();
    const name=formR.name.value.trim(), email=formR.email.value.trim().toLowerCase(), pw=formR.password.value;
    if(!name||!email||pw.length<6){ msgR.textContent="T√∂lts ki mindent (min. 6 jelsz√≥)."; msgR.className="note err"; return; }
    const users=load(K_USERS,{});
    if(users[email]){ msgR.textContent="Ezzel az e-maillel m√°r van fi√≥k."; msgR.className="note err"; return; }
    const s=salt(), h=await sha256(pw+s);
    users[email]={name,email,salt:s,hash:h,createdAt:new Date().toISOString()};
    save(K_USERS,users); save(K_ME,{name,email,loginAt:new Date().toISOString()});
    afterLogin();
  });

  formL.addEventListener("submit", async (e)=>{
    e.preventDefault();
    const email=formL.email.value.trim().toLowerCase(), pw=formL.password.value;
    const users=load(K_USERS,{}), u=users[email];
    if(!u){ msgL.textContent="Nincs ilyen felhaszn√°l√≥."; msgL.className="note err"; return; }
    const h=await sha256(pw+u.salt);
    if(h!==u.hash){ msgL.textContent="Hib√°s jelsz√≥."; msgL.className="note err"; return; }
    save(K_ME,{name:u.name,email:u.email,loginAt:new Date().toISOString()});
    afterLogin();
  });

  logout.onclick=()=>{ localStorage.removeItem(K_ME); location.reload(); };
  if(localStorage.getItem(K_ME)){ afterLogin(); }
})();
</script>

<script>
/* ===== Mem√≥ria (60 p√°r = 120 lap) ===== */
let memFirst=null, memLock=false, memPairs=0;
function startMemory(){
  const grid=document.getElementById("m-grid");
  grid.innerHTML=""; document.getElementById("m-status").textContent="";
  memFirst=null; memLock=false; memPairs=0;

  const base=["üî•","‚ùÑÔ∏è","üåô","üåç","‚≠ê","üçÄ","‚ö°","üíé","üéµ","üé≤","üß©","üéØ","üöÄ","üåà","üçé","üçå","üçì","ü•ù","ü••","üåπ","üåª","üçÑ","üåµ","üêç","üê¢","ü¶ä","ü¶Å","üê∏","ü¶ë","üê¨","ü¶â","ü¶Ñ","üêâ","üëë","‚öîÔ∏è","üõ°Ô∏è","üèπ","üïπÔ∏è","üé®","üìö","üß≠","üîÆ","üí°","üß®","üéÅ","üéÜ","üèÜ","üìÄ","üì∑","üé¨","üé§","üéπ","ü•Å","üéª","üõ∏","üè∞","üß±","üö¶","üóø"];
  const symbols=[]; for(let i=0;i<60;i++) symbols.push(base[i%base.length]);
  let cards=[...symbols,...symbols]; cards.sort(()=>Math.random()-0.5);

  for(const sym of cards){
    const div=document.createElement("div");
    div.className="mcard"; div.dataset.sym=sym;
    div.onclick=()=>memFlip(div); grid.appendChild(div);
  }
}
function memFlip(card){
  if(memLock||card.classList.contains("revealed")||card.classList.contains("matched")) return;
  card.classList.add("revealed"); card.textContent=card.dataset.sym;
  if(!memFirst){ memFirst=card; return; }
  if(memFirst.dataset.sym===card.dataset.sym){
    memFirst.classList.add("matched"); card.classList.add("matched"); memFirst=null; memPairs++;
    if(memPairs===60) document.getElementById("m-status").textContent="üéâ Nyert√©l! Minden p√°r megvan!";
  }else{
    memLock=true;
    setTimeout(()=>{ card.classList.remove("revealed"); card.textContent=""; memFirst.classList.remove("revealed"); memFirst.textContent=""; memFirst=null; memLock=false; }, 650);
  }
}
window.addEventListener('screen:open',e=>{ if(e.detail?.id==='screen-memory') startMemory(); });
</script>

<script>
/* ===== Snake (√°ll√≠that√≥ sebess√©g) ===== */
let snCtx,snGrid=20,snX,snY,snVX,snVY,snTrail,snTail,snAppleX,snAppleY,snScore=0,snLoop,snSpeed=8,lastT=0,accT=0;
function setSnakeSpeed(v){ snSpeed=+v; document.getElementById('sn-speed-label').textContent=snSpeed; }
function setSnakePreset(v){ document.getElementById('sn-speed').value=v; setSnakeSpeed(v); }
function snakeStart(){
  const c=document.getElementById("snake"); snCtx=c.getContext("2d");
  snX=10; snY=10; snVX=1; snVY=0; snTrail=[]; snTail=5; snScore=0; lastT=performance.now(); accT=0;
  spawnApple(); updateHud();
  if(snLoop) cancelAnimationFrame(snLoop); snLoop=requestAnimationFrame(snakeLoop);
}
function spawnApple(){ const c=document.getElementById("snake"); snAppleX=Math.floor(Math.random()*(c.width/snGrid)); snAppleY=Math.floor(Math.random()*(c.height/snGrid)); }
function updateHud(){ document.getElementById("sn-score").textContent=snScore; const best=+localStorage.getItem("sn_best")||0; if(snScore>best) localStorage.setItem("sn_best",snScore); document.getElementById("sn-best").textContent=+localStorage.getItem("sn_best")||0; }
function snakeLoop(ts){
  const c=document.getElementById("snake"); const stepMs=1000/snSpeed; accT+=(ts-lastT); lastT=ts;
  while(accT>=stepMs){
    snX+=snVX; snY+=snVY;
    const maxX=Math.floor(c.width/snGrid), maxY=Math.floor(c.height/snGrid);
    if(snX<0) snX=maxX-1; if(snX>=maxX) snX=0; if(snY<0) snY=maxY-1; if(snY>=maxY) snY=0;
    for(const t of snTrail){ if(t.x===snX&&t.y===snY){ snTail=5; snScore=0; break; } }
    snTrail.push({x:snX,y:snY}); while(snTrail.length>snTail) snTrail.shift();
    if(snAppleX===snX && snAppleY===snY){ snTail++; snScore++; updateHud(); spawnApple(); }
    accT-=stepMs;
  }
  snCtx.fillStyle="#0c162b"; snCtx.fillRect(0,0,c.width,c.height);
  snCtx.fillStyle="#57d79e"; snCtx.fillRect(snAppleX*snGrid, snAppleY*snGrid, snGrid-2, snGrid-2);
  snCtx.fillStyle="#6ea8ff"; for(const p of snTrail){ snCtx.fillRect(p.x*snGrid, p.y*snGrid, snGrid-2, snGrid-2); }
  snLoop=requestAnimationFrame(snakeLoop);
}
addEventListener("keydown",e=>{
  const k=e.key.toLowerCase();
  if(k==="arrowleft"||k==="a"){ if(snVX!==1){ snVX=-1; snVY=0; } }
  if(k==="arrowright"||k==="d"){ if(snVX!==-1){ snVX=1; snVY=0; } }
  if(k==="arrowup"||k==="w"){ if(snVY!==1){ snVY=-1; snVX=0; } }
  if(k==="arrowdown"||k==="s"){ if(snVY!==-1){ snVY=1; snVX=0; } }
});
window.addEventListener('screen:open',e=>{ if(e.detail?.id==='screen-snake'){ const s=document.getElementById('sn-speed'); if(s) setSnakeSpeed(s.value); }});
</script>

<script>
/* ===== K≈ë‚ÄìPap√≠r‚ÄìOll√≥ ===== */
let rpsYou=0, rpsBot=0, rpsMode="classic";
const rpsWins={rock:"scissors",paper:"rock",scissors:"paper"};
function rpsSetMode(m){
  rpsMode=m; document.getElementById("rps-mode-label").textContent=(m==="classic"?"Hagyom√°nyos":"Modern (-1 vesztes)");
  document.getElementById("rps-mode-classic").classList.toggle("active",m==="classic");
  document.getElementById("rps-mode-modern").classList.toggle("active",m==="modern");
}
document.getElementById("rps-mode-classic").onclick=()=>rpsSetMode("classic");
document.getElementById("rps-mode-modern").onclick=()=>rpsSetMode("modern");
function rpsReset(){ rpsYou=0; rpsBot=0; rpsUpdate(); document.getElementById("rps-last").textContent=""; }
function rpsUpdate(){ document.getElementById("rps-you").textContent=rpsYou; document.getElementById("rps-bot").textContent=rpsBot; }
function icon(x){ return x==="rock"?"‚úä":x==="paper"?"üñê":"‚úå"; }
function rpsChoose(you){
  const bot=["rock","paper","scissors"][Math.floor(Math.random()*3)];
  let msg=`Te: ${icon(you)} | G√©p: ${icon(bot)} ‚Üí `;
  if(you===bot) msg+="D√∂ntetlen.";
  else if(rpsWins[you]===bot){ msg+="Nyert√©l! "; rpsYou+=1; }
  else{ msg+="Vesztett√©l. "; if(rpsMode==="modern"){ rpsYou-=1; } rpsBot+=1; }
  rpsUpdate(); document.getElementById("rps-last").textContent=msg;
}
</script>

<script>
/* ===== Reflex j√°t√©k ===== */
const K_REF="ref_best_v1"; let refRound=0, refWaiting=false, refStartTime=0, refTimes=[];
function refStart(){ refRound=0; refTimes=[]; document.getElementById("ref-last").textContent="‚Äì"; document.getElementById("ref-avg").textContent="‚Äì"; nextRound(); }
function nextRound(){
  refRound++; if(refRound>5){ finishRef(); return; }
  document.getElementById("ref-round").textContent=refRound;
  const box=document.getElementById("refbox"); box.style.background="#0f2142"; box.textContent="V√°rj..."; refWaiting=true;
  setTimeout(()=>{ box.style.background="#1f8f54"; box.textContent="KATT!"; refWaiting=false; refStartTime=performance.now(); }, 600+Math.random()*1800);
}
document.getElementById("refbox").addEventListener("click", ()=>{
  const box=document.getElementById("refbox");
  if(refRound===0) return;
  if(refWaiting){ box.style.background="#b63a3a"; box.textContent="Korai! - √∫jra"; setTimeout(nextRound,650); return; }
  const t=Math.round(performance.now()-refStartTime);
  refTimes.push(t); document.getElementById("ref-last").textContent=t;
  const avg=Math.round(refTimes.reduce((a,b)=>a+b,0)/refTimes.length); document.getElementById("ref-avg").textContent=avg;
  setTimeout(nextRound,550);
});
function finishRef(){
  const avg=Math.round(refTimes.reduce((a,b)=>a+b,0)/refTimes.length);
  const best=+localStorage.getItem(K_REF)||9999; if(avg<best) localStorage.setItem(K_REF,avg);
  document.getElementById("ref-best").textContent=localStorage.getItem(K_REF)||avg;
  const box=document.getElementById("refbox"); box.style.background="#0f2142"; box.textContent="K√©sz! √öjra az Ind√≠t√°ssal.";
}
document.getElementById("ref-best").textContent=localStorage.getItem(K_REF)||"‚Äì";
</script>

<script>
/* ===== Ugr√°l√≥s (Runner) ‚Äî nincsenek falak, csak ellens√©gek + szintek ===== */
(()=>{"use strict";
  const K_P="runner_player_img_v1", K_E="runner_enemy_img_v1", K_B="runner_best_v1";
  const cvs=document.getElementById("runCanvas"), ctx=cvs.getContext("2d");
  const dpr=Math.max(1,Math.floor(window.devicePixelRatio||1));
  function fit(){ const cssW=Math.max(320, Math.min(1000, cvs.parentElement.clientWidth||1000)); const cssH=360;
    cvs.style.width=cssW+"px"; cvs.style.height=cssH+"px"; cvs.width=Math.floor(cssW*dpr); cvs.height=Math.floor(cssH*dpr); ctx.setTransform(dpr,0,0,dpr,0,0); }
  function fitIfVisible(){ const scr=document.getElementById('screen-runner'); if(scr.classList.contains('active')) fit(); }
  window.addEventListener('screen:open',e=>{ if(e.detail?.id==='screen-runner') setTimeout(fit,0); }); addEventListener('resize', fitIfVisible);

  // alap ‚Äûikonok‚Äù (ha nincs saj√°t k√©p)
  const imgPlayer=new Image(), imgEnemy=new Image();
  const defPlayer="data:image/svg+xml;base64,"+btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='48' height='48'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='#ff6a6a'/><stop offset='1' stop-color='#ffb86a'/></linearGradient></defs><rect width='48' height='48' rx='10' fill='url(#g)'/><circle cx='24' cy='16' r='7' fill='#fff'/><rect x='13' y='25' width='22' height='14' rx='7' fill='#fff'/></svg>`);
  const defEnemy ="data:image/svg+xml;base64,"+btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='40' height='28'><rect width='40' height='28' rx='6' fill='#8e44ad'/><circle cx='14' cy='12' r='3' fill='#fff'/><circle cx='26' cy='12' r='3' fill='#fff'/><rect x='10' y='20' width='20' height='4' rx='2' fill='#fff'/></svg>`);
  imgPlayer.src=localStorage.getItem(K_P)||defPlayer; imgEnemy.src=localStorage.getItem(K_E)||defEnemy;

  // √°llapot
  const GROUND=260;
  let running=false, last=0, acc=0, step=16;
  let player, enemies=[], score=0, best=+localStorage.getItem(K_B)||0, level=1, levelTime=0;
  // spawn/id≈ëz√≠t√©s
  let spawnTimer=0, spawnEvery=1200; // ms ‚Äî ez cs√∂kken szintenk√©nt

  function resetPlayer(){ player={ x:60, y:GROUND-44, vy:0, w:44, h:44, jump(){ if(this.y>=GROUND-this.h-0.5) this.vy=-13; } }; }
  function speedX(){ return 2.6 + (level-1)*0.25; } // szintenk√©nt gyorsul
  function spawnEnemy(){ // csak ellens√©g j√∂n, nincs fal
    if(enemies.length>6) return;
    enemies.push({ x:cvs.width/dpr+20, y:GROUND-28, w:40, h:28, vx:-(speedX()+0.2) });
  }

  function stepGame(dt){
    // h√°tt√©r √©s ‚Äûf√∂ld‚Äù
    ctx.clearRect(0,0,cvs.width,cvs.height);
    ctx.fillStyle="#152542"; ctx.fillRect(0, GROUND+44, cvs.width, 10);
    ctx.fillStyle="#1b2a48"; ctx.fillRect(0, GROUND+20, cvs.width, 24);

    // fizika
    player.vy+=0.75; player.y+=player.vy; if(player.y>GROUND-player.h){ player.y=GROUND-player.h; player.vy=0; }

    // ellens√©gek
    for(const e of enemies){ e.x += -(speedX()); if(imgEnemy.complete&&imgEnemy.naturalWidth) ctx.drawImage(imgEnemy,e.x,e.y,e.w,e.h); else { ctx.fillStyle="#8e44ad"; ctx.fillRect(e.x,e.y,e.w,e.h); } }
    enemies=enemies.filter(e=>e.x+e.w>-50);

    // player rajz (lekerek√≠tve, hogy a fot√≥ sz√©pen n√©zzen ki)
    ctx.save(); ctx.beginPath(); ctx.roundRect(player.x,player.y,player.w,player.h,10); ctx.clip();
    if(imgPlayer.complete&&imgPlayer.naturalWidth) ctx.drawImage(imgPlayer,player.x,player.y,player.w,player.h); else { ctx.fillStyle="#ffb86a"; ctx.fillRect(player.x,player.y,player.w,player.h); }
    ctx.restore();

    // pont + szintid≈ë
    score += dt*0.01; levelTime += dt;
    document.getElementById("run-score").textContent=Math.floor(score);
    document.getElementById("run-best").textContent=best;
    document.getElementById("run-level").textContent=level;

    // √ºtk√∂z√©s
    const hit=(a,b)=> a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;
    for(const e of enemies){ if(hit(player,e)) return gameOver(); }
  }

  function gameOver(){
    running=false; best=Math.max(best,Math.floor(score)); localStorage.setItem(K_B,best);
    ctx.fillStyle="rgba(0,0,0,.45)"; ctx.fillRect(0,0,cvs.width,cvs.height);
    ctx.fillStyle="#fff"; ctx.font="bold 24px Inter, sans-serif"; ctx.textAlign="center";
    ctx.fillText("üí• Game Over ‚Äì Start/Reset!", cvs.width/2/dpr, 140);
  }

  function loop(ts){
    if(!running) return;
    if(!last) last=ts;
    const dt=ts-last; last=ts; acc+=dt; spawnTimer+=dt;

    // szintl√©p√©s 20 mp-enk√©nt
    if(levelTime>=20000){ level++; levelTime=0; spawnEvery=Math.max(600, spawnEvery-100); }

    if(spawnTimer>=spawnEvery){ spawnTimer=0; spawnEnemy(); }
    while(acc>=step){ stepGame(step); acc-=step; }
    requestAnimationFrame(loop);
  }

  function start(){
    fitIfVisible();
    score=0; level=1; levelTime=0; best=+localStorage.getItem(K_B)||0;
    enemies=[]; spawnTimer=0; spawnEvery=1200; last=0; acc=0; running=true;
    resetPlayer(); requestAnimationFrame(loop);
  }

  // publik
  window.runnerStart=start;
  window.runnerClearImages=function(){ localStorage.removeItem(K_P); localStorage.removeItem(K_E); imgPlayer.src=defPlayer; imgEnemy.src=defEnemy; resetPlayer(); };

  // input
  cvs.addEventListener('pointerdown', ()=> running && player && player.jump());
  addEventListener('keydown', e=>{ const k=e.key.toLowerCase(); if(k===' '||k==='arrowup'||k==='w'){ e.preventDefault(); if(running&&player) player.jump(); }},{passive:false});

  // felt√∂lt√©s
  document.getElementById('run-player-file').addEventListener('change',ev=>{
    const f=ev.target.files?.[0]; if(!f) return; const rd=new FileReader();
    rd.onload=()=>{ try{ localStorage.setItem(K_P, rd.result); imgPlayer.src=rd.result; resetPlayer(); }catch(e){} }; rd.readAsDataURL(f);
  });
  document.getElementById('run-enemy-file').addEventListener('change',ev=>{
    const f=ev.target.files?.[0]; if(!f) return; const rd=new FileReader();
    rd.onload=()=>{ try{ localStorage.setItem(K_E, rd.result); imgEnemy.src=rd.result; }catch(e){} }; rd.readAsDataURL(f);
  });

  // indul√≥ layout
  fit();
})();
</script>
<script>
/* ===== Runner jav√≠t√°s: k√∂nnyebb j√°t√©k, kontroll√°lt spawn, neh√©zs√©g v√°laszt√≥ ===== */
(function(){
  const cvs = document.getElementById('runCanvas');
  if(!cvs) return;
  const ctx = cvs.getContext('2d');
  const dpr = Math.max(1, Math.floor(window.devicePixelRatio||1));

  // --- UI: neh√©zs√©g gombok besz√∫r√°sa (ha m√©g nincsenek) ---
  (function injectDifficultyButtons(){
    const bar = document.querySelector('#screen-runner .backbar .row');
    if(!bar || bar.querySelector('[data-diff]')) return;
    const mk=(txt,val)=>{ const b=document.createElement('button'); b.className='btn secondary'; b.textContent=txt; b.dataset.diff=val; return b; };
    const bEasy=mk('K√∂nny≈±','easy'), bNorm=mk('K√∂zepes','normal'), bHard=mk('Neh√©z','hard');
    bar.prepend(bHard); bar.prepend(bNorm); bar.prepend(bEasy);
    bar.addEventListener('click', (e)=>{ const d=e.target?.dataset?.diff; if(d){ setDifficulty(d); highlight(d); } });
    function highlight(which){
      [bEasy,bNorm,bHard].forEach(btn=>btn.classList.toggle('secondary', btn.dataset.diff!==which));
    }
    highlight('easy');
  })();

  // --- be√°ll√≠t√°sok (neh√©zs√©g) ---
  const DIFFS = {
    easy:   { baseSpeed:2.2, spawnEvery:[1400,1700], minGap:320, maxSimul:2, gravity:0.60, jumpV:-14.5 },
    normal: { baseSpeed:2.8, spawnEvery:[1000,1400], minGap:260, maxSimul:3, gravity:0.70, jumpV:-13.5 },
    hard:   { baseSpeed:3.4, spawnEvery:[800,1100],  minGap:220, maxSimul:4, gravity:0.78, jumpV:-13.0 }
  };
  let DIFF = DIFFS.easy;

  function setDifficulty(name){
    DIFF = DIFFS[name] || DIFFS.easy;
    // ha √©pp a runner k√©perny≈ën vagyunk, resetelj√ºnk az √∫j param√©terekkel
    const scr = document.getElementById('screen-runner');
    if(scr && scr.classList.contains('active')) window.runnerStart();
  }

  // --- state ---
  const K_P="runner_player_img_v1", K_E="runner_enemy_img_v1", K_B="runner_best_v1";
  const imgPlayer=new Image(), imgEnemy=new Image();
  const defPlayer="data:image/svg+xml;base64,"+btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='48' height='48'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='#ff6a6a'/><stop offset='1' stop-color='#ffb86a'/></linearGradient></defs><rect width='48' height='48' rx='10' fill='url(#g)'/><circle cx='24' cy='16' r='7' fill='#fff'/><rect x='13' y='25' width='22' height='14' rx='7' fill='#fff'/></svg>`);
  const defEnemy ="data:image/svg+xml;base64,"+btoa(`<svg xmlns='http://www.w3.org/2000/svg' width='40' height='28'><rect width='40' height='28' rx='6' fill='#8e44ad'/><circle cx='14' cy='12' r='3' fill='#fff'/><circle cx='26' cy='12' r='3' fill='#fff'/><rect x='10' y='20' width='20' height='4' rx='2' fill='#fff'/></svg>`);
  imgPlayer.src=localStorage.getItem(K_P)||defPlayer;
  imgEnemy.src =localStorage.getItem(K_E)||defEnemy;

  const GROUND=260;
  let running=false,last=0,acc=0,step=16;
  let player,enemies=[],score=0,best=+localStorage.getItem(K_B)||0,level=1,levelTime=0;
  let spawnTimer=0,nextSpawn=1500,lastEnemyX=-9999;

  // ‚Äûmegbocs√°t√≥‚Äù ugr√°s
  const COYOTE_MS=140;        // f√∂ld elhagy√°sa ut√°n m√©g ennyi ideig ugorhat
  const JUMP_BUFFER_MS=140;   // ha picit kor√°bban nyomta, pufferb≈ël v√©grehajtjuk
  let sinceGroundMs=9999, jumpBufferMs=9999;

  function fit(){ const cssW=Math.max(320,Math.min(1000,cvs.parentElement.clientWidth||1000));
    const cssH=360; cvs.style.width=cssW+'px'; cvs.style.height=cssH+'px';
    cvs.width=Math.floor(cssW*dpr); cvs.height=Math.floor(cssH*dpr); ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  function fitIfVisible(){ const scr=document.getElementById('screen-runner'); if(scr.classList.contains('active')) fit(); }
  window.addEventListener('screen:open',e=>{ if(e.detail?.id==='screen-runner') setTimeout(fit,0); });
  addEventListener('resize', fitIfVisible);

  function resetPlayer(){
    player={ x:60, y:GROUND-44, vy:0, w:44, h:44,
      onGround(){ return this.y>=GROUND-this.h-0.5; },
      jump(){
        // coyote vagy puffer alapj√°n is engedj√ºk
        if(this.onGround() || sinceGroundMs<=COYOTE_MS){
          this.vy = DIFF.jumpV; jumpBufferMs=9999; // elhaszn√°ljuk
        }else{
          // ha leveg≈ëben van, pufferelj√ºk
          jumpBufferMs = 0;
        }
      }
    };
  }

  function speedX(){ return DIFF.baseSpeed + (level-1)*0.20; } // enyhe gyorsul√°s szintenk√©nt

  function canSpawn(){
    // egyszerre 1 spawn esem√©ny, √©s legyen min. t√°vols√°g az utols√≥hoz k√©pest
    const minGap = DIFF.minGap;
    const pxSinceLast = Math.abs((cvs.width/dpr) - lastEnemyX);
    return enemies.length < DIFF.maxSimul && pxSinceLast >= minGap;
  }

  function spawnEnemy(){
    if(!canSpawn()) return;
    const h=28, w=40;
    const e = { x:cvs.width/dpr+20, y:GROUND-h, w, h, vx:-speedX() };
    enemies.push(e);
    lastEnemyX = e.x;
  }

  function rect(a,b){ return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y; }

  function stepGame(dt){
    ctx.clearRect(0,0,cvs.width,cvs.height);
    // f√∂ld
    ctx.fillStyle="#152542"; ctx.fillRect(0, GROUND+44, cvs.width, 10);
    ctx.fillStyle="#1b2a48"; ctx.fillRect(0, GROUND+20, cvs.width, 24);

    // pufferelt ugr√°s v√©grehajt√°sa, ha le√©rkezett
    if(player.onGround() && jumpBufferMs<=JUMP_BUFFER_MS){ player.vy=DIFF.jumpV; jumpBufferMs=9999; }

    // gravit√°ci√≥
    player.vy += DIFF.gravity; player.y += player.vy;
    if(player.onGround()){ player.y=GROUND-player.h; player.vy=0; sinceGroundMs=0; } else { sinceGroundMs+=dt; }

    // ellens√©gek mozgat√°sa √©s kirajz
    for(const e of enemies){
      e.x += -speedX();
      if(imgEnemy.complete&&imgEnemy.naturalWidth) ctx.drawImage(imgEnemy,e.x,e.y,e.w,e.h);
      else{ ctx.fillStyle="#8e44ad"; ctx.fillRect(e.x,e.y,e.w,e.h); }
    }
    enemies = enemies.filter(e=>e.x+e.w>-50);

    // player rajz
    ctx.save(); ctx.beginPath(); ctx.roundRect(player.x,player.y,player.w,player.h,10); ctx.clip();
    if(imgPlayer.complete&&imgPlayer.naturalWidth) ctx.drawImage(imgPlayer,player.x,player.y,player.w,player.h);
    else{ ctx.fillStyle="#ffb86a"; ctx.fillRect(player.x,player.y,player.w,player.h); }
    ctx.restore();

    // pont + szint UI
    score += dt*0.01; levelTime += dt;
    document.getElementById('run-score').textContent = Math.floor(score);
    document.getElementById('run-best').textContent  = best;
    document.getElementById('run-level').textContent = level;

    // √ºtk√∂z√©s
    for(const e of enemies){ if(rect(player,e)) return gameOver(); }
  }

  function gameOver(){
    running=false;
    best=Math.max(best,Math.floor(score)); localStorage.setItem(K_B,best);
    ctx.fillStyle="rgba(0,0,0,.45)"; ctx.fillRect(0,0,cvs.width,cvs.height);
    ctx.fillStyle="#fff"; ctx.font="bold 24px Inter, sans-serif"; ctx.textAlign="center";
    ctx.fillText("üí• Game Over ‚Äì Start/Reset!", cvs.width/2/dpr, 140);
  }

  function loop(ts){
    if(!running) return;
    if(!last) last=ts;
    const dt=ts-last; last=ts; acc+=dt; spawnTimer+=dt;

    // szint 20 mp-k√©nt, de neh√©zs√©gi intervallumokat is tartjuk
    if(levelTime>=20000){ level++; levelTime=0; }

    const [minEvery,maxEvery] = DIFF.spawnEvery;
    if(spawnTimer >= nextSpawn){
      spawnTimer = 0;
      // k√∂vetkez≈ë spawn id≈ë (random az intervallumban)
      nextSpawn = Math.random()*(maxEvery-minEvery)+minEvery;
      spawnEnemy();
    }

    while(acc>=step){ stepGame(step); acc-=step; }
    requestAnimationFrame(loop);
  }

  function fitNow(){ const scr=document.getElementById('screen-runner'); if(scr && scr.classList.contains('active')) fit(); }

  // nyilv√°nos ind√≠t√≥ FEL√úL√çR√ÅSA
  window.runnerStart = function(){
    fitNow();
    score=0; level=1; levelTime=0; best=+localStorage.getItem(K_B)||0;
    enemies=[]; spawnTimer=0; nextSpawn=DIFF.spawnEvery[0]; lastEnemyX=-9999;
    sinceGroundMs=9999; jumpBufferMs=9999;
    last=0; acc=0; running=true;
    resetPlayer(); requestAnimationFrame(loop);
  };

  // k√©pfelt√∂lt√©s esem√©nyek √∫jrahuzaloz√°sa (ha az eredetiek nem lenn√©nek)
  const pf=document.getElementById('run-player-file'), ef=document.getElementById('run-enemy-file');
  if(pf && !pf.__wired){ pf.__wired=true; pf.addEventListener('change',ev=>{ const f=ev.target.files?.[0]; if(!f) return; const rd=new FileReader(); rd.onload=()=>{ try{ localStorage.setItem(K_P,rd.result); imgPlayer.src=rd.result; resetPlayer(); }catch(e){} }; rd.readAsDataURL(f); }); }
  if(ef && !ef.__wired){ ef.__wired=true; ef.addEventListener('change',ev=>{ const f=ev.target.files?.[0]; if(!f) return; const rd=new FileReader(); rd.onload=()=>{ try{ localStorage.setItem(K_E,rd.result); imgEnemy.src=rd.result; }catch(e){} }; rd.readAsDataURL(f); }); }

  window.runnerClearImages = function(){ localStorage.removeItem(K_P); localStorage.removeItem(K_E); imgPlayer.src=defPlayer; imgEnemy.src=defEnemy; resetPlayer(); };

  // input ‚Äì coyote/jump buffer t√°mogat√°ssal
  cvs.addEventListener('pointerdown', ()=> running && player && player.jump());
  addEventListener('keydown', e=>{
    const k=e.key.toLowerCase();
    if(k===' '||k==='arrowup'||k==='w'){ e.preventDefault(); if(running && player) player.jump(); }
  }, {passive:false});
})();
</script>

</body>
</html>

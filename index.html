<!-- ==== AUTH WIDGET (paste this before </body>) ==== -->
<style>
  :root{--auth-txt:#e9eefc;--auth-muted:#9db0d4;--auth-border:rgba(255,255,255,.16);--auth-bg:rgba(10,18,36,.86);--auth-btn1:#2e5fff;--auth-btn2:#1b47d8}
  .auth-hide{display:none!important}
  .auth-fab{
    position:fixed; right:18px; bottom:18px; z-index:9999;
    padding:12px 14px; border-radius:14px; border:0; cursor:pointer;
    color:#fff; font-weight:700; box-shadow:0 10px 24px rgba(0,0,0,.35);
    background:linear-gradient(180deg,var(--auth-btn1),var(--auth-btn2));
  }
  .auth-panel{
    position:fixed; inset:0; z-index:9998; display:grid; place-items:center;
    background:rgba(0,0,0,.45);
  }
  .auth-card{
    width:min(94vw,520px); border:1px solid var(--auth-border); border-radius:20px;
    background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));
    color:var(--auth-txt); backdrop-filter: blur(12px); box-shadow:0 20px 60px rgba(0,0,0,.45);
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; padding:20px;
  }
  .auth-top{display:flex;justify-content:space-between;align-items:center;gap:10px}
  .auth-top h3{margin:0;font-size:20px}
  .auth-x{background:transparent;color:var(--auth-txt);border:0;font-size:18px;cursor:pointer;opacity:.8}
  .auth-tabs{margin:14px 0;display:flex;gap:8px}
  .auth-tabs button{
    flex:1;border-radius:999px;padding:10px;border:1px solid var(--auth-border);
    background:rgba(255,255,255,.06); color:var(--auth-muted);font-weight:700;cursor:pointer
  }
  .auth-tabs .active{background:#0f2142;color:#fff}
  .auth-form label{display:block;font-size:13px;color:var(--auth-muted);margin:10px 2px}
  .auth-form input{
    width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--auth-border);
    background:var(--auth-bg); color:var(--auth-txt); outline:none
  }
  .auth-form input:focus{box-shadow:0 0 0 4px rgba(46,95,255,.18); border-color:#2e5fff}
  .auth-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .auth-btn{width:100%;padding:12px 14px;border-radius:12px;border:0;cursor:pointer;
    background:linear-gradient(180deg,var(--auth-btn1),var(--auth-btn2)); color:#fff; font-weight:800}
  .auth-note{font-size:13px;margin-top:6px}
  .auth-ok{color:#57d79e} .auth-err{color:#ff6b6b}
  /* gated content */
  [data-auth="required"]{display:none}
  .auth-banner{
    position:fixed; left:50%; transform:translateX(-50%); bottom:84px; z-index:9999;
    background:rgba(15,33,66,.95); color:#fff; border:1px solid var(--auth-border); border-radius:12px;
    padding:10px 14px; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; display:none
  }
</style>

<div id="auth-fab" class="auth-fab">üîë Bel√©p√©s / Regisztr√°ci√≥</div>
<div id="auth-banner" class="auth-banner"></div>

<div id="auth-panel" class="auth-panel auth-hide" aria-hidden="true">
  <div class="auth-card" role="dialog" aria-modal="true">
    <div class="auth-top">
      <h3>Fi√≥k</h3>
      <button class="auth-x" id="auth-close" aria-label="Bez√°r√°s">‚úï</button>
    </div>

    <div class="auth-tabs">
      <button id="auth-tab-login" class="active">Bel√©p√©s</button>
      <button id="auth-tab-reg">Regisztr√°ci√≥</button>
    </div>

    <!-- Login -->
    <form id="auth-form-login" class="auth-form" autocomplete="on">
      <label>E-mail</label>
      <input type="email" name="email" placeholder="te@pelda.hu" required />
      <label>Jelsz√≥</label>
      <input type="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6" />
      <div id="auth-msg-login" class="auth-note"></div>
      <div style="margin-top:12px"><button class="auth-btn" type="submit">Bel√©p√©s</button></div>
    </form>

    <!-- Register -->
    <form id="auth-form-reg" class="auth-form auth-hide" autocomplete="on">
      <div class="auth-row">
        <div>
          <label>N√©v</label>
          <input type="text" name="name" placeholder="Teljes neved" required />
        </div>
        <div>
          <label>E-mail</label>
          <input type="email" name="email" placeholder="te@pelda.hu" required />
        </div>
      </div>
      <label>Jelsz√≥ (min. 6)</label>
      <input type="password" name="password" placeholder="legal√°bb 6 karakter" required minlength="6" />
      <div id="auth-msg-reg" class="auth-note"></div>
      <div style="margin-top:12px"><button class="auth-btn" type="submit">Fi√≥k l√©trehoz√°sa</button></div>
    </form>

    <div class="auth-note" style="margin-top:10px;color:var(--auth-muted)">
      * Gyors, kliensoldali megold√°s (LocalStorage). √âleshez szerveres auth aj√°nlott.
    </div>
  </div>
</div>

<script>
(()=>{"use strict";
  const $=s=>document.querySelector(s);
  const panel=$("#auth-panel"), fab=$("#auth-fab");
  const tabLogin=$("#auth-tab-login"), tabReg=$("#auth-tab-reg");
  const fLogin=$("#auth-form-login"), fReg=$("#auth-form-reg");
  const msgLogin=$("#auth-msg-login"), msgReg=$("#auth-msg-reg");
  const banner=$("#auth-banner");
  const LS_USERS="auth_users_v1";  // { email: {name,email,salt,hash,createdAt} }
  const LS_ME="auth_me_v1";        // { name,email,loginAt }
  const LS_ATT="auth_attempts_v1"; // brute-force korl√°toz√°s

  function show(el){ el.classList.remove("auth-hide"); el.setAttribute("aria-hidden","false"); }
  function hide(el){ el.classList.add("auth-hide"); el.setAttribute("aria-hidden","true"); }
  function toast(txt){
    banner.textContent = txt; banner.style.display="block";
    setTimeout(()=>{banner.style.display="none"}, 2200);
  }
  function setTab(which){
    if(which==="login"){
      tabLogin.classList.add("active"); tabReg.classList.remove("active");
      show(fLogin); hide(fReg); msgLogin.textContent=""; msgReg.textContent="";
    }else{
      tabReg.classList.add("active"); tabLogin.classList.remove("active");
      show(fReg); hide(fLogin); msgLogin.textContent=""; msgReg.textContent="";
    }
  }
  tabLogin.onclick=()=>setTab("login");
  tabReg.onclick=()=>setTab("reg");
  $("#auth-close").onclick=()=>hide(panel);
  fab.onclick=()=>{ show(panel); };

  // ---- Helpers: storage ----
  const load = (k,def)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? def }catch{ return def }};
  const save = (k,v)=> localStorage.setItem(k, JSON.stringify(v));

  // ---- Password hashing (SHA-256 + per-user salt) ----
  async function sha256(str){
    const enc = new TextEncoder().encode(str);
    const buf = await crypto.subtle.digest("SHA-256", enc);
    return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
  }
  function randSalt(len=16){
    const a = new Uint8Array(len); crypto.getRandomValues(a);
    return Array.from(a).map(b=>b.toString(16).padStart(2,"0")).join("");
  }

  // ---- Brute-force v√©delem (egyszer≈±) ----
  function attemptAllowed(email){
    const data = load(LS_ATT,{});
    const now = Date.now();
    const rec = data[email] || {fails:0, until:0};
    if(rec.until && now < rec.until) return {ok:false, wait: Math.ceil((rec.until-now)/1000)};
    return {ok:true};
  }
  function recordAttempt(email, ok){
    const data = load(LS_ATT,{});
    const rec = data[email] || {fails:0, until:0};
    if(ok){ data[email] = {fails:0, until:0}; }
    else{
      rec.fails = (rec.fails||0)+1;
      if(rec.fails>=5){ rec.until = Date.now() + 2*60*1000; rec.fails=0; } // 5 hiba -> 2 perc tilt√°s
      data[email] = rec;
    }
    save(LS_ATT,data);
  }

  // ---- UI state (logged in) ----
  function updateUI(){
    const me = load(LS_ME,null);
    if(me){
      fab.textContent = `üë§ ${me.name} ‚Äì Kijelentkez√©s`;
      fab.onclick = ()=>{
        localStorage.removeItem(LS_ME);
        toast("Kijelentkezt√©l.");
        updateUI();
        document.dispatchEvent(new CustomEvent("auth:change",{detail:{user:null}}));
      };
      // gated content
      document.querySelectorAll('[data-auth="required"]').forEach(el=> el.style.display = "");
    }else{
      fab.textContent = "üîë Bel√©p√©s / Regisztr√°ci√≥";
      fab.onclick = ()=> show(panel);
      document.querySelectorAll('[data-auth="required"]').forEach(el=> el.style.display = "none");
    }
  }

  // ---- Register ----
  fReg.addEventListener("submit", async (e)=>{
    e.preventDefault();
    msgReg.textContent="Fi√≥k l√©trehoz√°sa‚Ä¶"; msgReg.className="auth-note";
    const name = fReg.name.value.trim();
    const email = fReg.email.value.trim().toLowerCase();
    const pw = fReg.password.value;
    if(!name || !email || !pw || pw.length<6){
      msgReg.textContent="T√∂lts ki minden mez≈ët (jelsz√≥ min. 6)."; msgReg.className="auth-note auth-err"; return;
    }
    const users = load(LS_USERS,{});
    if(users[email]){ msgReg.textContent="Ezzel az e-maillel m√°r van fi√≥k."; msgReg.className="auth-note auth-err"; return; }
    const salt = randSalt();
    const hash = await sha256(pw + salt);
    users[email] = {name,email,salt,hash,createdAt:new Date().toISOString()};
    save(LS_USERS, users);
    save(LS_ME, {name,email,loginAt:new Date().toISOString()});
    msgReg.textContent="Sikeres regisztr√°ci√≥! Bel√©pve vagy."; msgReg.className="auth-note auth-ok";
    updateUI(); hide(panel); toast("Bel√©pt√©l. √údv!");
    document.dispatchEvent(new CustomEvent("auth:change",{detail:{user:{name,email}}}));
  });

  // ---- Login ----
  fLogin.addEventListener("submit", async (e)=>{
    e.preventDefault();
    msgLogin.textContent="Bel√©ptet√©s‚Ä¶"; msgLogin.className="auth-note";
    const email = fLogin.email.value.trim().toLowerCase();
    const pw = fLogin.password.value;
    const gate = attemptAllowed(email);
    if(!gate.ok){ msgLogin.textContent=`T√∫l sok pr√≥b√°lkoz√°s. V√°rj ${gate.wait} mp-et.`; msgLogin.className="auth-note auth-err"; return; }

    const users = load(LS_USERS,{});
    const u = users[email];
    if(!u){ recordAttempt(email,false); msgLogin.textContent="Ismeretlen e-mail."; msgLogin.className="auth-note auth-err"; return; }
    const hash = await sha256(pw + u.salt);
    if(hash !== u.hash){ recordAttempt(email,false); msgLogin.textContent="Hib√°s jelsz√≥."; msgLogin.className="auth-note auth-err"; return; }
    recordAttempt(email,true);
    save(LS_ME, {name:u.name, email:u.email, loginAt:new Date().toISOString()});
    msgLogin.textContent="Siker!"; msgLogin.className="auth-note auth-ok";
    updateUI(); hide(panel); toast(`Szia, ${u.name}!`);
    document.dispatchEvent(new CustomEvent("auth:change",{detail:{user:{name:u.name,email:u.email}}}));
  });

  // Close on ESC / backdrop
  panel.addEventListener("click",(e)=>{ if(e.target===panel) hide(panel); });
  document.addEventListener("keydown",e=>{ if(e.key==="Escape") hide(panel); });

  // Init
  updateUI();

  // EXAMPLE: ha van olyan elem, amit csak bejelentkezve mutatn√°l:
  // <div data-auth="required">Titkos r√©sz</div>
})();
</script>
<!-- ==== /AUTH WIDGET ==== -->

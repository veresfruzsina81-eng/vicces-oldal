<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Noel & Trics ‚Äì Mini k√ºldet√©s</title>
<style>
  :root{--bg:#0b1224;--panel:#0f1629;--line:#1e293b;--text:#e5e7eb;--muted:#94a3b8}
  *{box-sizing:border-box} body{margin:0;background:radial-gradient(1000px 600px at 50% -200px,#0f1531,#0b1224);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
  .wrap{max-width:1100px;margin:16px auto;padding:0 12px}
  h1{margin:0 0 8px;font-size:20px}
  .panel{background:linear-gradient(180deg,#121a31,#0e162b);border:1px solid var(--line);border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,.35);padding:12px;margin-bottom:10px}
  label{font-size:12px;color:var(--muted)}
  input,select,button,textarea{border:1px solid #223046;background:#0b1326;color:var(--text);border-radius:12px;padding:10px 12px;font:inherit}
  button{font-weight:700;cursor:pointer;transition:transform .05s,filter .2s} button:hover{filter:brightness(1.06)} button:active{transform:translateY(1px)}
  .primary{background:linear-gradient(180deg,#1f9b58,#14834c);border-color:#1f9b58}
  .danger{background:linear-gradient(180deg,#ef4444,#b91c1c);border-color:#b91c1c}
  .stage{position:relative;aspect-ratio:16/9;border:1px solid #1e293b;border-radius:16px;overflow:hidden}
  .bg img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
  .char{position:absolute;bottom:0;transform:translateX(-50%);transition:transform .35s ease, opacity .35s ease; opacity:.6}
  .char img{max-height:90%;height:90%;filter:drop-shadow(0 12px 30px rgba(0,0,0,.6))}
  .left{left:22%} .center{left:50%} .right{left:78%}
  .active{opacity:1; animation:pulse 1.2s ease-in-out infinite alternate}
  .float{animation:float 3.6s ease-in-out infinite}
  @keyframes float{from{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(-6px)}to{transform:translateX(-50%) translateY(0)}}
  @keyframes pulse{from{filter:drop-shadow(0 12px 30px rgba(0,0,0,.6))}to{filter:drop-shadow(0 18px 36px rgba(0,0,0,.8))}}
  .speech{position:absolute;left:50%;bottom:10px;transform:translateX(-50%);width:min(900px,92%);background:#0b1326d9;border:1px solid #20324a;border-radius:14px;padding:12px}
  .name{display:inline-block;background:#111d34;border:1px solid #20324a;padding:4px 10px;border-radius:10px;font-weight:800;margin-bottom:6px}
  .text{line-height:1.45}
  .controls{display:flex;gap:8px;justify-content:space-between;align-items:center;margin-top:8px}
  .hint{font-size:12px;color:#9ca3af}
</style>
</head>
<body>
<div class="wrap">
  <h1>üìñ Noel & Trics ‚Äì Mini k√ºldet√©s</h1>
  <div class="panel">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div>
        <label>H√°tt√©r</label><br><input id="bg" type="file" accept="image/*">
      </div>
      <div>
        <label>Automatikus lej√°tsz√°s</label><br>
        <select id="autoplay"><option value="on" selected>Be (3‚Äì6 mp)</option><option value="off">Ki</option></select>
      </div>
      <div>
        <label>Noel k√©p</label><br><input id="imgNoel" type="file" accept="image/*">
      </div>
      <div>
        <label>Trics k√©p</label><br><input id="imgTrics" type="file" accept="image/*">
      </div>
    </div>
    <div style="margin-top:8px">
      <label>Szkript (magyar, soronk√©nt <code>N√©v: sz√∂veg</code>, utas√≠t√°sok: <code>[pause=ms]</code>, <code>[pos=N√©v:left/center/right]</code>)</label>
      <textarea id="script" rows="12" style="width:100%">[pos=Noel:left]
[pos=Trics:right]
Narr√°tor: Egy f√©nyes reggelen Noel a dombok k√∂z√∂tt egy titokzatos, k√©k f√©nycs√≠kot l√°t az √©gen.
Noel: H≈±, ez mi lehetett? Olyan, mintha ide zuhant volna valami!
[pause=700]
Trics: Szia! √ân vagyok Trics. A kapszul√°m energiamagja itt landolt. Seg√≠tesz megkeresni?
Noel: Persze, im√°dok nyomozni! Merre induljunk?
Trics: A detektor szerint a mez≈ën √°t, azt√°n a kis domb m√∂g√∂tt balra.
Narr√°tor: A f≈± k√∂z√∂tt apr√≥, szikr√°z√≥ p√∂tty√∂k mutatnak utat.
Noel: Ezek mintha‚Ä¶ energiacs√≠kok lenn√©nek!
[pause=600]
Trics: Pontosan! K√∂vess√ºk ≈ëket ‚Äì de √≥vatosan, n√©ha v√°ratlanul elhalv√°nyulnak.
Narr√°tor: A dombtet≈ën furcsa, k≈ëb≈ël rakott k√∂r v√°rja ≈ëket.
Noel: Olyan, mintha kirak√≥ lenne. Tal√°n sorrendben kell meg√©rinteni.
Trics: Pr√≥b√°ljuk: kicsi‚Äìnagy‚Äìk√∂z√©p!
Narr√°tor: A k√∂vek felizzanak, √©s keskeny √∂sv√©nyt rajzolnak a f≈±be.
Noel: L√°tom a v√©g√©n a f√©nyt!
[pause=800]
Trics: Ott az energiamag! De forr√≥‚Ä¶ egy√ºtt sz√°molunk, √©s egyszerre √©rintj√ºk meg.
Noel: H√°rom‚Ä¶ kett≈ë‚Ä¶ egy! Megvan!
Narr√°tor: A mag megszel√≠d√ºl, puha z√ºmm√∂g√©ssel a kapszul√°ba suhan.
Trics: K√∂sz√∂n√∂m, Noel! N√©lk√ºled nem siker√ºlt volna.
Noel: Gyere holnap is! Megmutatom a titkos f√°mat is a patakn√°l.
Narr√°tor: A dombok f√∂l√∂tt m√°r √∫j kaland √≠g√©rete csillog.</textarea>
    </div>
    <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
      <button id="start" class="primary">‚ñ∂Ô∏è Lej√°tsz√°s</button>
      <button id="stop" class="danger">‚èπÔ∏è Stop</button>
      <label style="margin-left:auto"><input id="tts" type="checkbox" checked> Felolvas√°s (magyar)</label>
    </div>
    <div class="hint" style="margin-top:6px">T√∂ltsd be a h√°rom k√©pet (h√°tt√©r, Noel, Trics), majd ind√≠tsd el. Space: tov√°bb, Backspace: vissza.</div>
  </div>

  <div class="stage panel" id="stage">
    <div class="bg" id="bgView"></div>
    <div id="noel"  class="char left float"><img hidden alt="Noel"></div>
    <div id="trics" class="char right float"><img hidden alt="Trics"></div>

    <div class="speech" id="speech">
      <div class="name" id="speaker">Narr√°tor</div>
      <div class="text" id="line">Kattints a dobozra vagy nyomd meg a Space-t a tov√°bbl√©p√©shez.</div>
      <div class="controls">
        <div class="hint" id="progress">0/0</div>
        <div>
          <button id="prev">‚üµ Vissza</button>
          <button id="next" class="primary">Tov√°bb ‚ü∂</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  const $ = s=>document.querySelector(s);
  const mkURL = f => f ? URL.createObjectURL(f) : null;

  // elemek
  const bgIn = $('#bg'), nIn = $('#imgNoel'), tIn = $('#imgTrics');
  const bgView = $('#bgView'), nEl = $('#noel'), tEl = $('#trics');
  const nImg = $('#noel img'), tImg = $('#trics img');
  const scriptBox = $('#script'), progress = $('#progress');
  const nextBtn = $('#next'), prevBtn = $('#prev'), startBtn = $('#start'), stopBtn = $('#stop');
  const autoplaySel = $('#autoplay'); const ttsChk = $('#tts');
  const speaker = $('#speaker'), line = $('#line'); const speech = $('#speech');

  // k√©pek bet√∂lt√©se
  bgIn.addEventListener('change', e=>{ const u = mkURL(e.target.files[0]); if(u) bgView.innerHTML = `<img src="${u}">`; });
  nIn.addEventListener('change', e=>{ const u = mkURL(e.target.files[0]); if(u){ nImg.src=u; nImg.hidden=false; }});
  tIn.addEventListener('change', e=>{ const u = mkURL(e.target.files[0]); if(u){ tImg.src=u; tImg.hidden=false; }});

  // TTS
  let tts = true, utter=null;
  ttsChk.addEventListener('change', e=>{ tts = e.target.checked; if(!tts) speechSynthesis.cancel(); });
  function speakHu(text){
    if(!tts) return;
    try{ if(utter) speechSynthesis.cancel();
      utter = new SpeechSynthesisUtterance(text); utter.lang='hu-HU'; speechSynthesis.speak(utter);
    }catch(e){}
  }

  // script parser
  function parseScript(txt){
    const out=[], lines = txt.split('\n');
    for (let raw of lines){
      const s = raw.trim(); if(!s) continue;
      if (s.startsWith('[') && s.endsWith(']')){
        const inside = s.slice(1,-1);
        if (inside.startsWith('pause=')) out.push({cmd:'pause', ms:+inside.split('=')[1]||800});
        else if (inside.startsWith('pos=')){
          const [who,where] = inside.split('=')[1].split(':');
          out.push({cmd:'pos', who: (who||'').trim(), where: (where||'center').trim()});
        }
        continue;
      }
      const i = s.indexOf(':');
      if (i>0) out.push({who:s.slice(0,i).trim(), text:s.slice(i+1).trim()});
      else out.push({who:'Narr√°tor', text:s});
    }
    return out;
  }

  let steps=[], idx=-1, autoTimer=null;

  function start(){ steps = parseScript(scriptBox.value); idx=-1; nEl.style.opacity=.6; tEl.style.opacity=.6; next(true); }
  function stop(){ clearTimeout(autoTimer); idx=-1; progress.textContent=`0/${steps.length}`; speaker.textContent='Narr√°tor'; line.textContent='Lej√°tsz√°s meg√°ll√≠tva.'; speechSynthesis.cancel(); }
  function setPos(who, where){
    const el = who.toLowerCase()==='noel' ? nEl : tEl;
    el.classList.remove('left','center','right'); el.classList.add(where);
  }

  function show(step, instant){
    // akt√≠v besz√©l≈ë kiemel√©s + belibben√©s els≈ë megsz√≥lal√°skor
    [nEl,tEl].forEach(el=>el.classList.remove('active'));
    if (step.who){
      const el = step.who.toLowerCase()==='noel' ? nEl : (step.who.toLowerCase()==='trics' ? tEl : null);
      if (el){ el.classList.add('active'); /* bel√©p√©s, ha eddig rejtett k√©p volt */ }
    }
    if (step.cmd==='pause'){ speaker.textContent='‚Ä¶'; line.textContent='(sz√ºnet)'; return; }
    if (step.cmd==='pos'){ setPos(step.who, step.where); return; }
    speaker.textContent = step.who||'Narr√°tor';
    type(line, step.text||'', instant?0:16);
    speakHu(`${speaker.textContent} mondja: ${step.text||''}`);
  }

  function type(el, text, cps){
    if (cps<=0){ el.textContent=text; return; }
    el.textContent=''; let i=0;
    (function tick(){ el.textContent=text.slice(0, i++); if(i<=text.length) setTimeout(tick, Math.max(8,1000/cps)); })();
  }

  function scheduleAuto(){
    if (autoplaySel.value!=='on') return;
    const s = steps[idx]; let ms = 3500;
    if (s && s.text) ms = Math.min(7000, 900 + s.text.length*55);
    if (s && s.cmd==='pause') ms = s.ms||800;
    autoTimer = setTimeout(()=>next(), ms);
  }

  function next(instant=false){
    clearTimeout(autoTimer);
    if (!steps.length) return;
    idx = Math.min(idx+1, steps.length-1);
    show(steps[idx], instant);
    progress.textContent = `${idx+1}/${steps.length}`;
    scheduleAuto();
  }
  function prev(){
    clearTimeout(autoTimer);
    if (!steps.length) return;
    idx = Math.max(idx-1, 0);
    // keress√ºnk vissza az el≈ëz≈ë besz√©dre
    let j=idx; while (j>0 && steps[j].cmd) j--;
    show(steps[j], true);
    progress.textContent = `${j+1}/${steps.length}`;
  }

  startBtn.addEventListener('click', start);
  stopBtn.addEventListener('click', stop);
  nextBtn.addEventListener('click', ()=>next());
  prevBtn.addEventListener('click', prev);
  speech.addEventListener('click', ()=>next());
  window.addEventListener('keydown', e=>{
    if (e.key===' '){ e.preventDefault(); next(); }
    if (e.key==='Backspace'){ e.preventDefault(); prev(); }
  });
})();
</script>
</body>
</html>

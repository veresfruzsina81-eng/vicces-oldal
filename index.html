<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tam√°s AI ‚Äî Kellemes besz√©lget√©st!</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ü§ñ</text></svg>">
  <style>
    :root{
      --panel:#101418e6;
      --panelSoft:#0b0f14cc;
      --txt:#e8eaee;
      --muted:#a7b0be;
      --brand:#ff9d2f;
      --ok:#12d18e;
      --err:#ff5e68;
      --glass: backdrop-filter: blur(10px) saturate(120%);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--txt); font:16px/1.5 system-ui, Segoe UI, Roboto, Arial;
      background:#0c0f13 url("./bg_tamas.jpg") center/cover fixed no-repeat;
    }
    .shade{position:fixed; inset:0; background:rgba(8,12,16,.55)}
    .wrap{
      position:relative; z-index:1; max-width:1100px; margin:0 auto; padding:28px 16px 48px;
      display:grid; grid-template-columns: 1.1fr 0.9fr; gap:18px;
    }
    @media (max-width: 980px){
      .wrap{grid-template-columns: 1fr; gap:14px}
    }
    header{
      grid-column:1/-1; padding:18px 20px; border-radius:18px; background:var(--panel); box-shadow:0 10px 30px rgba(0,0,0,.4);
      display:flex; align-items:center; justify-content:space-between; border:1px solid rgba(255,255,255,.06);
      /* glass */
      --x:1; --y:1; --b:10px;
    }
    .brand{
      display:flex; align-items:center; gap:14px; letter-spacing:.2px;
    }
    .brand .logo{
      width:42px; height:42px; border-radius:12px; display:grid; place-items:center; 
      background:linear-gradient(135deg,#1a2430,#344150); border:1px solid rgba(255,255,255,.08);
      box-shadow:inset 0 0 20px rgba(255,255,255,.06), 0 8px 20px rgba(0,0,0,.35);
    }
    .brand h1{margin:0; font-size:22px}
    .brand small{display:block; color:var(--muted); font-weight:500}
    .controls{display:flex; align-items:center; gap:14px; color:var(--muted); flex-wrap:wrap}
    .toggle{display:inline-flex; align-items:center; gap:8px; user-select:none}
    .toggle input{accent-color:var(--brand); width:18px; height:18px}
    .pill{
      padding:6px 10px; border-radius:999px; background:#ffffff12; border:1px solid #ffffff22; color:var(--muted);
      font-size:13px;
    }

    /* k√°rty√°k */
    .card{
      padding:16px; border-radius:18px; background:var(--panel); border:1px solid rgba(255,255,255,.06);
      box-shadow:0 10px 28px rgba(0,0,0,.35);
    }
    .card h3{margin:0 0 10px; font-size:14px; letter-spacing:.3px; color:var(--muted)}
    .card .hint{font-size:13px; color:var(--muted)}

    /* 3D panel */
    #v3d{ height:420px; width:100%; border-radius:14px; overflow:hidden; background:var(--panelSoft); position:relative }
    #v3d canvas{display:block}
    #v3d .status{
      position:absolute; inset:auto 12px 12px auto; padding:6px 10px; border-radius:10px; background:#ffffff14; border:1px solid #ffffff22;
      font-size:12px; color:var(--muted)
    }
    .hidden{display:none !important}

    /* Chat */
    .chat-panel{display:flex; flex-direction:column; gap:10px; min-height:520px}
    .chat-log{
      background:var(--panelSoft); border:1px solid rgba(255,255,255,.06);
      border-radius:14px; padding:14px; min-height:320px; max-height:520px; overflow:auto;
      scroll-behavior:smooth;
    }
    .msg{max-width:86%; padding:10px 14px; margin:8px 0; border-radius:14px; font-size:15px; white-space:pre-wrap}
    .msg.user{margin-left:auto; background:linear-gradient(135deg,#ff9d2f,#ffbb66); color:#1b1408; border:1px solid #ffffff55}
    .msg.bot{background:#1a2230; border:1px solid rgba(255,255,255,.08)}
    .msg.info{background:#10222a; border:1px dashed #1f8a70; color:#cfeee5}
    .msg.err{background:#2b1418; border:1px solid #ff5e68; color:#ffd7db}

    .composer{display:flex; gap:10px}
    .composer textarea{
      flex:1; resize:none; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:#0f141b; color:var(--txt); min-height:46px; max-height:160px; outline:none;
    }
    button.btn{
      padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.1); cursor:pointer; font-weight:600;
      background:linear-gradient(135deg,#1b2733,#263445); color:#e9eef5;
    }
    .btn.send{background:linear-gradient(135deg,var(--brand),#ffd089); color:#1b1408}
    .btn.mic-on{background:linear-gradient(135deg,#183a2c,#14523f); border-color:#1b7b5d}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
    footer{grid-column:1/-1; text-align:center; color:#a9b4c4; font-size:13px; margin-top:6px}
  </style>
</head>
<body>
  <div class="shade"></div>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">AI</div>
        <div>
          <h1>Tam√°s AI</h1>
          <small>Hobbi fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens</small>
        </div>
      </div>
      <div class="controls">
        <label class="toggle"><input id="autoscroll" type="checkbox" checked> Auto-scroll</label>
        <span class="pill" id="clock">‚Äî</span>
      </div>
    </header>

    <!-- Chat -->
    <section class="card chat-panel">
      <div class="row">
        <h3>Besz√©lget√©s</h3>
        <div class="hint">Tipp: Enter = k√ºld√©s, Shift+Enter = √∫j sor</div>
      </div>

      <div id="log" class="chat-log" aria-live="polite"></div>

      <div class="composer">
        <textarea id="input" placeholder="√çrj ide‚Ä¶"></textarea>
        <button id="mic" class="btn" title="Hangos m√≥d (ind√≠t/meg√°ll√≠t)">üé§</button>
        <button id="send" class="btn send">K√ºld√©s</button>
      </div>
    </section>

    <!-- 3D robot -->
    <section class="card">
      <div class="row">
        <h3>3D asszisztens</h3>
        <div class="hint">Ha nem l√°tszik, a modell m√©g t√∂lt, vagy a b√∂ng√©sz≈ë tiltja a WebGL-t.</div>
      </div>
      <div id="v3d">
        <div class="status" id="v3dStatus">Bet√∂lt√©s‚Ä¶</div>
      </div>
    </section>

    <footer>¬© HT ‚Äî saj√°t hobbi fejleszt√©s. J√≥ sz√≥rakoz√°st! üéâ</footer>
  </div>

  <!-- three.js + GLTFLoader -->
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>

  <script>
    /* ======= √ìRA + napok ======= */
    const clockEl = document.getElementById('clock');
    const napok = ["vas√°rnap","h√©tf≈ë","kedd","szerda","cs√ºt√∂rt√∂k","p√©ntek","szombat"];
    function frissOra(){
      const d = new Date();
      const pad = n => n.toString().padStart(2,'0');
      const s = `${d.getFullYear()}.${pad(d.getMonth()+1)}.${pad(d.getDate())}. ${napok[d.getDay()]} ‚Äî ${pad(d.getHours())}:${pad(d.getMinutes())}`;
      clockEl.textContent = s;
    }
    frissOra(); setInterval(frissOra, 30_000);

    /* ======= Chat UI ======= */
    const log = document.getElementById('log');
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const autoscrollCb = document.getElementById('autoscroll');

    function addMsg(text, kind="bot"){
      const b = document.createElement('div');
      b.className = `msg ${kind}`;
      b.textContent = text;
      log.appendChild(b);
      if (autoscrollCb.checked) log.scrollTop = log.scrollHeight;
      return b;
    }

    // Kezd≈ë √ºzenet
    addMsg("Szia! √ñr√ºl√∂k, hogy itt vagy. K√©rdezz b√°tran; seg√≠tek. üòä", "bot");

    async function ask(text){
      if(!text.trim()) return;
      addMsg(text, "user");
      input.value = "";

      // Fix/helyi v√°laszok (n√©v, modell, napok, d√°tum)
      const t = text.toLowerCase();
      const ma = new Date();
      const pad = n => n.toString().padStart(2,'0');

      if (t.includes("milyen modell") || t.includes("ki vagy")){
        addMsg("√ân Tam√°s modellje vagyok ‚Äî ≈ë k√©sz√≠tett √©s fejlesztett, hogy seg√≠tsek neked b√°rmiben. üôÇ","bot");
        return;
      }
      if (t.includes("ki k√©sz√≠tette") || t.includes("ki hozta l√©tre")){
        addMsg("Az oldalt Horv√°th Tam√°s (Szabolcsb√°ka) k√©sz√≠tette hobbi fejleszt√©sk√©nt. üéâ","bot");
        return;
      }
      if (t.includes("mai d√°tum") || t.includes("milyen d√°tum") || t.includes("h√°nyadika van")){
        addMsg(`Ma ${ma.getFullYear()}.${pad(ma.getMonth()+1)}.${pad(ma.getDate())}. (${napok[ma.getDay()]})`, "bot");
        return;
      }
      if (t.includes("holnap") || t.includes("holnapi nap")){
        const holnap = new Date(ma); holnap.setDate(ma.getDate()+1);
        addMsg(`Holnap ${holnap.getFullYear()}.${pad(holnap.getMonth()+1)}.${pad(holnap.getDate())}. (${napok[holnap.getDay()]})`, "bot");
        return;
      }
      if (t.includes("melyik nap van")){
        addMsg(`Ma ${napok[ma.getDay()]}.`, "bot");
        return;
      }

      // Info "g√©pel√©s" jelz√©s
      const info = addMsg("‚Ä¶", "info");

      try{
        const r = await fetch("/.netlify/functions/chat", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ message: text })
        });
        if(!r.ok) throw new Error("HTTP "+r.status);
        const data = await r.json();
        info.remove();
        addMsg(data.reply?.toString() || "√ârtettem. Miben seg√≠thetek m√©g?", "bot");
        if (speechOn) speak(data.reply?.toString() || "√ârtettem. Miben seg√≠thetek m√©g?");
      }catch(e){
        info.remove();
        addMsg("Hiba: "+ (e.message || e), "err");
      }
    }

    // K√ºld√©s esem√©nyek
    sendBtn.addEventListener('click', ()=> ask(input.value));
    input.addEventListener('keydown', (e)=>{
      if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); ask(input.value); }
    });

    /* ======= Hangos m√≥d (Web Speech API) ======= */
    const micBtn = document.getElementById('mic');
    let rec = null, listening=false, speechOn = false;

    function setListenUI(on){
      listening = on;
      micBtn.classList.toggle('mic-on', on);
      micBtn.textContent = on ? "‚ñ†" : "üé§";
      micBtn.title = on ? "Le√°ll√≠t√°s" : "Hangos m√≥d ind√≠t√°sa";
    }
    function setSpeech(on){ speechOn = on; }

    // TTS (besz√©d)
    function speak(text){
      if(!("speechSynthesis" in window)) return;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "hu-HU";
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }

    // STT (felismer√©s)
    function startRec(){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!SR){ addMsg("A besz√©dfelismer√©s nem t√°mogatott ebben a b√∂ng√©sz≈ëben. Pr√≥b√°ld Chrome-ban.", "err"); return; }
      rec = new SR();
      rec.lang = "hu-HU";
      rec.continuous = true;
      rec.interimResults = false;

      rec.onresult = (ev)=>{
        const last = ev.results[ev.results.length-1];
        const said = last[0].transcript.trim();
        if(said){ ask(said); }
      };
      rec.onerror = (e)=> addMsg("Felismer√©si hiba: "+e.error, "err");
      rec.onend = ()=> setListenUI(false);

      setListenUI(true); setSpeech(true);
      rec.start();
      addMsg("Hangos m√≥d akt√≠v. Besz√©lj nyugodtan!", "info");
    }
    function stopRec(){
      try{ rec && rec.stop(); }catch{}
      setListenUI(false);
    }
    micBtn.addEventListener('click', ()=> listening ? stopRec() : startRec());

    /* ======= 3D robot (three.js) ======= */
    (function init3D(){
      const box = document.getElementById('v3d');
      const status = document.getElementById('v3dStatus');
      try{
        const scene = new THREE.Scene();
        const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
        renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
        const W = box.clientWidth, H = box.clientHeight;
        renderer.setSize(W, H);
        box.appendChild(renderer.domElement);

        const cam = new THREE.PerspectiveCamera(40, W/H, 0.1, 100);
        cam.position.set(0, 1.4, 2.4);
        scene.add(cam);

        // f√©nyek
        scene.add(new THREE.AmbientLight(0xffffff, .7));
        const dir = new THREE.DirectionalLight(0xffffff, .9); dir.position.set(2,3,2); scene.add(dir);

        // padl√≥-szer≈± √°rnyalat
        const g = new THREE.CircleGeometry(2, 64);
        const m = new THREE.MeshBasicMaterial({ color:0x0f141b, transparent:true, opacity:.65 });
        const floor = new THREE.Mesh(g,m); floor.rotation.x = -Math.PI/2; floor.position.y = -1.02; scene.add(floor);

        // modell
        const loader = new THREE.GLTFLoader();
        loader.load("./CesiumMan.glb", (gltf)=>{
          const model = gltf.scene;
          model.scale.set(0.9,0.9,0.9);
          scene.add(model);
          status.textContent = "Szia! üëã";
          setTimeout(()=> status.classList.add('hidden'), 1200);

          // egyszer≈± idle ‚Äúhint√°ztat√°s‚Äù
          let t = 0;
          function tick(){
            t += 0.01;
            model.rotation.y = Math.sin(t*0.4)*0.25;
            renderer.render(scene, cam);
            requestAnimationFrame(tick);
          }
          tick();
        }, (xhr)=>{
          status.textContent = `Bet√∂lt√©s: ${Math.round(xhr.loaded/Math.max(xhr.total||1,1)*100)}%`;
        }, (err)=>{
          box.parentElement.classList.add('hidden');
        });

        // m√©retez√©s
        new ResizeObserver(()=>{
          const w = box.clientWidth, h = box.clientHeight;
          cam.aspect = w/h; cam.updateProjectionMatrix(); renderer.setSize(w,h);
        }).observe(box);
      }catch(e){
        // ha nincs WebGL
        box.parentElement.classList.add('hidden');
      }
    })();
  </script>
</body>
</html>

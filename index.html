<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HT Chat ‚Äî Kellemes besz√©lget√©st!</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>ü§ñ</text></svg>">
  <style>
    :root{
      --bg-a:#0f1021; --bg-b:#1b1f3b; --bg-c:#2d325a;
      --glass: rgba(255,255,255,0.08);
      --glass-strong: rgba(255,255,255,0.12);
      --txt:#e9ecf1;
      --muted:#b7c0d2;
      --brand:#ff9d3d; /* narancs √°rnyalat */
      --brand-2:#6fd3ff; /* k√©k akcent */
      --ok:#66e0a3; --err:#ff6b6b;
    }

    /* H√°tterek ‚Äì modern, finom anim√°lt gradiens + zaj */
    body{
      margin:0; color:var(--txt); font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, #1d2556 0%, transparent 55%),
                  radial-gradient(900px 600px at 85% 20%, #143a52 0%, transparent 60%),
                  linear-gradient(135deg, var(--bg-a), var(--bg-b) 55%, var(--bg-c));
      min-height:100svh; overflow-x:hidden;
    }
    .grain::before{
      content:""; position:fixed; inset:0; pointer-events:none;
      background-image:url("data:image/svg+xml;utf8,\
      <svg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'>\
      <filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2'/></filter>\
      <rect width='100%' height='100%' filter='url(%23n)' opacity='.04'/></svg>");
      mix-blend-mode:soft-light;
    }

    /* F≈ë kont√©ner */
    .wrap{
      max-width:1100px; margin:0 auto; padding: clamp(16px, 3vw, 28px);
    }

    /* Fejl√©c */
    header{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      margin-bottom:18px;
    }
    .brand{
      display:flex; align-items:flex-start; gap:14px;
    }
    .brand .logo{
      width:42px; height:42px; border-radius:12px;
      background:linear-gradient(135deg, var(--brand), #ffd36b);
      box-shadow:0 6px 24px rgba(255,157,61,0.35), inset 0 0 12px rgba(255,255,255,.25);
    }
    h1{margin:0; font-weight:800; letter-spacing:.2px; font-size:clamp(22px, 3.4vw, 36px);}
    .subtitle{
      margin:2px 0 0 0; color:var(--muted); font-size:.95rem;
    }

    /* K√°rtya (chat + panelek) */
    .card{
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:22px; padding:16px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 40px rgba(0,0,0,0.35);
    }

    /* V√°lt√≥ ‚Äì Chat / Hangos m√≥d */
    .tabs{display:flex; gap:10px; margin-bottom:12px;}
    .tab{
      background:transparent; border:1px solid rgba(255,255,255,.2);
      color:var(--txt); padding:10px 14px; border-radius:999px; cursor:pointer;
      transition:.2s; font-weight:600;
    }
    .tab.active{ background:var(--brand); color:#1a1205; border-color:transparent; }

    /* Vez√©rl≈ësor */
    .controls{
      display:flex; flex-wrap:wrap; gap:12px 18px; align-items:center; margin-bottom:14px;
      color:var(--muted); font-size:.95rem;
    }
    .switch{ display:inline-flex; align-items:center; gap:8px; cursor:pointer; user-select:none; }
    .switch input{ appearance:none; width:38px; height:22px; background:#445; border-radius:999px; position:relative; outline:none; transition:.2s; }
    .switch input:checked{ background:linear-gradient(90deg, var(--brand), #ffd36b); }
    .switch input::after{
      content:""; width:18px; height:18px; border-radius:50%; background:#fff;
      position:absolute; top:2px; left:3px; transition:.2s; box-shadow:0 1px 3px rgba(0,0,0,.35);
    }
    .switch input:checked::after{ left:17px; }

    /* Chat doboz */
    .chat{
      display:flex; flex-direction:column; gap:12px;
      height: min(76svh, 680px);
    }
    .log{
      flex:1; overflow:auto; padding:10px; border-radius:18px;
      background: rgba(0,0,0,0.25); border:1px solid rgba(255,255,255,0.08);
      scroll-behavior:smooth;
    }
    .row{ display:flex; gap:10px; align-items:flex-end; }
    .row.me{ justify-content:flex-end; }
    .bubble{
      max-width: 75%; padding:12px 14px; border-radius:16px;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.08);
      word-wrap:break-word; white-space:pre-wrap;
    }
    .me .bubble{
      background: linear-gradient(135deg, var(--brand) 0%, #ffbd66 100%);
      color:#3b2409;
    }
    .bot .bubble{
      background: linear-gradient(135deg, #2b335f, #394281);
      color:#e8edff;
    }
    .info .bubble{
      background: linear-gradient(135deg, #1f273f, #26304e);
      color:#cbd4ff;
    }
    .err .bubble{
      background: linear-gradient(135deg, #5a1f2a, #7b2834);
      color:#ffe3e6;
      border-color: rgba(255,0,43,.25);
    }

    /* Input sor */
    .composer{
      display:flex; gap:10px; align-items:center; background:rgba(0,0,0,.28); padding:10px; border-radius:16px; border:1px solid rgba(255,255,255,.08);
    }
    textarea{
      flex:1; resize:vertical; max-height:140px; min-height:44px; padding:12px 12px 12px 14px;
      border-radius:12px; border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04); color:var(--txt); outline:none;
    }
    .send{
      border:none; border-radius:12px; padding:11px 16px; cursor:pointer; font-weight:700;
      background:linear-gradient(135deg, var(--brand), #ffd36b);
      color:#2b1c08; box-shadow:0 6px 18px rgba(255,157,61,.35);
    }

    /* Lebeg≈ë mikrofon (hangos m√≥d gyorskapcsol√≥) */
    .fab{
      position:fixed; right:18px; bottom:18px; z-index:20;
      width:58px; height:58px; border-radius:999px; display:grid; place-items:center;
      background: radial-gradient(200px 200px at 30% 30%, #ffedd1 0%, transparent 55%),
                  linear-gradient(135deg, var(--brand), #ffd36b);
      color:#251403; box-shadow:0 12px 30px rgba(255,157,61,.45); border:none; cursor:pointer; font-size:22px;
    }
    .fab.on{ animation:pulse 1.2s infinite; }
    @keyframes pulse{
      0%{ box-shadow:0 0 0 0 rgba(255,157,61,.45); }
      70%{ box-shadow:0 0 0 18px rgba(255,157,61,0); }
      100%{ box-shadow:0 0 0 0 rgba(255,157,61,0); }
    }

    /* Hangos panel */
    .voice-panel{
      display:none; margin-top:12px; gap:12px; align-items:center; flex-wrap:wrap;
      background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); border-radius:14px; padding:10px 12px;
    }
    .voice-panel.show{ display:flex; }
    .pill{
      padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.2);
      background:rgba(0,0,0,.25); color:var(--muted); font-weight:600;
    }
    .btn{
      padding:9px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.06);
      color:var(--txt); cursor:pointer;
    }
    .btn.primary{ background:linear-gradient(135deg, var(--brand-2), #b7eeff); color:#032330; border:none; }
    .btn.danger{ background:linear-gradient(135deg, #ff7b88, #ffb1b8); color:#3b0c12; border:none; }

    /* Mobil finom√≠t√°s */
    @media (max-width:700px){
      .log{ height: 62svh; }
      .bubble{ max-width: 86%; }
      header{ flex-direction:column; align-items:flex-start; gap:10px; }
    }
  </style>
</head>
<body class="grain">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>HT Chat ‚Äî <span style="color:#ffd36b">Kellemes besz√©lget√©st!</span></h1>
          <p class="subtitle">Az oldalt l√©trehozta <b>H.T</b> ‚Äî egyedi fejleszt√©ssel.</p>
        </div>
      </div>
      <div class="pill">¬© H.T ‚Äî saj√°t hobbi fejleszt√©s. J√≥ sz√≥rakoz√°st! üéâ</div>
    </header>

    <div class="card">
      <div class="tabs">
        <button class="tab active" id="tab-chat">Chat</button>
        <button class="tab" id="tab-voice">Hangos m√≥d</button>
      </div>

      <div class="controls">
        <label class="switch" title="Utols√≥ bot v√°lasz m√°sol√°sa gomb">
          <input type="checkbox" id="copyToggle">
          <span>M√°sol√°s (utols√≥ v√°lasz)</span>
        </label>
        <label class="switch" title="Bot v√°lasz felolvas√°sa">
          <input type="checkbox" id="ttsToggle">
          <span>Hang (felolvas√°s)</span>
        </label>
        <span class="tip"> Tipp: <b>Enter</b> = k√ºld√©s, <b>Shift+Enter</b> = √∫j sor</span>
      </div>

      <!-- CHAT PANEL -->
      <div id="panel-chat">
        <div class="chat">
          <div class="log" id="log" aria-live="polite"></div>
          <div class="voice-panel" id="copyPanel">
            <button class="btn" id="copyLast">Utols√≥ v√°lasz m√°sol√°sa</button>
            <span id="copyState" class="pill">‚Äî</span>
          </div>
          <div class="composer">
            <textarea id="input" placeholder="√çrj ide..." rows="1"></textarea>
            <button class="send" id="sendBtn">K√ºld√©s</button>
          </div>
        </div>
      </div>

      <!-- HANG PANEL -->
      <div id="panel-voice" style="display:none">
        <div class="voice-panel show" id="voiceToolbar">
          <span class="pill" id="vStatus">Koppints a jobb als√≥ üéôÔ∏è gombra. Egyszer elind√≠tod ‚Üí folyamatosan hallgat √©s v√°laszol.</span>
          <label class="switch" title="Hangos m√≥dban megjelenjen-e a besz√©lget√©s a chatben">
            <input type="checkbox" id="echoToChat">
            <span>P√°rbesz√©d megjelen√≠t√©se a chatben</span>
          </label>
          <button class="btn" id="tryVoices">Hungarian hang keres√©se</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Lebeg≈ë mikrofon -->
  <button class="fab" id="micFab" title="Hangos m√≥d ind√≠t√°sa/meg√°ll√≠t√°sa">üéôÔ∏è</button>

  <script>
    /**********************
     *  Seg√©d ‚Äì UI/Chat  *
     **********************/
    const logEl = document.getElementById('log');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const copyToggle = document.getElementById('copyToggle');
    const copyPanel  = document.getElementById('copyPanel');
    const copyLastBtn= document.getElementById('copyLast');
    const copyState  = document.getElementById('copyState');
    const ttsToggle  = document.getElementById('ttsToggle');
    const tabChat    = document.getElementById('tab-chat');
    const tabVoice   = document.getElementById('tab-voice');
    const panelChat  = document.getElementById('panel-chat');
    const panelVoice = document.getElementById('panel-voice');
    const micFab     = document.getElementById('micFab');
    const vStatus    = document.getElementById('vStatus');
    const echoToChat = document.getElementById('echoToChat');
    const tryVoicesBtn = document.getElementById('tryVoices');

    let lastBot = '';
    let ttsOn = false;

    copyToggle.addEventListener('change', ()=> copyPanel.style.display = copyToggle.checked ? 'flex' : 'none');
    ttsToggle.addEventListener('change', ()=> ttsOn = ttsToggle.checked);

    tabChat.addEventListener('click', ()=>{
      tabChat.classList.add('active'); tabVoice.classList.remove('active');
      panelChat.style.display='block'; panelVoice.style.display='none';
    });
    tabVoice.addEventListener('click', ()=>{
      tabVoice.classList.add('active'); tabChat.classList.remove('active');
      panelVoice.style.display='block'; panelChat.style.display='none';
    });

    function addMsg(text, who='bot', cls=''){
      const row=document.createElement('div');
      row.className='row '+(who==='me'?'me':(cls||'bot'));
      const b=document.createElement('div');
      b.className='bubble';
      b.textContent=text;
      row.appendChild(b);
      const nearBottom = (logEl.scrollHeight - logEl.scrollTop - logEl.clientHeight) < 120;
      logEl.appendChild(row);
      if(nearBottom) logEl.scrollTop = logEl.scrollHeight;
      if(who!=='me'){ lastBot=text; if(ttsOn) speakHu(text); }
    }

    copyLastBtn.addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(lastBot || '');
        copyState.textContent='‚úîÔ∏è Kim√°solva';
        setTimeout(()=>copyState.textContent='‚Äî',1500);
      }catch{ copyState.textContent='Hopp, nem siker√ºlt'; }
    });

    /**********************
     *  Felolvas√°s (hu)   *
     **********************/
    let huVoice = null;
    function pickHuVoice(){
      const voices = speechSynthesis.getVoices();
      huVoice = voices.find(v =>
        /hu|hungarian/i.test(v.lang) ||
        /Hungarian|Magyar|Szabolcs|Noemi/i.test(v.name)
      ) || voices[0] || null;
    }
    if('speechSynthesis' in window){
      pickHuVoice();
      window.speechSynthesis.onvoiceschanged = pickHuVoice;
    }
    function speakHu(text){
      try{
        if(!('speechSynthesis' in window)) return;
        const u = new SpeechSynthesisUtterance(text);
        u.lang='hu-HU'; u.rate=1; u.pitch=1; u.volume=1;
        if(huVoice) u.voice=huVoice;
        speechSynthesis.cancel(); // ne torl√≥djon
        speechSynthesis.speak(u);
      }catch{}
    }
    tryVoicesBtn.addEventListener('click', ()=>{ pickHuVoice(); speakHu('Sziasztok! Megtal√°ltam a magyar hangot, ha el√©rhet≈ë.'); });

    /**************************
     *  Helyi inf√≥k (id≈ë/d√°tum)
     **************************/
    function formatNowFull(){
      const now=new Date();
      const d=new Intl.DateTimeFormat('hu-HU',{year:'numeric',month:'long',day:'numeric',weekday:'long'}).format(now);
      const t=new Intl.DateTimeFormat('hu-HU',{hour:'2-digit',minute:'2-digit'}).format(now);
      return `Ma ${d} van, az id≈ë pedig ${t}.`;
    }
    function formatOnlyTime(){
      return new Intl.DateTimeFormat('hu-HU',{hour:'2-digit',minute:'2-digit'}).format(new Date());
    }
    function formatOnlyDate(){
      return new Intl.DateTimeFormat('hu-HU',{year:'numeric',month:'long',day:'numeric',weekday:'long'}).format(new Date());
    }
    function localInfoAnswer(txtRaw){
      const t=(txtRaw||'').toLowerCase().trim();
      const any = arr=>arr.some(k=>t.includes(k));
      if(any(['d√°tum √©s id≈ë','pontos d√°tum √©s id≈ë'])) return formatNowFull();
      if(any(['mennyi az id≈ë','pontos id≈ë','h√°ny √≥ra'])) return `Most az id≈ë: ${formatOnlyTime()}.`;
      if(any(['milyen d√°tum','mai d√°tum','h√°nyadika','milyen nap van'])) return `Ma ${formatOnlyDate()} van.`;
      return null;
    }

    /***************************************
     *  Fix v√°laszok (tulaj/ modell k√©rd√©s)
     ***************************************/
    function fixedAnswer(txtRaw){
      const t=(txtRaw||'').toLowerCase();
      const askOwner = ['ki k√©sz√≠tette','ki hozta l√©tre','ki az oldal k√©sz√≠t≈ëje','ki a tulajdonos'];
      if(askOwner.some(k=>t.includes(k))){
        return 'Az oldalt Horv√°th Tam√°s (Szabolcsb√°ka) k√©sz√≠tette √©s fejleszti hobbi-projektk√©nt.';
      }
      const aboutTam = ['mes√©lj horv√°th tam√°sr√≥l','ki az a horv√°th tam√°s','mutasd be horv√°th tam√°st','ki az a tam√°s modell'];
      if(aboutTam.some(k=>t.includes(k))){
        return 'Horv√°th Tam√°s (Szabolcsb√°ka) lelkes, autodidakta webes hobbi-fejleszt≈ë. Szabadidej√©ben UI-kat, egyszer≈± alkalmaz√°sokat, √©s AI-alap√∫ k√≠s√©rleteket k√©sz√≠t ‚Äì folyamatosan tanul √©s √©p√≠t.';
      }
      const modelQ = ['milyen modell vagy','milyen modell ez','milyen chat vagy'];
      if(modelQ.some(k=>t.includes(k))){
        return '√ân Tam√°s modellje vagyok ‚Äì ≈ë k√©sz√≠tett √©s fejlesztett, hogy seg√≠tsek neked b√°rmiben. üôÇ';
      }
      return null;
    }

    /**********************
     *  K√ºld√©s logika     *
     **********************/
    async function handleUserMessage(userText, {echoIntoChat=true} = {}){
      if(!userText || !userText.trim()) return;

      if(echoIntoChat) addMsg(userText,'me');

      // 1) helyi inf√≥
      const local = localInfoAnswer(userText);
      if(local){ addMsg(local,'bot'); return; }

      // 2) fix (tulaj/modell)
      const fixed = fixedAnswer(userText);
      if(fixed){ addMsg(fixed,'bot'); return; }

      // 3) backend h√≠v√°s
      try{
        const r = await fetch('/.netlify/functions/chat', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ message: userText })
        });
        if(!r.ok) throw new Error('HTTP '+r.status);
        const data = await r.json();
        const reply = (data.reply||'').toString().trim() || '√ârtem. Miben seg√≠thetek m√©g?';
        addMsg(reply,'bot');
      }catch(e){
        addMsg('Hiba: '+(e?.message||'ismeretlen hiba'),'err');
      }
    }

    // Composer
    sendBtn.addEventListener('click', ()=>{
      const txt = inputEl.value;
      inputEl.value='';
      handleUserMessage(txt, {echoIntoChat:true});
    });
    inputEl.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendBtn.click(); }
    });

    // Kezd≈ë √ºzenet
    addMsg('Szia! √ñr√ºl√∂k, hogy itt vagy! K√©rdezz b√°rmit; seg√≠tek neked. üôÇ','info');

    /**********************
     *  Hangos m√≥d        *
     **********************/
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    let rec=null, recOn=false;

    function setupRec(){
      if(!SR) return null;
      const r = new SR();
      r.lang='hu-HU';
      r.continuous=true;
      r.interimResults=false;
      r.onstart=()=>{ vStatus.textContent='Hallgatok‚Ä¶ Mondd a k√©rd√©sed!'; micFab.classList.add('on'); };
      r.onend = ()=>{ micFab.classList.remove('on'); if(recOn){ try{ r.start(); }catch{} } };
      r.onerror = (ev)=>{ vStatus.textContent='Hiba: '+(ev.error||'ismeretlen'); };
      r.onresult = (ev)=>{
        for(let i=ev.resultIndex;i<ev.results.length;i++){
          const res = ev.results[i];
          if(res.isFinal){
            const said = res[0].transcript.trim();
            const echo = echoToChat.checked; // megjelenjen-e a chatben
            handleUserMessage(said, {echoIntoChat: echo});
          }
        }
      };
      return r;
    }

    function startRec(){
      if(!SR){ vStatus.textContent='A besz√©dfelismer√©s nem t√°mogatott ezen az eszk√∂z√∂n.'; return; }
      if(recOn) return;
      recOn=true;
      if(!rec) rec=setupRec();
      try{ rec.start(); }catch{}
      ttsOn = true; ttsToggle.checked = true; // hangos m√≥dban olvasson fel
      vStatus.textContent='Hallgatok‚Ä¶ A besz√©lget√©s csak sz√≥ban zajlik (ha nem pip√°lsz chat-megjelen√≠t√©st).';
    }
    function stopRec(){
      recOn=false;
      try{ rec && rec.stop(); }catch{}
      micFab.classList.remove('on');
      vStatus.textContent='Le√°ll√≠tva. Koppints a üéôÔ∏è gombra az ind√≠t√°shoz.';
    }

    micFab.addEventListener('click', ()=> recOn ? stopRec() : startRec());
  </script>
</body>
</html>

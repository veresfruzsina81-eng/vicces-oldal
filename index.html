<!doctype html>
<html lang="hu" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>Tam√°s Mesters√©ges (AI)</title>
  <meta name="description" content="Hobbi fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens." />
  <meta property="og:title" content="Tam√°s Mesters√©ges (AI)" />
  <meta property="og:description" content="Hobbi fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/bg_tamas.jpg" />
  <link rel="icon" href="/favicon.ico" />

  <style>
    :root{
      --bg: #0b0f14;
      --panel:#0f1620cc;
      --bubbleUser:#ffb84d;
      --bubbleBot:#243447;
      --bubbleInfo:#1b2838;
      --text:#e8eef6;
      --muted:#9fb0c3;
      --accent:#6ea8fe;
      --glow: 0 10px 30px rgba(110,168,254,.18);
      --ring: 0 0 0 2px rgba(110,168,254,.35);
    }
    [data-theme="light"]{
      --bg:#f4f7fb;
      --panel:#ffffffd9;
      --bubbleUser:#ffd089;
      --bubbleBot:#eaf0f7;
      --bubbleInfo:#dde7f3;
      --text:#0c1624;
      --muted:#52657a;
      --accent:#2b74ff;
      --glow: 0 10px 26px rgba(43,116,255,.15);
      --ring: 0 0 0 2px rgba(43,116,255,.25);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    html{-webkit-text-size-adjust:100%}

    body{
      margin:0; font:16px/1.55 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:var(--text); background:var(--bg);
      overflow-y:auto;
      background-image: radial-gradient(transparent, rgba(0,0,0,.35)), url('/bg_tamas.jpg');
      background-size: cover; background-position: 50% 30%;
      background-attachment: fixed; /* mobilon lent fel√ºl√≠rjuk */
      transition: background-color .3s ease;
    }

    .wrap{max-width:1000px; margin:0 auto; padding:18px;}
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, var(--panel), transparent);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .brand{
      display:flex; align-items:center; gap:14px; padding:8px 10px 14px;
    }
    .brand .ttl{font-weight:800; font-size:24px; letter-spacing:.3px}
    .brand .sub{color:var(--muted); font-size:13px; margin-top:2px}

    .toolbar{margin-left:auto; display:flex; gap:10px}
    .btn{
      border:1px solid rgba(255,255,255,.12);
      background:var(--panel); color:var(--text);
      padding:8px 12px; border-radius:12px; cursor:pointer;
      font-weight:600; font-size:13px;
      box-shadow: var(--glow); transition:.2s transform, .2s background;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn-icon{width:40px; height:40px; display:grid; place-items:center; padding:0}

    .card{
      background:var(--panel);
      border:1px solid rgba(255,255,255,.08);
      border-radius:22px; padding:16px;
      box-shadow: var(--glow);
      height: min(78vh, 760px);
      display:flex; flex-direction:column; gap:10px;
    }

    .chat{display:flex; gap:16px; flex:1; min-height:0;}
    .col{flex:1; min-width:0; display:flex; flex-direction:column; min-height:0;}

    .chatlog{
      flex:1; min-height:0;
      overflow:auto; padding:16px;
      scroll-behavior:smooth;
      overscroll-behavior: contain;
    }

    @media (max-width:820px){
      .chat{flex-direction:column}
      .card{height:82vh}
    }

    .row{display:flex; margin:12px 0}
    .row.bot{justify-content:flex-start}
    .row.user{justify-content:flex-end}
    .bubble{
      max-width:min(640px, 92%); padding:14px 16px; border-radius:18px;
      border:1px solid rgba(255,255,255,.08);
      position:relative;
      word-wrap:break-word; white-space:pre-wrap;
    }
    .bot .bubble{background:var(--bubbleBot)}
    .user .bubble{background:var(--bubbleUser); color:#1f1200}
    .info .bubble{background:var(--bubbleInfo); color:var(--muted)}
    .bubble.glow{ box-shadow: var(--glow) }

    .composer{display:flex; align-items:center; gap:10px; padding:12px}
    .input{
      flex:1; display:flex; align-items:center; gap:10px; padding:10px 14px;
      background:var(--panel); border:1px solid rgba(255,255,255,.12);
      border-radius:16px; box-shadow: var(--glow);
    }
    .input input{
      flex:1; background:transparent; border:0; outline:none; color:var(--text);
      font-size:16px; /* iOS ne nagy√≠tson */
    }
    .send{padding:10px 16px; border-radius:16px; background:linear-gradient(90deg, #ffb84d, #ffa53a);
      color:#331d00; font-weight:800; border:0; cursor:pointer}
    .send:active{transform:translateY(1px)}

    .speak-toggle{
      width:38px; height:38px; border-radius:50%;
      display:grid; place-items:center; cursor:pointer;
      border:1px solid rgba(255,255,255,.14); background:var(--panel);
      box-shadow: var(--glow);
    }
    .speak-toggle.on{outline: var(--ring)}
    .speak-toggle svg{width:18px; height:18px; fill:var(--text)}

    footer{color:var(--muted); font-size:12px; text-align:center; padding:26px 8px 34px}

    /* Mobilon ne legyen fixed h√°tt√©r */
    @media (hover:none), (pointer:coarse){
      body{ background-attachment: scroll; }
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap brand">
      <div>
        <div class="ttl">Tam√°s Mesters√©ges (AI)</div>
        <div class="sub">Hobbi fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens</div>
      </div>
      <div class="toolbar">
        <button class="btn" id="themeBtn" title="T√©ma v√°lt√°s">Light / Dark</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="row bot info">
        <div class="bubble glow" id="hello">Szia! Itt vagyok neked, seg√≠tek mindenben. √çrj b√°tran! üòä</div>
      </div>

      <div class="chat">
        <div class="col">
          <div id="log" class="chatlog"></div>
          <!-- Chipek √©s Tipp sor elt√°vol√≠tva -->
          <div class="composer">
            <div class="input">
              <input id="txt" autocomplete="off" placeholder="√çrj ide‚Ä¶   Enter = k√ºld√©s, Shift+Enter = √∫j sor" />
              <div class="speak-toggle" id="ttsBtn" title="Felolvas√°s ki/be">
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10v4h4l5 5V5L7 10H3zm13.5 2a3.5 3.5 0 0 0-2.5 1.03v-2.14A5.5 5.5 0 0 1 22 12a5.5 5.5 0 0 1-8 4.93v-2.14A3.5 3.5 0 0 0 16.5 12z"/></svg>
              </div>
            </div>
            <button class="send" id="sendBtn">K√ºld√©s</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    ¬© Tam√°s AI ‚Äî v√©dett oldal. B√°rmilyen m√°sol√°s jogs√©rt√©snek min≈ës√ºl.
  </footer>

  <script>
    // ----- Parallax finom mozgat√°s -----
    (()=>{
      const isTouch = matchMedia('(hover:none), (pointer:coarse)').matches || 'ontouchstart' in window;
      if(isTouch) return;

      let px=50, py=30;
      const lerp=(a,b,t)=>a+(b-a)*t;
      function tick(){
        document.body.style.backgroundPosition = `${px}% ${py}%`;
        requestAnimationFrame(tick);
      }
      tick();
      window.addEventListener('mousemove',e=>{
        const x=e.clientX/window.innerWidth;
        const y=e.clientY/window.innerHeight;
        px=lerp(px, 45+10*(x-.5), .15);
        py=lerp(py, 28+6*(y-.5), .15);
      });
    })();

    // ----- T√©ma kapcsol√≥ -----
    const themeBtn = document.getElementById('themeBtn');
    themeBtn.addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme') || 'dark';
      const next = cur==='dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    });
    (()=>{
      const saved = localStorage.getItem('theme');
      if(saved) document.documentElement.setAttribute('data-theme', saved);
    })();

    // ----- Chat funkci√≥k -----
    const log = document.getElementById('log');
    const txt = document.getElementById('txt');
    const sendBtn = document.getElementById('sendBtn');
    const ttsBtn = document.getElementById('ttsBtn');

    let speakOn = false;
    ttsBtn.addEventListener('click', ()=>{
      speakOn = !speakOn;
      ttsBtn.classList.toggle('on', speakOn);
    });

    function addRow(kind, text){
      const r=document.createElement('div');
      r.className = `row ${kind}`;
      const b=document.createElement('div');
      b.className = 'bubble';
      if(kind==='bot') b.classList.add('glow');
      if(kind==='info') r.className='row bot info';
      b.textContent = text;
      r.appendChild(b);
      log.appendChild(r);
      log.scrollTop = log.scrollHeight;
      return b;
    }

    function addTyping(){
      const r=document.createElement('div'); r.className='row bot';
      const b=document.createElement('div'); b.className='bubble glow';
      const w=document.createElement('span'); w.className='typing';
      w.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      b.appendChild(w); r.appendChild(b); log.appendChild(r); log.scrollTop=log.scrollHeight;
      return r;
    }

    function speakHu(text){
      try{
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'hu-HU';
        u.rate = 1; u.pitch=1;
        window.speechSynthesis.speak(u);
      }catch(e){}
    }

    // kezdeti f√≥kusz
    txt.focus();

    async function ask(){
      const text = (txt.value || '').trim();
      if(!text) return;
      addRow('user', text);
      txt.value='';

      // helyi, k√©zzel √≠rt v√°laszok (r√∂gz√≠tett)
      const fixed = fixedAnswer(text);
      if(fixed){
        const b = addRow('bot', fixed);
        if(speakOn) speakHu(b.textContent);
        return;
      }

      const typing = addTyping();
      try{
        const r = await fetch('/.netlify/functions/chat', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ message: text })
        });
        typing.remove();

        if(!r.ok) throw new Error(`HTTP ${r.status}`);
        const data = await r.json();
        const reply = String(data.reply ?? '').trim() || "√ârtem. Miben seg√≠thetek m√©g?";
        const b = addRow('bot', reply);
        if(speakOn) speakHu(b.textContent);

      }catch(e){
        typing.remove();
        addRow('bot', `Hiba: ${e.message || e}`);
      }
    }

    sendBtn.addEventListener('click', ask);
    txt.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); ask(); }
    });

    // ----- R√∂gz√≠tett, helyi v√°laszok testreszab√°sa -----
    function fixedAnswer(s){
      const t = s.toLowerCase();
      if(/milyen modell|milyen ai|ki vagy te/.test(t)){
        return "Tam√°s modellje vagyok: ≈ë k√©sz√≠tett √©s fejleszt, hogy seg√≠tsek neked b√°rmiben. üòä";
      }
      if(/ki (k√©sz√≠tette|hozta l√©tre)|k√©sz√≠t≈ë|tulaj|fejleszt≈ë/.test(t)){
        return "Az oldalt Horv√°th Tam√°s (Szabolcs b√°cska) k√©sz√≠tette hobbi fejleszt√©sk√©nt. Folyamatosan csiszolja a funkci√≥kat. üë®‚Äçüíª";
      }
      if(/mes√©lj.*tam√°s|ki az a tam√°s/.test(t)){
        return "Tam√°s lelkes hobbifejleszt≈ë, aki sz√≠vesen k√≠s√©rletezik webes projektekkel √©s AI-val. J√≥ sz√≥rakoz√°st az oldalon! üöÄ";
      }
      if(/mai (nap|d√°tum)|h√°nyadika|milyen d√°tum/.test(t)){
        const now = new Date();
        const napok = ["vas√°rnap","h√©tf≈ë","kedd","szerda","cs√ºt√∂rt√∂k","p√©ntek","szombat"];
        const d = now.toLocaleDateString('hu-HU');
        return `Ma ${d}, ${napok[now.getDay()]}.`;
      }
      if(/k√∂vetkez≈ë napok|holnap|h√©ten/.test(t)){
        const napok = ["vas√°rnap","h√©tf≈ë","kedd","szerda","cs√ºt√∂rt√∂k","p√©ntek","szombat"];
        let out = [];
        let d = new Date();
        for(let i=1;i<=5;i++){
          d = new Date(d.getTime()+86400000);
          out.push(`${d.toLocaleDateString('hu-HU')} ‚Äî ${napok[d.getDay()]}`);
        }
        return "K√∂vetkez≈ë napok:\n" + out.join("\n");
      }
      return "";
    }
  </script>
</body>
</html>

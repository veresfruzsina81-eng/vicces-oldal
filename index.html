<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HT Chat ‚Äî Kellemes besz√©lget√©st!</title>
<style>
  :root{--bg:#0c1116;--panel:#111827;--muted:#9aa4b2;--text:#e5e7eb;--border:#1f2937}
  *{box-sizing:border-box} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;
  background:linear-gradient(180deg,#0b0f14,#0d131b 60%,#0b1220);color:var(--text)}
  .wrap{max-width:980px;margin:0 auto;padding:20px}
  header{margin-bottom:14px}
  .title{font-weight:800;letter-spacing:.3px;font-size:clamp(22px,4.5vw,30px);color:#fff}
  .subtitle{color:var(--muted);font-size:14px;margin-top:6px}
  .panel{background:rgba(255,255,255,.03);border:1px solid var(--border);
         border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
  .msgs{padding:16px;min-height:58vh;max-height:65vh;overflow:auto}
  .bubble{max-width:80%;padding:12px 14px;border-radius:14px;margin:8px 0;line-height:1.45;white-space:pre-wrap}
  .me{background:#0e1a2a;border:1px solid #1b2634}
  .ai{background:#162238;border:1px solid #22324d}
  .inputbar{display:flex;gap:8px;padding:12px;border-top:1px solid var(--border);
            background:rgba(0,0,0,.25);border-radius:0 0 14px 14px}
  input,button{color:var(--text)}
  input[type=text]{flex:1;padding:12px 14px;border-radius:10px;background:#0c1420;border:1px solid #203043;outline:none}
  input[type=text]::placeholder{color:#6b7280}
  .btn{padding:12px 14px;border-radius:10px;border:1px solid #2a3750;background:#182347;cursor:pointer}
  .btn:hover{filter:brightness(1.08)}
  .toolbar{display:flex;gap:12px;align-items:center;padding:10px 12px;border-top:1px solid var(--border);background:#0b1320}
  .switch{display:inline-flex;align-items:center;gap:8px;cursor:pointer}
  .sw{width:42px;height:24px;border-radius:999px;background:#263246;position:relative;border:1px solid #31405c}
  .knob{position:absolute;top:2px;left:2px;width:20px;height:20px;border-radius:50%;background:#9aa4b2;transition:.18s}
  .on{background:linear-gradient(90deg,#7c3aed,#06b6d4)} .on .knob{left:20px;background:#fff}
  .tag{color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">HT Chat ‚Äî Kellemes besz√©lget√©st! üéâ</div>
      <div class="subtitle">Az oldalt l√©tre hozta: <strong>H.T</strong> ‚Äî egyedi fejleszt√©ssel.</div>
    </header>

    <div class="panel">
      <div class="msgs" id="msgs"></div>

      <!-- Egyszer≈± TTS s√°v (csak ha t√°mogatott) -->
      <div class="toolbar" id="ttsBar" style="display:none">
        <span class="tag">üéß Felolvas√°s</span>
        <label class="switch" id="ttsToggle">
          <div class="sw" id="sw"><div class="knob"></div></div>
          <span id="ttsState" class="tag">Ki</span>
        </label>
        <button class="btn" id="stopBtn" title="Meg√°ll√≠t">‚èπ Meg√°ll√≠t</button>
      </div>

      <div class="inputbar">
        <input id="inp" type="text" placeholder="√çrj egy √ºzenetet‚Ä¶ (Enter = k√ºld√©s)" />
        <button id="send" class="btn" title="K√ºld√©s">K√ºld√©s</button>
      </div>
    </div>
  </div>

<script>
  // ===== UI =====
  const msgsEl = document.getElementById('msgs');
  const inpEl  = document.getElementById('inp');
  const sendEl = document.getElementById('send');

  // ===== TTS (egyszer≈±) =====
  const ttsBar = document.getElementById('ttsBar');
  const ttsToggle = document.getElementById('ttsToggle');
  const sw = document.getElementById('sw');
  const ttsState = document.getElementById('ttsState');
  const stopBtn = document.getElementById('stopBtn');

  let history = [];
  let ttsEnabled = false;

  function addBubble(text, who='assistant'){
    const b = document.createElement('div');
    b.className = 'bubble ' + (who==='user' ? 'me' : 'ai');
    b.textContent = text; msgsEl.appendChild(b); msgsEl.scrollTop = msgsEl.scrollHeight; return b;
  }

  const ttsSupported = 'speechSynthesis' in window && 'SpeechSynthesisUtterance' in window;
  function setSwitch(on){
    ttsEnabled = !!on;
    if(on){ sw.classList.add('on'); ttsState.textContent='Be'; }
    else  { sw.classList.remove('on'); ttsState.textContent='Ki'; speechSynthesis.cancel(); }
    localStorage.setItem('ttsEnabled', on ? '1' : '0');
  }
  function speak(text){
    if(!ttsEnabled || !ttsSupported) return;
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 1; u.pitch = 1;
    speechSynthesis.cancel(); speechSynthesis.speak(u);
  }
  if(ttsSupported){
    ttsBar.style.display='flex';
    setSwitch(localStorage.getItem('ttsEnabled')==='1');
    ttsToggle.onclick = ()=> setSwitch(!ttsEnabled);
    stopBtn.onclick = ()=> speechSynthesis.cancel();
  }

  // ===== OpenAI h√≠v√°s (Netlify function) =====
  async function askOpenAI(message){
    const system = "Magyarul v√°laszolj, bar√°ts√°gosan √©s t√∂m√∂ren.";
    const body = { messages: [{role:'system',content:system}, ...history, {role:'user',content:message}] };
    const r = await fetch('/.netlify/functions/chat', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
    if(!r.ok) throw new Error('Szerver hiba: '+r.status);
    const data = await r.json();
    return data?.reply || 'Most nem tudok v√°laszolni.';
  }

  async function send(){
    const text = inpEl.value.trim(); if(!text) return;
    addBubble(text,'user'); history.push({role:'user',content:text});
    inpEl.value=''; inpEl.focus();
    const thinking = addBubble('Gondolkodom‚Ä¶','assistant');
    try{
      const reply = await askOpenAI(text);
      thinking.textContent = reply; history.push({role:'assistant',content:reply});
      speak(reply);
    }catch(e){
      thinking.textContent = 'Hopp, hiba t√∂rt√©nt. Pr√≥b√°ld √∫jra.'; console.error(e);
    }
  }
  sendEl.onclick = send;
  inpEl.addEventListener('keydown', e => { if(e.key==='Enter') send(); });

  // √údv√∂zl√©s
  addBubble('Szia! √çrj egy √ºzenetet, √©s v√°laszolok. üòä','assistant');
</script>
</body>
</html>

<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tam√°s Mesters√©ges (AI)</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Ccircle cx='64' cy='64' r='60' fill='%23f5a623'/%3E%3Ctext x='50%' y='58%' dominant-baseline='middle' text-anchor='middle' font-size='64' fill='%23000' font-family='Segoe UI, Roboto, system-ui' %3Eü§ñ%3C/text%3E%3C/svg%3E" />
<style>
  :root{
    --bg: #0b0f18;
    --text: #e9eef6;
    --muted: #b8c2d3;
    --bubble: rgba(15,18,26,.75);
    --bubble-light: rgba(255,255,255,.75);
    --accent: #ffb23d;
    --ring: rgba(255,178,61,.35);
    --glass: rgba(14,18,26,.55);
    --glass-border: rgba(255,255,255,.08);
  }
  [data-theme="light"]{
    --bg:#f4f6fb; --text:#0e1420; --muted:#40506a;
    --bubble: rgba(255,255,255,.75);
    --bubble-light: rgba(255,255,255,.85);
    --glass: rgba(255,255,255,.55);
    --glass-border: rgba(0,0,0,.08);
  }

  *{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; font: 16px/1.45 "Segoe UI", Roboto, system-ui, -apple-system, Arial, sans-serif;
    color:var(--text); background:var(--bg) fixed;
    overflow:hidden; /* saj√°t g√∂rget≈ë a chat dobozban */
  }

  /* H√°tt√©rk√©p + √ºveges scrim, NEM blokkolja a kattint√°sokat */
  .bg{
    position:fixed; inset:0; z-index:-2;
    background:#000 center/cover no-repeat url("bg_tamas.jpg");
    transform: translateZ(0);
  }
  .scrim{
    position:fixed; inset:0; z-index:-1;
    backdrop-filter: blur(6px) saturate(1.05);
    -webkit-backdrop-filter: blur(6px) saturate(1.05);
    background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.25) 40%, rgba(0,0,0,.35));
    pointer-events: none;     /* <<< NAGYON FONTOS: ne takarja a gombokat */
  }

  /* Fejl√©c */
  header{
    position:fixed; left:0; right:0; top:0;
    padding:16px 20px 10px;
    display:flex; align-items:center; justify-content:space-between;
    gap:12px;
  }
  .glass{
    background:var(--glass);
    border:1px solid var(--glass-border);
    border-radius:20px;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
    backdrop-filter: blur(10px) saturate(1.2);
    -webkit-backdrop-filter: blur(10px) saturate(1.2);
  }
  .brand{
    padding:18px 20px;
  }
  h1{ margin:0; font-size:28px; letter-spacing:.2px }
  .subtitle{ margin-top:6px; color:var(--muted); font-size:14px }

  .theme-toggle{
    padding:14px 16px; cursor:pointer; user-select:none;
  }

  /* Chat k√°rtya */
  .chat{
    position:fixed; inset:120px 16px 92px 16px;   /* headert≈ël le, input f√∂l√© */
    overflow:auto; padding:12px;
    scroll-behavior:smooth;
  }
  .bubble{
    max-width:min(780px, 92%);
    padding:18px 20px;
    margin:12px 8px;
    border-radius:18px;
    background: var(--bubble);
    color: var(--text);
    border:1px solid var(--glass-border);
    box-shadow: 0 8px 20px rgba(0,0,0,.25);
    text-shadow: 0 1px 1px rgba(0,0,0,.35);
  }
  .bubble.user{
    margin-left:auto;
    background: linear-gradient(180deg, #ffc05b, #ff9d2e);
    color:#211000; text-shadow:none;
    border: none; box-shadow: 0 10px 25px rgba(255,157,46,.35);
  }

  .actions{
    display:flex; gap:12px; margin:8px 8px 4px;
  }
  .chip{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px; border-radius:14px; font-size:14px;
    background:rgba(0,0,0,.35); border:1px solid var(--glass-border);
    cursor:pointer; user-select:none;
  }
  [data-theme="light"] .chip{ background:rgba(0,0,0,.06) }

  .chip .ico{ font-size:16px }

  /* Input-s√°v */
  .composer{
    position:fixed; left:0; right:0; bottom:0;
    padding:10px 16px 16px;
  }
  form{
    display:flex; gap:12px; align-items:center;
    padding:10px; border-radius:20px;
  }
  .field{
    flex:1; border:none; outline:none; padding:14px 16px;
    border-radius:14px; color:var(--text);
    background: var(--glass);
    border:1px solid var(--glass-border);
  }
  .field::placeholder{ color:color-mix(in oklab, var(--muted) 85%, transparent) }
  .send{
    padding:14px 18px; border:none; border-radius:14px;
    background:linear-gradient(180deg, #ffc05b, #ff9d2e); color:#1a0e00;
    font-weight:600; cursor:pointer;
    box-shadow: 0 10px 25px var(--ring);
  }

  /* Als√≥ jog */
  footer{
    position:fixed; left:0; right:0; bottom:0;
    transform: translateY(58px);   /* az input alatt, de kil√≥g√°smentesen */
    text-align:center; color:var(--muted); font-size:13px; padding-bottom:10px;
    text-shadow: 0 1px 1px rgba(0,0,0,.35);
  }

  /* kisebb k√©perny≈ë finomhang */
  @media (min-width: 900px){
    .chat{ inset:120px 24px 96px 24px }
    .bubble{ max-width: 820px }
  }
</style>
</head>
<body>

  <div class="bg"></div>
  <div class="scrim"></div>

  <header class="glass">
    <div class="brand">
      <h1>Tam√°s Mesters√©ges (AI)</h1>
      <div class="subtitle">Halad√≥ fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens</div>
    </div>
    <div id="themeBtn" class="theme-toggle glass">Light / Dark<br><small>(auto)</small></div>
  </header>

  <main id="chat" class="chat" aria-live="polite" aria-label="Besz√©lget√©s ter√ºlet"></main>

  <div class="composer">
    <form id="composer" class="glass">
      <input id="message" class="field" type="text" placeholder="√çrj ide‚Ä¶  Enter = k√ºld√©s" autocomplete="off" />
      <button id="sendBtn" class="send" type="submit">K√ºld√©s</button>
    </form>
  </div>

  <footer>¬© Tam√°s AI ‚Äî v√©dett oldal. B√°rmilyen m√°sol√°s jogs√©rt√©snek min≈ës√ºl.</footer>

<script>
(() => {
  const el = {
    chat: document.getElementById('chat'),
    form: document.getElementById('composer'),
    input: document.getElementById('message'),
    sendBtn: document.getElementById('sendBtn'),
    themeBtn: document.getElementById('themeBtn')
  };

  /* ======= T√©ma (auto / k√©zi v√°lt√°s) ======= */
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
  const applyTheme = (mode) => {
    const root = document.documentElement;
    if(mode === 'auto'){
      root.removeAttribute('data-theme'); // rendszer szerint
      el.themeBtn.innerHTML = 'Light / Dark<br><small>(auto)</small>';
    }else{
      root.setAttribute('data-theme', mode);
      el.themeBtn.innerHTML = (mode==='light'?'Dark / Light':'Light / Dark') + '<br><small>(k√©zi)</small>';
    }
  };
  let savedTheme = localStorage.getItem('t_theme') || 'auto';
  applyTheme(savedTheme);
  prefersDark.addEventListener?.('change', () => savedTheme==='auto' && applyTheme('auto'));
  el.themeBtn.addEventListener('click', () => {
    savedTheme = savedTheme==='auto' ? (prefersDark.matches?'dark':'light')
               : savedTheme==='dark' ? 'light' : 'dark';
    localStorage.setItem('t_theme', savedTheme);
    applyTheme(savedTheme);
  });

  /* ======= Kiseg√≠t≈ë: besz√©d felolvas√°s ======= */
  const speak = (text) => {
    try{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'hu-HU'; u.rate = 1.0; u.pitch = 1.0;
      speechSynthesis.cancel(); speechSynthesis.speak(u);
    }catch(_){}
  };

  const copyText = async (text) => {
    try{ await navigator.clipboard.writeText(text); }catch(_){}
  };

  /* ======= √úzenet rajzol√≥ ======= */
  function addMsg(text, who='bot'){
    const wrap = document.createElement('div');
    wrap.className = 'bubble' + (who==='user' ? ' user' : '');
    wrap.textContent = text;
    el.chat.appendChild(wrap);

    // Bot akci√≥k (felolvas√°s / m√°sol√°s) ‚Äì csak botn√°l
    if(who==='bot'){
      const actions = document.createElement('div');
      actions.className = 'actions';
      actions.innerHTML = `
        <div class="chip" data-act="speak"><span class="ico">üîä</span>Felolvas√°s</div>
        <div class="chip" data-act="copy"><span class="ico">üìã</span>M√°sol√°s</div>
      `;
      actions.addEventListener('click', (e)=>{
        const btn = e.target.closest('.chip'); if(!btn) return;
        if(btn.dataset.act==='speak') speak(text);
        if(btn.dataset.act==='copy') copyText(text);
      });
      el.chat.appendChild(actions);
    }

    // autoscroll
    el.chat.scrollTop = el.chat.scrollHeight;
    return wrap;
  }

  // Kezd≈ë k√∂sz√∂nt√©s
  addMsg('Szia! Itt vagyok neked, seg√≠tek mindenben. √çrj b√°tran! üòä','bot');

  /* ======= Fix gyors v√°laszok (helyi logika) ======= */
  function fixedAnswer(q){
    const t = q.trim().toLowerCase();
    if(!t) return null;

    // ‚Äûki k√©sz√≠tett‚Äù k√©rd√©s ‚Äì maradjon
    if(t.includes('ki k√©sz√≠tette') || t.includes('ki k√©szitett') || t.includes('ki k√©sz√≠tett t√©ged')){
      return 'Az oldalt Horv√°th Tam√°s (Szabolcsb√°ka) k√©sz√≠tette hobbi fejleszt√©sk√©nt; folyamatosan tanul √©s k√≠s√©rletezik webes projektekkel.';
    }
    // P√©lda: d√°tum/id≈ë
    if(t.includes('h√°ny √≥ra') || t.includes('mennyi az id≈ë')){
      const now = new Date();
      const hh = now.getHours().toString().padStart(2,'0');
      const mm = now.getMinutes().toString().padStart(2,'0');
      return `Most ${hh}:${mm} van.`;
    }
    if(t.includes('mi a mai d√°tum') || t.includes('milyen d√°tum van ma')){
      const d = new Date();
      return d.toLocaleDateString('hu-HU', {year:'numeric', month:'2-digit', day:'2-digit', weekday:'long'});
    }
    return null;
  }

  /* ======= K√ºld√©s kezel√©se ======= */
  async function send(text){
    const userText = text ?? el.input.value;
    const cleaned = userText.trim();
    if(!cleaned) return;

    addMsg(cleaned,'user');
    el.input.value = '';

    // helyi fix v√°lasz?
    const fx = fixedAnswer(cleaned);
    if(fx){ addMsg(fx,'bot'); return; }

    // H√≠v√°s a Netlify funkci√≥ra
    addMsg('‚Ä¶','bot'); // info placeholder helyett pici ‚Äûgondolkodik‚Äù
    const thinking = el.chat.lastChild.previousSibling; // a bubor√©k

    try{
      const r = await fetch('/.netlify/functions/chat', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ message: cleaned })
      });
      if(!r.ok) throw new Error('HTTP '+r.status);
      const data = await r.json();

      // csere a kapott sz√∂vegre
      thinking.textContent = (data.reply || '').trim() || 'Bocsi, most nem j√∂tt v√°lasz.';
    }catch(err){
      // biztons√°gos, cs√∂ndes hiba ‚Äì bar√°ts√°gos fallback
      thinking.textContent = 'Bocsi, most √©pp nem √©rem el a szervert. √çrj m√°sk√©nt: mit szeretn√©l pontosan? üòä';
    }
    // autoscroll
    el.chat.scrollTop = el.chat.scrollHeight;
  }

  // form submit + gomb click (mobilon is)
  el.form.addEventListener('submit', (e)=>{ e.preventDefault(); send(); });
  el.sendBtn.addEventListener('click', (e)=>{ e.preventDefault(); el.form.requestSubmit(); });

  // Enter = k√ºld√©s, Shift+Enter = √∫j sor (mobil billenty≈±n is)
  el.input.addEventListener('keydown', (e)=>{
    if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); el.form.requestSubmit(); }
  });
})();
</script>
</body>
</html>

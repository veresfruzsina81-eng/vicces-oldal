<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tam√°s Mesters√©ges (AI)</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='46' fill='%23f59e0b'/%3E%3Ctext x='50' y='58' font-size='46' text-anchor='middle' fill='black' font-family='Segoe UI,Roboto,Helvetica,Arial,sans-serif'%3ET%3C/text%3E%3C/svg%3E" />
  <style>
    :root{
      --rad: 18px;
      --pad: 16px;
      --glass-bg: rgba(0,0,0,.28);    /* s√∂t√©t √ºveg ‚Äî h√°tt√©r √©les marad */
      --glass-stroke: rgba(255,255,255,.14);
      --user-bg: linear-gradient(180deg,#ffb648,#f59e0b);
      --fg: #e8eef7;
      --fg-dim: #c9d4e3;
      --hint: #a6b3c3;
      --chip: rgba(255,255,255,.16);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--fg);
      background:#0b0f14;
      overflow:hidden; /* saj√°t scroll a chat-en bel√ºl */
    }

    /* H√°tt√©r ‚Äî √âLES marad, nem hom√°lyos√≠tjuk */
    .bg{
      position:fixed; inset:0;
      background:url('bg_tamas.jpg') center/cover no-repeat fixed;
      filter:none;       /* fontos: nincs blur */
      z-index:-2;
    }
    /* Finom s√∂t√©t√≠t√©si √°tmenet, hogy az √≠r√°s olvashat√≥ maradjon */
    .vignette{
      position:fixed; inset:0;
      background:radial-gradient(1200px 800px at 50% 20%, rgba(0,0,0,.08), transparent 40%),
                 linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,.55));
      z-index:-1;
    }

    header{
      position:fixed; left:16px; right:16px; top:16px;
      border-radius: 22px;
      padding: 18px 20px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-stroke);
      backdrop-filter: blur(8px) saturate(120%);
      box-shadow: var(--shadow);
      display:flex; align-items:center; gap:16px; justify-content:space-between;
    }
    .brand{
      line-height:1.1;
    }
    .brand h1{
      margin:0; font-size: clamp(22px,4.5vw,32px); font-weight:800;
      letter-spacing:.2px;
    }
    .brand .sub{
      margin-top:4px; color:var(--fg-dim); font-size:14px;
    }
    .mode{
      font-size:12px; color:var(--hint);
      background: var(--chip); padding:8px 10px; border-radius:12px;
      border:1px solid var(--glass-stroke);
      user-select:none;
    }

    .wrap{
      position:fixed; left:16px; right:16px; top:calc(80px + 24px); bottom:16px;
      display:grid; grid-template-rows: 1fr auto auto; gap:12px;
    }

    /* √úzenetek panel (saj√°t scroll) */
    .panel{
      overflow:auto;
      padding: 12px;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.28));
      border:1px solid var(--glass-stroke);
      backdrop-filter: blur(6px) saturate(120%);
      box-shadow: var(--shadow);
      scroll-behavior:smooth;
    }

    .msg{
      max-width: min(780px, 92%);
      margin: 14px 10px;
      padding: var(--pad);
      border-radius: var(--rad);
      position:relative;
    }
    .msg.bot{
      background: var(--glass-bg);
      border:1px solid var(--glass-stroke);
      backdrop-filter: blur(8px) saturate(125%);
      color: var(--fg);
    }
    .msg.user{
      margin-left:auto;
      color:#1a1105;
      background: var(--user-bg);
      border:1px solid rgba(0,0,0,.08);
      box-shadow: 0 6px 18px rgba(245,158,11,.35);
    }
    .tools{
      display:flex; gap:10px; margin-top:8px; flex-wrap:wrap;
    }
    .tool{
      display:inline-flex; align-items:center; gap:8px;
      background: var(--chip);
      border:1px solid var(--glass-stroke);
      color: var(--fg);
      padding: 8px 10px; border-radius: 12px;
      font-size: 13px; cursor:pointer; user-select:none;
    }
    .tool:active{ transform: translateY(1px); }

    /* Aj√°nlott k√©rd√©s ‚Äûchipek‚Äù alul (fix, 2 sorban t√∂rhet) */
    .chips{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      margin: -2px 2px 0 2px;
    }
    .chip{
      background: var(--chip);
      border:1px solid var(--glass-stroke);
      color: var(--fg);
      padding:8px 12px; border-radius:999px; font-size:13px; cursor:pointer;
    }

    /* Beviteli sor */
    .composer{
      display:flex; gap:10px; align-items:center;
      background: var(--glass-bg);
      border:1px solid var(--glass-stroke);
      backdrop-filter: blur(8px) saturate(120%);
      border-radius: 18px;
      padding: 10px;
    }
    .composer input{
      flex:1; min-width:0; border:0; outline:0;
      font-size:16px; padding:12px 14px; color:var(--fg);
      background: rgba(255,255,255,.08);
      border-radius:12px;
    }
    .btn{
      border:0; outline:0; cursor:pointer;
      color:#1a1105; font-weight:700; font-size:16px;
      background: var(--user-bg);
      border-radius:14px; padding:12px 18px;
      box-shadow: 0 6px 18px rgba(245,158,11,.35);
      white-space:nowrap;
    }

    /* Mobil: kicsit t√∂bb kontraszt √©s t√©rk√∂z */
    @media (max-width: 520px){
      .wrap{ top: calc(72px + 20px); gap:10px; }
      .msg{ max-width: 96%; }
      .panel{ padding: 10px; }
      .brand .sub{ font-size:13px; }
    }
  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="vignette"></div>

  <header>
    <div class="brand">
      <h1>Tam√°s Mesters√©ges (AI)</h1>
      <div class="sub">Halad√≥ fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens</div>
    </div>
    <div class="mode">Light / Dark (auto)</div>
  </header>

  <main class="wrap">
    <!-- √ºzenetek -->
    <section id="panel" class="panel" aria-live="polite">
      <div class="msg bot">
        Szia! Itt vagyok neked, seg√≠tek mindenben. √çrj b√°tran! üòä
        <div class="tools">
          <div class="tool" data-act="speak">üîä Felolvas√°s</div>
          <div class="tool" data-act="copy">üìã M√°sol√°s</div>
        </div>
      </div>
    </section>

    <!-- aj√°nlott k√©rd√©sek (KI K√âSZ√çTETTE‚Ä¶ elt√°vol√≠tva, ahogy k√©rted) -->
    <div class="chips" id="chips">
      <div class="chip">Mes√©lj Horv√°th Tam√°sr√≥l r√∂viden!</div>
      <div class="chip">Milyen modell vagy?</div>
      <div class="chip">Mi a mai d√°tum?</div>
      <div class="chip">Mit tudsz csin√°lni?</div>
    </div>

    <!-- beviteli sor -->
    <form id="composer" class="composer">
      <input id="text" autocomplete="off" placeholder="√çrj ide‚Ä¶  Enter = k√ºld√©s" />
      <button class="btn" type="submit">K√ºld√©s</button>
    </form>
  </main>

  <script>
    // ===== Seg√©dhang (k√ºld√©s ‚Äûpling‚Äù) =====
    const sendPing = new Audio(
      "data:audio/wav;base64,UklGRoABAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYBAGZmZmZmAA=="
    ); // r√∂vid ‚Äûtick‚Äù (nagyon pici be√©p√≠tett hang)

    // ===== Sz√∂veg-besz√©d (bot felolvas√°s) =====
    function speakHu(t){
      try{
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'hu-HU';
        u.rate = 1.02;
        speechSynthesis.cancel();
        speechSynthesis.speak(u);
      }catch{}
    }

    // ===== √úzenet DOM-hoz =====
    const panel = document.getElementById('panel');
    const composer = document.getElementById('composer');
    const input = document.getElementById('text');
    const chips = document.getElementById('chips');

    function addMsg(text, who='bot'){
      const div = document.createElement('div');
      div.className = 'msg ' + (who === 'user' ? 'user':'bot');
      div.innerHTML = sanitize(text);
      panel.appendChild(div);

      if(who==='bot'){
        const tools = document.createElement('div');
        tools.className = 'tools';
        tools.innerHTML = `
          <div class="tool" data-act="speak">üîä Felolvas√°s</div>
          <div class="tool" data-act="copy">üìã M√°sol√°s</div>
        `;
        div.appendChild(tools);
      }
      panel.scrollTop = panel.scrollHeight;
      return div;
    }

    // minim√°l sanitization (√∫j sorok, linkek)
    function sanitize(t=''){
      return String(t)
        .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
        .replace(/\n/g,'<br/>')
        .replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank" rel="noopener">$1</a>');
    }

    // ===== ‚ÄûOkosabb‚Äù k√©rd√©s booster (r√©szletes, konkr√©t v√°laszokat k√©r)
    const BOOST = "K√©rlek, mindig magyarul, konkr√©tan √©s l√©nyegre t√∂r≈ëen v√°laszolj, " +
                  "gyakorlati p√©ld√°kkal √©s 3‚Äì6 mondatban. Ker√ºld a sablonos kit√©r≈ëket.";

    async function askAI(text){
      // UI: g√©pel√©s-jelz≈ë
      const info = addMsg("‚Ä¶", "bot");

      try{
        const r = await fetch("/.netlify/functions/chat",{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ message: `${BOOST}\n\nK√©rd√©s: ${text}` })
        });
        if(!r.ok) throw new Error(`HTTP ${r.status}`);
        const data = await r.json();
        const reply = (data.reply || "").trim() || "Rendben! Miben szeretn√©l m√©g pontosabban seg√≠ts√©get?";
        info.innerHTML = sanitize(reply);

        // eszk√∂z sor hozz√° (felolvas√°s / m√°sol√°s)
        const tools = document.createElement('div');
        tools.className = 'tools';
        tools.innerHTML = `
          <div class="tool" data-act="speak">üîä Felolvas√°s</div>
          <div class="tool" data-act="copy">üìã M√°sol√°s</div>
        `;
        info.appendChild(tools);
        panel.scrollTop = panel.scrollHeight;

      }catch(e){
        info.innerHTML = `Hiba: ${sanitize(e.message || e)}`;
      }
    }

    // ===== Esem√©nyek =====
    composer.addEventListener('submit', (ev)=>{
      ev.preventDefault();
      const t = input.value.trim();
      if(!t) return;
      sendPing.currentTime = 0; sendPing.play().catch(()=>{});
      addMsg(t, 'user');
      input.value = "";
      panel.scrollTop = panel.scrollHeight;
      askAI(t);
    });

    // aj√°nl√≥ chipek
    chips.addEventListener('click', (e)=>{
      const c = e.target.closest('.chip'); if(!c) return;
      input.value = c.textContent.trim();
      input.focus();
    });

    // felolvas√°s / m√°sol√°s gombok a panelen
    panel.addEventListener('click', (e)=>{
      const tool = e.target.closest('.tool'); if(!tool) return;
      const act = tool.dataset.act;
      const root = tool.closest('.msg'); if(!root) return;
      const text = root.innerText.replace(/Felolvas√°s|M√°sol√°s/g,'').trim();

      if(act==='copy'){
        navigator.clipboard?.writeText(text).then(()=>{
          tool.textContent = '‚úÖ M√°solva';
          setTimeout(()=>tool.textContent='üìã M√°sol√°s',1200);
        });
      }else if(act==='speak'){
        speakHu(text);
      }
    });

    // f√≥kusz: Enter k√ºld, Shift+Enter √∫j sor
    input.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && !e.shiftKey){
        e.preventDefault();
        composer.requestSubmit();
      }
    });
  </script>
</body>
</html>

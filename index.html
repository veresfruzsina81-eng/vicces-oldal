<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HT Chat ‚Äî Kellemes besz√©lget√©st!</title>
<style>
  :root{
    --bg1:#0f0f16;
    --bg2:#1b1b2a;
    --glass: rgba(255,255,255,.08);
    --glass-strong: rgba(255,255,255,.12);
    --text:#e9e9f2;
    --muted:#b8b8c9;
    --brand:#ff9933;
    --brand-2:#ffb65c;
    --ok:#46d38d;
    --danger:#ff6b6b;
  }

  /* h√°tt√©r ‚Äì l√°gy 3D hat√°s anim√°lt foltokkal */
  body{
    margin:0;
    color:var(--text);
    font:15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:
      radial-gradient(1200px 800px at 10% 10%, #22284a 0%, transparent 60%),
      radial-gradient(900px 700px at 90% 20%, #2a1f32 0%, transparent 60%),
      linear-gradient(160deg, var(--bg1), var(--bg2));
    min-height:100svh;
    overflow-y:auto;
  }
  .blob{
    position:fixed; inset:auto;
    filter: blur(60px); opacity:.35; z-index:0; pointer-events:none;
    animation: float 22s ease-in-out infinite;
  }
  .blob.b1{ width:420px; height:420px; left:-120px; top:-120px; background: #6a4cff; }
  .blob.b2{ width:360px; height:360px; right:-100px; top:20vh; background: #ff4c7e; animation-delay:-7s; }
  .blob.b3{ width:380px; height:380px; left:10vw; bottom:-120px; background: #1cc8a0; animation-delay:-12s; }
  @keyframes float{
    0%,100%{ transform: translateY(0) rotate(0deg) scale(1); }
    50%{ transform: translateY(-20px) rotate(10deg) scale(1.03); }
  }

  header{
    position:relative; z-index:1;
    text-align:center; padding:28px 16px 10px;
  }
  .title{
    font-size:clamp(26px, 4vw, 40px);
    font-weight:900;
    letter-spacing:.5px;
    color:var(--brand);
    text-shadow: 0 2px 0 rgba(0,0,0,.35);
  }
  .subtitle{
    margin-top:6px; color:var(--muted); font-size:14px;
  }

  /* k√°rtya (chat doboz) */
  .card{
    position:relative; z-index:1;
    max-width:820px; margin:18px auto 40px; padding:0;
    background: linear-gradient(180deg, var(--glass-strong), var(--glass));
    border:1px solid rgba(255,255,255,.12);
    border-radius:20px; backdrop-filter: blur(16px);
    box-shadow: 0 20px 60px rgba(0,0,0,.45);
  }

  .toolbar{
    display:flex; align-items:center; gap:14px;
    padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08);
  }
  .switch{
    display:inline-flex; align-items:center; gap:10px; user-select:none; cursor:pointer;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.08);
    padding:8px 10px; border-radius:999px; font-size:13px; color:var(--text);
  }
  .switch input{ appearance:none; width:38px; height:22px; background:#3a3a4a; border-radius:999px; position:relative; outline:none; cursor:pointer; }
  .switch input:before{
    content:""; position:absolute; width:18px; height:18px; border-radius:50%;
    background:#fff; top:2px; left:2px; transition:.18s ease;
  }
  .switch input:checked{ background:linear-gradient(90deg, var(--brand), var(--brand-2)); }
  .switch input:checked:before{ left:18px; }

  .messages{
    height:64svh; /* kompaktabb */
    overflow-y:auto; padding:18px 16px 10px;
    scroll-behavior:smooth;
  }

  .row{ display:flex; margin:10px 0; gap:10px; }
  .row.user{ justify-content:flex-end; }
  .bubble{
    max-width:min(76%, 560px);
    background:#363649;
    color:#f2f2f6;
    padding:12px 14px; border-radius:16px;
    box-shadow: 0 10px 20px rgba(0,0,0,.25);
    border:1px solid rgba(255,255,255,.06);
    animation: pop .16s ease-out both;
    white-space:pre-wrap; word-break:break-word;
  }
  .row.user .bubble{
    background: linear-gradient(180deg, var(--brand-2), var(--brand));
    color:#1d1205; border-color:rgba(0,0,0,.08);
  }
  @keyframes pop{ from{ transform:scale(.98) translateY(2px); opacity:.0;} to{transform:scale(1) translateY(0); opacity:1;} }

  .hint{ color:var(--muted); font-size:12px; margin-top:4px; }

  .composer{
    display:flex; gap:10px; padding:14px; border-top:1px solid rgba(255,255,255,.08);
    position:sticky; bottom:0; background:linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.18));
    backdrop-filter: blur(16px);
  }
  .composer input{
    flex:1; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06); color:var(--text); outline:none;
  }
  .composer button{
    padding:12px 16px; border-radius:12px; border:none; cursor:pointer;
    background:linear-gradient(90deg, var(--brand), var(--brand-2)); color:#1b1206; font-weight:700;
    box-shadow: 0 8px 18px rgba(255,153,51,.25);
  }
  .btn-secondary{
    background:#2e2e3f; color:#e7e7ef; font-weight:600; box-shadow:none;
    border:1px solid rgba(255,255,255,.1);
  }

  .error{ background:#3a1f26; color:#ffd7d7; border-left:4px solid var(--danger); }
</style>
</head>
<body>
  <!-- anim√°lt ‚Äú3D‚Äù h√°tt√©rfoltok -->
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>

  <header>
    <div class="title">HT Chat ‚Äî Kellemes besz√©lget√©st! ü§ù</div>
    <div class="subtitle">Az oldalt l√©trehozta <b>H.T</b> ‚Äî egyedi fejleszt√©ssel.</div>
  </header>

  <main class="card" role="region" aria-label="Cseveg≈ë k√°rtya">
    <div class="toolbar">
      <label class="switch" title="M√°sol√°s az utols√≥ bot v√°laszra">
        <input type="checkbox" id="copyToggle" />
        <span>M√°sol√°s (utols√≥ v√°lasz)</span>
      </label>
      <label class="switch" title="Felolvas√°s enged√©lyez√©se">
        <input type="checkbox" id="speakToggle" />
        <span>Hang (felolvas√°s)</span>
      </label>
      <div class="hint">Tipp: Enter = k√ºld√©s, Shift+Enter = √∫j sor</div>
    </div>

    <div id="messages" class="messages" aria-live="polite">
      <div class="row bot">
        <div class="bubble">Szia! √çrj egy √ºzenetet, √©s v√°laszolok. üôÇ</div>
      </div>
    </div>

    <div class="composer">
      <input id="userInput" type="text" placeholder="√çrj ide‚Ä¶" autocomplete="off" />
      <button id="sendBtn" onclick="sendMessage()">K√ºld√©s</button>
      <button class="btn-secondary" id="stopBtn" onclick="stopSpeech()" title="Felolvas√°s meg√°ll√≠t√°sa">Meg√°ll√≠t</button>
    </div>
  </main>

<script>
  const messagesEl = document.getElementById("messages");
  const userInput   = document.getElementById("userInput");
  const copyToggle  = document.getElementById("copyToggle");
  const speakToggle = document.getElementById("speakToggle");
  const sendBtn     = document.getElementById("sendBtn");

  function addMessage(text, who="bot", extraClass=""){
    const row = document.createElement("div");
    row.className = `row ${who}`;
    const b = document.createElement("div");
    b.className = `bubble ${extraClass}`;
    b.textContent = text;
    row.appendChild(b);
    messagesEl.appendChild(row);
    // g√∂rd√ºlj√∂n le a legv√©g√©re, de maradjon sima
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  async function sendMessage(){
    const text = userInput.value.trim();
    if(!text) return;
    userInput.value = "";
    addMessage(text, "user");

    // lez√°rjuk a k√ºld√©s gombot, m√≠g v√°lasz j√∂n
    sendBtn.disabled = true;
    sendBtn.textContent = "K√ºld√©s‚Ä¶";

    try{
      const r = await fetch("/.netlify/functions/chat", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({ message: text })
      });
      const data = await r.json();

      if(!r.ok || data.error){
        addMessage("Hiba: " + (data.error || r.status + " " + r.statusText), "bot", "error");
      }else{
        const reply = data.reply || "Bocs, most nem tudok v√°laszolni.";
        addMessage(reply, "bot");

        // M√°sol√°s (utols√≥ v√°lasz)
        if(copyToggle.checked) {
          try{ await navigator.clipboard.writeText(reply); }catch(e){}
        }
        // Felolvas√°s
        if(speakToggle.checked){
          speak(reply);
        }
      }
    }catch(e){
      addMessage("Hiba: " + e.message, "bot", "error");
    }finally{
      sendBtn.disabled = false;
      sendBtn.textContent = "K√ºld√©s";
      userInput.focus();
    }
  }

  function speak(text){
    try{
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "hu-HU";
      u.rate = 1;
      u.pitch = 1;
      window.speechSynthesis.speak(u);
    }catch(e){}
  }
  function stopSpeech(){ try{ window.speechSynthesis.cancel(); }catch(e){} }

  // Enter = k√ºld√©s, Shift+Enter = √∫j sor
  userInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" && !e.shiftKey){
      e.preventDefault();
      sendMessage();
    }
  });
</script>
</body>
</html>

<!doctype html>
<html lang="hu" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tam√°s Mesters√©ges (AI)</title>
  <style>
    body { margin:0; font-family:sans-serif; background:#0b0f14; color:#e8eef6; }
    .wrap{max-width:1000px; margin:0 auto; padding:18px;}
    .card{background:rgba(0,0,0,.45); border-radius:22px; padding:16px;}
    .chatlog{height:70vh; overflow:auto; padding:10px;}
    .row{margin:8px 0;}
    .bot .bubble{background:#243447; color:#fff;}
    .user .bubble{background:#ffb84d; color:#000;}
    .info .bubble{background:#1b2838; color:#9fb0c3;}
    .bubble{display:inline-block; padding:10px 14px; border-radius:16px;}
    .composer{display:flex; gap:8px; margin-top:10px;}
    .input{flex:1; display:flex; align-items:center; gap:6px; background:#0f1620cc; padding:6px 10px; border-radius:14px;}
    .input input{flex:1; background:transparent; border:0; color:#e8eef6; font-size:15px; outline:none;}
    .speak-toggle{cursor:pointer; border:0; background:none; font-size:18px;}
    .send{padding:8px 16px; border-radius:14px; border:0; background:#ffb84d; color:#331d00; font-weight:700; cursor:pointer;}
    .muted{color:#9fb0c3; font-size:12px; margin-top:6px; text-align:center;}
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <div id="log" class="chatlog"></div>
      <div class="composer">
        <div class="input">
          <input id="txt" autocomplete="off" placeholder="√çrj ide‚Ä¶ Enter = k√ºld√©s" />
          <input type="file" id="imgUpload" accept="image/*" style="display:none" />
          <button id="imgBtn" class="speak-toggle" title="K√©p felt√∂lt√©s">üì∑</button>
        </div>
        <button class="send" id="sendBtn">K√ºld√©s</button>
      </div>
      <div class="muted">¬© Tam√°s AI ‚Äî v√©dett oldal. B√°rmilyen m√°sol√°s jogs√©rt√©snek min≈ës√ºl.</div>
    </section>
  </main>

<script>
const log = document.getElementById('log');
const txt = document.getElementById('txt');
const sendBtn = document.getElementById('sendBtn');
const imgBtn = document.getElementById('imgBtn');
const imgUpload = document.getElementById('imgUpload');
let uploadedImageBase64 = null;

function addRow(kind, text){
  const r=document.createElement('div'); r.className='row '+kind;
  const b=document.createElement('div'); b.className='bubble'; b.textContent=text;
  r.appendChild(b); log.appendChild(r); log.scrollTop=log.scrollHeight;
}

imgBtn.addEventListener('click', ()=> imgUpload.click());
imgUpload.addEventListener('change', ()=>{
  const file=imgUpload.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    uploadedImageBase64=reader.result;
    addRow('info',"üì∑ K√©p felt√∂ltve: "+file.name);
  };
  reader.readAsDataURL(file);
});

async function ask(){
  const text=(txt.value||'').trim();
  if(!text && !uploadedImageBase64) return;
  if(text) addRow('user',text);
  txt.value='';
  try{
    const r=await fetch('/.netlify/functions/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ message:text, image:uploadedImageBase64 })
    });
    const data=await r.json();
    addRow('bot',data.reply||'...');
  }catch(e){
    addRow('bot','Hiba: '+e.message);
  }
  uploadedImageBase64=null;
}
sendBtn.addEventListener('click',ask);
txt.addEventListener('keydown',e=>{
  if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); ask(); }
});
</script>
</body>
</html>

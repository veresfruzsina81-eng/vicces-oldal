<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tam√°s Mesters√©ges (AI)</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='46' fill='%23ffb22c'/><text x='50' y='60' text-anchor='middle' font-size='60' font-family='Verdana' fill='%231b1f24'>AI</text></svg>">

  <style>
    :root{
      --bg-url: url('bg_tamas.jpg');         /* ‚Üê a te k√©ped */
      --glass: rgba(15,18,22,.55);
      --glass-strong: rgba(15,18,22,.7);
      --stroke: rgba(255,255,255,.08);
      --accent: #ffb22c;
      --text: #e9f0f6;
      --hint: #a8b3bd;
      --user: #ffb22c;
      --bot: #203040;
    }

    /* H√°tt√©r ‚Äì te tiszt√°n l√°tszol, de a chat is olvashat√≥ */
    html,body{height:100%; margin:0;}
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background: #0e1116;
      overflow: hidden;
    }
    .bg{
      position: fixed; inset:0;
      background-image: var(--bg-url);
      background-size: cover;
      background-position: center;
      filter: none;                /* nem hom√°lyos√≠tjuk a k√©pet */
      z-index: 0;
    }
    /* finom s√∂t√©t vignetta, hogy a sz√∂veg olvashat√≥ legyen */
    .bg::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(ellipse at center, rgba(0,0,0,.15), rgba(0,0,0,.45) 65%, rgba(0,0,0,.65) 100%);
      pointer-events:none;
    }

    .wrap{
      position:relative; z-index:1;
      height:100%; display:flex; flex-direction:column;
      gap:12px; padding:16px;
      backdrop-filter: saturate(120%);
    }

    /* Fejl√©c */
    .header{
      align-self:center; width:min(1100px,100%);
      padding:14px 18px;
      border-radius:20px;
      background: linear-gradient(180deg, var(--glass), var(--glass-strong));
      border:1px solid var(--stroke);
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
      display:flex; align-items:center; justify-content:space-between;
      gap:16px;
    }
    .brand h1{margin:0; font-size:clamp(20px,3.2vw,34px); line-height:1.1;}
    .brand p{margin:4px 0 0; color:var(--hint); font-size:14px}
    .mode{opacity:.85; user-select:none; font-size:12px}

    /* Chat panel */
    .chat{
      align-self:center; width:min(1100px,100%); flex:1;
      display:flex; flex-direction:column;
      background: linear-gradient(180deg, var(--glass), rgba(15,18,22,.6));
      border:1px solid var(--stroke);
      border-radius:22px;
      box-shadow: 0 18px 60px rgba(0,0,0,.4);
      overflow:hidden;
    }
    .messages{
      padding:18px;
      overflow:auto;
      scroll-behavior:smooth;
      display:flex; flex-direction:column; gap:12px;
    }
    .msg{
      max-width:min(80%, 680px);
      padding:14px 16px;
      border-radius:18px;
      border:1px solid var(--stroke);
      box-shadow: 0 6px 22px rgba(0,0,0,.25);
      word-wrap:break-word; white-space:pre-wrap;
      line-height:1.45;
      backdrop-filter: blur(2px) saturate(120%);
    }
    .msg.bot{
      align-self:flex-start;
      background: rgba(32,48,64,.72);
    }
    .msg.user{
      align-self:flex-end;
      color:#1b1f24;
      background: linear-gradient(180deg, #ffc86a, var(--user));
      border-color: rgba(255,255,255,.25);
    }
    .hint{ color:var(--hint); font-size:12px; margin: 2px 4px 0; }

    /* Input sor */
    .composer{
      display:flex; align-items:center; gap:10px;
      padding:12px; background: rgba(15,18,22,.5); border-top:1px solid var(--stroke);
    }
    .input{
      flex:1; display:flex; align-items:center; gap:10px;
      background: rgba(255,255,255,.06); border:1px solid var(--stroke);
      border-radius:16px; padding:10px 12px;
    }
    #text{
      flex:1; background: transparent; border:0; outline:0;
      color:var(--text); font-size:15px;
    }
    .btn{
      border:0; cursor:pointer; border-radius:14px;
      padding:10px 16px; font-weight:600;
      background: linear-gradient(180deg,#ffd07b, var(--accent));
      color:#1b1f24; box-shadow:0 8px 26px rgba(0,0,0,.35);
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }

    /* Hang ikon ‚Äì k√ºl√∂n, hogy ne takarja a k√ºld√©st */
    .tts-toggle{
      width:42px; height:42px; min-width:42px;
      display:grid; place-items:center;
      border-radius:50%;
      background: rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      box-shadow: 0 8px 26px rgba(0,0,0,.35);
      cursor:pointer;
    }
    .tts-toggle.active{ outline:2px solid var(--accent); }

    /* L√°bl√©c */
    .footer{
      align-self:center; width:min(1100px,100%);
      color:var(--hint); font-size:12px; text-align:center;
      text-wrap:balance;
      background: linear-gradient(180deg, var(--glass), var(--glass-strong));
      border:1px solid var(--stroke);
      border-radius:16px; padding:10px 12px;
    }

    /* Mobil finom√≠t√°s */
    @media (max-width: 640px){
      .messages{ padding:14px; }
      .msg{ max-width: 88%; }
    }
  </style>
</head>
<body>
  <div class="bg"></div>

  <div class="wrap">
    <header class="header">
      <div class="brand">
        <h1>Tam√°s Mesters√©ges (AI)</h1>
        <p>Halad√≥ fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens</p>
      </div>
      <div class="mode">Light / Dark (auto)</div>
    </header>

    <main class="chat" role="main" aria-label="Besz√©lget√©s">
      <div id="messages" class="messages" aria-live="polite" aria-atomic="false"></div>

      <div class="composer">
        <div class="input">
          <input id="text" type="text" placeholder="√çrj ide‚Ä¶   Enter = k√ºld√©s" autocomplete="off" />
        </div>
        <button id="ttsBtn" class="tts-toggle" title="Felolvas√°s ki/be" aria-pressed="false">üîä</button>
        <button id="sendBtn" class="btn">K√ºld√©s</button>
      </div>
      <div class="hint" style="padding:0 14px 12px;">Tipp: k√©rdezhetsz b√°rmit. A felolvas√°st a kis üîä ikonr√≥l ki- √©s bekapcsolhatod.</div>
    </main>

    <footer class="footer">
      ¬© Tam√°s AI ‚Äî v√©dett oldal. B√°rmilyen m√°sol√°s jogs√©rt√©snek min≈ës√ºl.
    </footer>
  </div>

  <script>
    // ============ Seg√©d ============
    const $ = sel => document.querySelector(sel);
    const messagesEl = $("#messages");
    const textEl = $("#text");
    const sendBtn = $("#sendBtn");
    const ttsBtn = $("#ttsBtn");
    let ttsOn = false;
    let speaking = false;
    const scrollToBottom = () => { messagesEl.scrollTop = messagesEl.scrollHeight + 1000; };

    function addMsg(text, who){
      const div = document.createElement('div');
      div.className = 'msg ' + (who || 'bot');
      div.textContent = text;
      messagesEl.appendChild(div);
      scrollToBottom();
      return div;
    }

    function speak(huText){
      if(!ttsOn) return;
      try{
        const u = new SpeechSynthesisUtterance(huText);
        u.lang = 'hu-HU';
        speaking = true;
        u.onend = ()=> speaking = false;
        speechSynthesis.cancel();
        speechSynthesis.speak(u);
      }catch(e){}
    }

    // ============ Kezd≈ë √ºzenet ============
    addMsg("Szia! Itt vagyok neked, seg√≠tek mindenben. √çrj b√°tran! üòä","bot");

    // ============ K√ºld√©s ============
    async function send(){
      const text = (textEl.value || "").trim();
      if(!text) return;
      addMsg(text,"user");
      textEl.value = "";
      textEl.focus();

      // opcion√°lis kis ‚Äúsend‚Äù hang (nagyon finom)
      try{
        const ctx = new (window.AudioContext||window.webkitAudioContext)();
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.type='sine'; o.frequency.value=880; g.gain.setValueAtTime(0.06, ctx.currentTime);
        o.connect(g).connect(ctx.destination);
        o.start(); o.stop(ctx.currentTime + 0.08);
      }catch(e){}

      const info = addMsg("‚Ä¶","bot"); // ideiglenes ‚Äúgondolkodom‚Äù
      try{
        const r = await fetch("/.netlify/functions/chat", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ message: text })
        });
        if(!r.ok) throw new Error("HTTP "+r.status);
        const data = await r.json();
        const reply = String(data.reply || data.text || "√ârtem. Miben seg√≠thetek m√©g?");
        info.textContent = reply;
        speak(reply);
      }catch(e){
        info.textContent = "Hiba: " + e.message;
      }
      scrollToBottom();
    }

    // ============ Esem√©nyek ============
    sendBtn.addEventListener("click", send);
    textEl.addEventListener("keydown", e=>{
      if(e.key === "Enter" && !e.shiftKey){ e.preventDefault(); send(); }
    });

    ttsBtn.addEventListener("click", ()=>{
      ttsOn = !ttsOn;
      ttsBtn.classList.toggle("active", ttsOn);
      ttsBtn.setAttribute("aria-pressed", ttsOn ? "true" : "false");
      if(!ttsOn) try{ speechSynthesis.cancel(); }catch(e){}
    });

    // iOS/Android billenty≈±zet ugr√°l√°s fix ‚Äì smooth marad
    window.addEventListener('resize', scrollToBottom);
  </script>
</body>
</html>

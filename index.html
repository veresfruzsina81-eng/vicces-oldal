<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tam√°s Mesters√©ges (AI)</title>
  <link rel="icon" href="data:," />
  <style>
    :root{
      --bg: #0f1115;
      --card: #171a21cc;
      --card-strong:#1c2130;
      --text: #e7ebf3;
      --muted:#9aa6bf;
      --accent:#ffb74a;
      --bubble-user:#f8a94a;
      --bubble-bot:#2b3446;
      --ring:#36435c99;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font: 16px/1.4 "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: var(--bg);
      overflow:hidden;
    }

    /* h√°tt√©rk√©p ‚Äì halv√°ny + blur */
    .bg{
      position:fixed; inset:0;
      background: center/cover no-repeat url("bg_tamas.jpg");
      filter: blur(6px) brightness(.35);
      transform: scale(1.06);
      z-index:0;
    }

    .page{
      position:relative; z-index:1;
      display:flex; flex-direction:column;
      height:100%;
      padding: clamp(12px, 2vw, 18px);
      gap:12px;
    }

    /* fejl√©c */
    .header{
      background: linear-gradient(180deg, #1c2230cc, #171a21cc);
      border:1px solid #2a3247;
      border-radius: var(--radius);
      padding: 14px 16px;
      box-shadow: var(--shadow);
    }
    .title{
      font-size: clamp(18px, 2.3vw, 26px);
      font-weight: 800;
      letter-spacing:.2px;
    }
    .subtitle{
      margin-top:4px;
      color: var(--muted);
      font-size: .95rem;
    }

    /* chat k√°rtya */
    .chat{
      display:flex; flex-direction:column;
      background: var(--card);
      border:1px solid #27324b;
      border-radius: calc(var(--radius) + 6px);
      box-shadow: var(--shadow);
      min-height: 0; /* fontos a scroll miatt */
      height: 100%;
    }

    /* g√∂rgethet≈ë √ºzen≈ëfal */
    .log{
      overflow:auto;
      padding: 18px;
      gap: 14px;
      display:flex; flex-direction:column;
      scroll-behavior:smooth;
    }
    .msg{
      max-width: 780px;
      width: fit-content;
      border-radius: 18px;
      padding: 12px 14px;
      border:1px solid #2a344d;
      box-shadow: 0 6px 16px rgba(0,0,0,.18);
      backdrop-filter: saturate(110%);
      position:relative;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .msg.bot{
      background: var(--bubble-bot);
      color: var(--text);
    }
    .msg.user{
      background: var(--bubble-user);
      color: #2a1906;
      margin-left:auto;
      border-color: #ed9a39;
    }
    .row{ display:flex; align-items:center; gap:10px; }

    /* kis felolvas√≥ ikon a bot alatt */
    .tts{
      display:inline-flex;
      align-items:center; gap:6px;
      font-size:.85rem; color: var(--muted);
      cursor:pointer; user-select:none;
      margin-top:6px;
      opacity:.85;
    }
    .tts:hover{ opacity:1 }
    .tts .dot{
      width:10px; height:10px; border-radius:50%;
      border:1px solid #8aa2d0; box-shadow: 0 0 8px #8aa2d066 inset;
      display:inline-block; position:relative;
    }
    .tts.playing .dot{
      background:#8aa2d0;
      box-shadow: 0 0 0 3px #8aa2d02e;
    }

    /* input s√°v */
    .composer{
      padding: 12px;
      border-top:1px solid #27324b;
      background: linear-gradient(180deg, #171a21ee, #141820ee);
      border-radius: 0 0 calc(var(--radius)+6px) calc(var(--radius)+6px);
    }
    .bar{
      display:flex; gap:10px; align-items:center;
      background:#11151b; border:1px solid #26324a;
      border-radius: 999px; padding: 8px 10px;
      box-shadow: inset 0 0 0 2px transparent, var(--shadow);
    }
    textarea{
      flex:1; min-height:44px; max-height:140px; resize: vertical;
      border:none; outline:none; color:var(--text);
      background:transparent; font:inherit;
      padding: 8px 10px;
    }
    .hint{ color:var(--muted); font-size:.9rem; margin-left:10px }

    .btn{
      border:none; cursor:pointer;
      background: linear-gradient(180deg,#ffbd63,#ff9b35);
      color:#2a1b07; font-weight:700;
      padding: 10px 16px; border-radius: 999px;
      box-shadow: 0 6px 18px rgba(255,155,53,.28);
    }
    .btn:active{ transform: translateY(1px) }

    /* l√°bl√©c */
    .footer{
      color:var(--muted);
      font-size:.85rem; text-align:center;
      padding-top:6px;
    }

    /* mobil finomhangol√°s */
    @media (max-width: 680px){
      .log{ padding:14px }
      .msg{ max-width: 100% }
      .subtitle{ font-size: .9rem }
      .hint{ display:none }
    }

    /* finom scroll s√°v */
    .log::-webkit-scrollbar{width:10px}
    .log::-webkit-scrollbar-thumb{
      background: #2b354b; border-radius: 8px;
      border:2px solid #161b24;
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>

  <div class="page">
    <header class="header">
      <div class="title">Tam√°s Mesters√©ges (AI)</div>
      <div class="subtitle">Hobbi fejleszt√©s ‚Äî bar√°ts√°gos magyar asszisztens</div>
    </header>

    <main class="chat">
      <section id="log" class="log" aria-live="polite" aria-label="Besz√©lget√©s"></section>

      <div class="composer">
        <div class="bar">
          <textarea id="input" placeholder="√çrj ide‚Ä¶  Enter = k√ºld√©s, Shift+Enter = √∫j sor"></textarea>
          <button id="send" class="btn">K√ºld√©s</button>
        </div>
        <div class="hint">Tipp: k√©rdezhetsz b√°rmit. A v√°laszok alatt kis üîä ikonr√≥l fel is olvastathatod.</div>
      </div>
    </main>

    <footer class="footer">¬© Tam√°s AI ‚Äî v√©dett oldal. B√°rmilyen m√°sol√°s jogs√©rt√©snek min≈ës√ºl.</footer>
  </div>

  <script>
    // --- √°llapot
    const $log = document.getElementById('log');
    const $inp = document.getElementById('input');
    const $send = document.getElementById('send');

    let speakingUtter = null;

    // --- seg√©dek
    const scrollToEnd = () => { $log.scrollTop = $log.scrollHeight; };

    function addMsg(text, who){
      const wrap = document.createElement('div');
      wrap.className = 'msg ' + (who === 'user' ? 'user' : 'bot');

      const p = document.createElement('div');
      p.textContent = text;
      wrap.appendChild(p);

      // ha bot v√°lasz: kis felolvas√≥ ikon
      if(who !== 'user'){
        const tts = document.createElement('div');
        tts.className = 'tts';
        tts.innerHTML = `<span class="dot"></span> Felolvas√°s`;
        tts.title = 'Felolvas√°s / Le√°ll√≠t√°s';
        tts.addEventListener('click', () => speakText(tts, text));
        wrap.appendChild(tts);
      }

      $log.appendChild(wrap);
      scrollToEnd();
      return wrap;
    }

    // --- felolvas√°s (TTS) magyarul
    function speakText(ttsEl, text){
      // ha √©pp besz√©l√ºnk: √°llj meg
      if(speakingUtter){
        speechSynthesis.cancel();
        speakingUtter = null;
        if(ttsEl) ttsEl.classList.remove('playing');
        return;
      }
      const u = new SpeechSynthesisUtterance(text);
      // magyar hang keres√©se
      const chooseVoice = () => {
        const voices = speechSynthesis.getVoices();
        const hu = voices.find(v => /hu-|Hungarian/i.test(v.lang));
        if(hu) u.voice = hu;
      };
      chooseVoice();
      if(!u.voice){
        // iOS/Chrome els≈ë h√≠v√°skor k√©s≈ëbb t√∂lti be a hangokat
        speechSynthesis.onvoiceschanged = chooseVoice;
      }
      u.lang = 'hu-HU';
      u.rate = 1.02;
      u.pitch = 1.0;
      u.onend = () => { if(ttsEl) ttsEl.classList.remove('playing'); speakingUtter = null; };
      u.onerror = () => { if(ttsEl) ttsEl.classList.remove('playing'); speakingUtter = null; };
      speakingUtter = u;
      if(ttsEl) ttsEl.classList.add('playing');
      speechSynthesis.speak(u);
    }

    // --- fix, helyi v√°laszok (gyorsak)
    function fixedAnswer(q){
      const t = q.toLowerCase().trim();
      if(!t) return null;

      // modell/k√©sz√≠t≈ë k√©rd√©sek
      if(
        t.includes('ki k√©sz√≠tette') || t.includes('ki hozta l√©tre') ||
        t.includes('k√©sz√≠t≈ëje') || t.includes('model') || t.includes('milyen modell')
      ){
        return "√ân Tam√°s modellje vagyok. Horv√°th Tam√°s k√©sz√≠tett √©s fejlesztett, hogy bar√°ts√°gosan seg√≠tsek neked magyarul. üôÇ";
      }

      // ‚Äûmes√©lj Tam√°sr√≥l‚Äù
      if(t.includes('mes√©lj') && t.includes('tam√°s')){
        return "Tam√°s egy lelkes hobbifejleszt≈ë, aki webes projektekkel k√≠s√©rletezik √©s folyamatosan tanul. Ez az oldal is egy ilyen j√°t√©kos projekt. üöÄ";
      }

      return null;
    }

    // --- k√ºld√©s logika
    async function sendNow(){
      const text = $inp.value.trim();
      if(!text) return;

      addMsg(text, 'user');
      $inp.value = '';
      $inp.focus();

      // helyi v√°lasz?
      const fx = fixedAnswer(text);
      if(fx){ addMsg(fx, 'bot'); return; }

      // h√°l√≥zati jelz√©s
      const info = addMsg('‚Ä¶', 'bot');

      try{
        const r = await fetch('/.netlify/functions/chat', {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ message: text })
        });
        if(!r.ok) throw new Error('HTTP ' + r.status);
        const data = await r.json();
        info.remove();
        addMsg(String(data.reply || data || 'Rendben. Miben seg√≠thetek m√©g?'), 'bot');
      }catch(e){
        info.remove();
        addMsg('Hiba: ' + (e.message || e), 'bot');
      }
    }

    // --- esem√©nyek
    $send.addEventListener('click', sendNow);
    $inp.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendNow(); }
    });

    // --- nyit√≥ √ºzenet (k√©r√©sed szerint)
    addMsg("Szia! Itt vagyok neked, seg√≠tek mindenben. √çrj b√°tran! üôÇ", 'bot');
  </script>
</body>
</html>

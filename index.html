<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>B√ºntet≈ër√∫g√°s ‚Äì fejlettebb kapussal</title>
<style>
  :root { --bg:#0b1020; --panel:#0f1629; --text:#e5e7eb; --muted:#94a3b8; --line:#1f2937; }
  * { box-sizing: border-box }
  body { margin:0; background: radial-gradient(1200px 700px at 50% -200px, #0e1430, #0a0f23 60%, #070d1c); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial; display:grid; place-items:center; min-height:100vh }
  .wrap { width:min(1100px,96vw) }
  header{display:flex;justify-content:space-between;align-items:center;margin:14px 0}
  .title{font-weight:800;letter-spacing:.3px}
  .panel{background:linear-gradient(180deg,#121a31,#0e162b);border:1px solid var(--line);padding:12px;border-radius:14px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  label{font-size:13px;color:var(--muted)}
  select,button{appearance:none;border:1px solid #223046;background:#0b1326;color:var(--text);padding:10px 12px;border-radius:12px;font-weight:700}
  select{min-width:180px}
  button{cursor:pointer;transition:transform .05s, filter .2s}
  button:hover{filter:brightness(1.08)}
  button:active{transform:translateY(1px)}
  .primary{background:linear-gradient(180deg,#1f9b58,#14834c);border-color:#1f9b58;box-shadow:0 8px 20px rgba(34,197,94,.25)}
  canvas{width:100%;height:auto;display:block;background:#164b2f;border-radius:16px;border:1px solid #23523a}
  .hud{display:flex;justify-content:space-between;align-items:center;margin-top:10px;gap:10px}
  .hint{font-size:13px;color:var(--muted)}
  .stats{font-weight:800}
  .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#0b1224;border:1px solid #1e293b;padding:10px 14px;border-radius:12px;font-weight:700;color:#cbd5e1;box-shadow:0 10px 30px rgba(0,0,0,.35);opacity:.96}
  .hidden{display:none}
  .badge{padding:4px 8px;border:1px solid #334155;border-radius:999px;color:#cbd5e1;background:#0b1224;font-size:12px}
  .result{display:flex;gap:10px;align-items:center;font-weight:900}
  .you{color:#86efac}.opp{color:#fca5a5}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">‚öΩ B√ºntet≈ër√∫g√°s ‚Äì fejlettebb kapussal</div>
    <div class="badge">HTML5 Canvas ‚Ä¢ h√∫zd & engedd</div>
  </header>

  <div class="panel" id="menu">
    <div class="row" style="justify-content:space-between">
      <div class="row">
        <div><label for="teamA">Te v√°logatottad</label><br><select id="teamA"></select></div>
        <div><label for="teamB">Ellenf√©l</label><br><select id="teamB"></select></div>
        <div><label for="difficulty">Neh√©zs√©g</label><br>
          <select id="difficulty">
            <option value="easy">Kezd≈ë</option>
            <option value="normal" selected>K√∂z√©p</option>
            <option value="hard">Halad√≥</option>
          </select>
        </div>
      </div>
      <button id="startBtn" class="primary">‚ñ∂Ô∏è Meccs ind√≠t√°sa</button>
    </div>
    <div class="hint" style="margin-top:8px">Fogd meg a labd√°t, h√∫zd h√°tra/oldalra, majd engedd el. Oldalir√°ny = kis g√∂rb√ºlet. Mobilon: √©rint√©s √©s elenged√©s.</div>
  </div>

  <canvas id="game" width="1100" height="650"></canvas>

  <div class="hud">
    <div class="stats" id="scoreBox">Hungary 0 ‚Äì 0 Opponent | L√∂v√©s: 1 / 5</div>
    <div class="result hidden" id="finalBox">
      <span class="you">Te:</span><span id="youScore">0</span>
      <span>‚Äì</span>
      <span class="opp">Ellenf√©l:</span><span id="oppScore">0</span>
      <button id="restartBtn">üîÑ √öj meccs</button>
    </div>
    <div class="hint" id="hintBox">Fogd meg a labd√°t, h√∫zd h√°tra, engedd el. R: Reset l√∂v√©s</div>
  </div>
</div>

<div id="toast" class="toast hidden">G√ì√ì√ìL! üéâ</div>

<script>
(() => {
  // --- Csapatok ---
  const COUNTRIES = [
    { name:"Hungary", kit:"#e11d48", alt:"#16a34a" },
    { name:"England", kit:"#f59e0b", alt:"#1d4ed8" },
    { name:"Germany", kit:"#111827", alt:"#e5e7eb" },
    { name:"France", kit:"#1d4ed8", alt:"#e11d48" },
    { name:"Spain", kit:"#ef4444", alt:"#f59e0b" },
    { name:"Italy", kit:"#2563eb", alt:"#22c55e" },
    { name:"Portugal", kit:"#991b1b", alt:"#22c55e" },
    { name:"Netherlands", kit:"#ea580c", alt:"#111827" },
    { name:"Brazil", kit:"#22c55e", alt:"#eab308" },
    { name:"Argentina", kit:"#60a5fa", alt:"#e5e7eb" },
    { name:"Croatia", kit:"#ef4444", alt:"#e5e7eb" },
    { name:"Belgium", kit:"#111827", alt:"#f59e0b" }
  ];

  // --- DOM ---
  const teamASelect = document.getElementById('teamA');
  const teamBSelect = document.getElementById('teamB');
  const diffSelect  = document.getElementById('difficulty');
  const startBtn    = document.getElementById('startBtn');
  const restartBtn  = document.getElementById('restartBtn');
  const menu        = document.getElementById('menu');
  const scoreBox    = document.getElementById('scoreBox');
  const hintBox     = document.getElementById('hintBox');
  const finalBox    = document.getElementById('finalBox');
  const youScoreEl  = document.getElementById('youScore');
  const oppScoreEl  = document.getElementById('oppScore');
  const toast       = document.getElementById('toast');

  function fillTeams(){
    teamASelect.innerHTML=''; teamBSelect.innerHTML='';
    for (const c of COUNTRIES){
      const a=document.createElement('option'); a.value=a.textContent=c.name;
      const b=document.createElement('option'); b.value=b.textContent=c.name;
      teamASelect.appendChild(a); teamBSelect.appendChild(b);
    }
    teamASelect.value="Hungary"; teamBSelect.value="Germany";
  }
  fillTeams();

  // --- Canvas ---
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  // P√°lya/kapu
  const GOAL = { x1: 300, x2: 800, y: 130, postW: 8, postH: 80 };
  const SPOT = { x: W/2, y: H-140 };

  // √Ållapotok
  let teamA = COUNTRIES[0], teamB = COUNTRIES[2];
  let state = 'menu'; // aim | flying | dead | gameover
  let shots=0, maxShots=5, goals=0, oppGoals=0;

  // Labda + cs√≥va
  const ball = { x: SPOT.x, y: SPOT.y, r: 12, vx:0, vy:0, spin:0, dragging:false, trail:[] };

  // Kapus figura (fej, test, karok) + AI
  const keeper = {
    y: GOAL.y + 12,
    speed: 1.2, react: 0.45,
    t: 0, // f√°zis az oldalaz√°shoz
    xBias: 0,
    pose: 'idle', // idle | diveL | diveR | parry
    poseTime: 0,
    width: 70, height: 24,
    saveBox(){ // akt√≠v √ºtk√∂z√©si keret (a kezek fel√© nagyobb)
      const kx = keeperX();
      return { x: kx-38, y: this.y-4, w: 76, h: 28 };
    }
  };

  // Neh√©zs√©g
  function setDifficulty(){
    const d = diffSelect.value;
    if (d==='easy'){ keeper.speed=0.85; keeper.react=0.25 }
    if (d==='normal'){ keeper.speed=1.2; keeper.react=0.45 }
    if (d==='hard'){ keeper.speed=1.6; keeper.react=0.7 }
  }

  // UI
  startBtn.addEventListener('click',()=>{
    teamA = COUNTRIES.find(c=>c.name===teamASelect.value)||COUNTRIES[0];
    teamB = COUNTRIES.find(c=>c.name===teamBSelect.value)||COUNTRIES[1];
    setDifficulty(); resetMatch(); menu.classList.add('hidden'); state='aim';
  });
  restartBtn?.addEventListener('click',()=>{ resetMatch(); finalBox.classList.add('hidden'); scoreBox.classList.remove('hidden'); state='aim'; });

  function resetMatch(){ shots=0; goals=0; oppGoals=0; resetBall(true); updateHUD(); netKick=0; }
  function resetBall(){ ball.x=SPOT.x; ball.y=SPOT.y; ball.vx=ball.vy=0; ball.spin=0; ball.dragging=false; ball.trail.length=0; }
  function updateHUD(){ scoreBox.textContent=`${teamA.name} ${goals} ‚Äì ${oppGoals} ${teamB.name} | L√∂v√©s: ${Math.min(shots+1,maxShots)} / ${maxShots}`; youScoreEl.textContent=goals; oppScoreEl.textContent=oppGoals; }
  function showToast(txt,ms=1200){ toast.textContent=txt; toast.classList.remove('hidden'); clearTimeout(showToast._t); showToast._t=setTimeout(()=>toast.classList.add('hidden'),ms); }

  // Egyszer≈± ‚Äûhangok‚Äù WebAudio-val (kicsik, nem blokkol√≥ak)
  const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  function beep(freq=440, dur=0.08, type='square', gain=0.03){
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type=type; o.frequency.value=freq; g.gain.value=gain;
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime+dur);
  }

  // --- Rajz: p√°lya, h√°l√≥ ‚Äûrezg√©s‚Äù ---
  let netKick = 0; // g√≥l ut√°n p√°r k√©pkock√°ig remeg a h√°l√≥
  function drawField(){
    // f≈± cs√≠kok
    for(let i=0;i<12;i++){ ctx.fillStyle = i%2? "#1c5a34":"#185532"; ctx.fillRect(0, H-i*60-60, W, 60); }
    // 16-os
    ctx.strokeStyle="#e5e7eb"; ctx.lineWidth=2;
    roundedRect(GOAL.x1-140, GOAL.y, (GOAL.x2-GOAL.x1)+280, 260, 40); ctx.stroke();
    // kapu fels≈ë √©s oldals√≥k
    ctx.fillStyle="#ffffff";
    ctx.fillRect(GOAL.x1-GOAL.postW/2, GOAL.y, GOAL.postW, GOAL.postH);
    ctx.fillRect(GOAL.x2-GOAL.postW/2, GOAL.y, GOAL.postW, GOAL.postH);
    ctx.fillRect(GOAL.x1, GOAL.y-4, GOAL.x2-GOAL.x1, 6);
    // h√°l√≥ (v√©kony v√≠zszintes cs√≠kok, g√≥ln√°l enyh√©n hull√°mzik)
    ctx.save(); ctx.globalAlpha=0.10; ctx.fillStyle="#ffffff";
    const wiggle = Math.max(0, netKick); netKick = Math.max(0, netKick-0.08);
    for (let i=0;i<9;i++){
      const y = GOAL.y + i*7 + Math.sin((i+performance.now()/120)*(0.15+wiggle*0.02))* (wiggle*1.2);
      ctx.fillRect(GOAL.x1, y, GOAL.x2-GOAL.x1, 2);
    }
    ctx.restore();
    // tizenegyes pont
    ctx.fillStyle="#fff"; ctx.beginPath(); ctx.arc(SPOT.x, SPOT.y, 3, 0, Math.PI*2); ctx.fill();
    // Mezek √©s nevek
    drawShirt(70, 28, teamA.kit); drawShirt(W-70, 28, teamB.kit);
    ctx.fillStyle="#cbd5e1"; ctx.font="700 14px system-ui"; ctx.textAlign="left";
    ctx.fillText(teamA.name, 90, 34); ctx.textAlign="right"; ctx.fillText(teamB.name, W-90, 34);
  }
  function roundedRect(x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
  function drawShirt(x,y,c){ ctx.save(); ctx.translate(x,y); ctx.fillStyle=c; ctx.strokeStyle="#0b1224"; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(-16,6); ctx.lineTo(-22,-6); ctx.lineTo(-8,-12); ctx.lineTo(0,-4); ctx.lineTo(8,-12); ctx.lineTo(22,-6);
    ctx.lineTo(16,6); ctx.lineTo(16,18); ctx.lineTo(-16,18); ctx.closePath(); ctx.fill(); ctx.stroke(); ctx.restore(); }

  // --- Kapus rajz: fej-test-karok, vet≈ëd√©s anim ---
  function keeperX(){
    const amp = (GOAL.x2-GOAL.x1-keeper.width)/2;
    const cx = (GOAL.x1+GOAL.x2)/2;
    let x = cx + amp * Math.sin(keeper.t) + keeper.xBias;
    return x;
  }

  function drawKeeper(){
    const x = keeperX(); const y = keeper.y;
    const t = Math.min(1, keeper.poseTime/0.35);
    ctx.save();
    // Vet≈ëd√©sn√©l az eg√©sz test picit d≈ël
    let rot = 0;
    if (keeper.pose==='diveL') rot = -0.65*t;
    if (keeper.pose==='diveR') rot =  0.65*t;
    if (keeper.pose==='parry') rot = (Math.sin(performance.now()/90)*0.08);
    ctx.translate(x, y+12);
    ctx.rotate(rot);

    // test
    ctx.fillStyle="#1e293b"; roundRectFill(-18, -12, 36, 36, 8);
    // fej
    ctx.fillStyle="#fcd34d"; ctx.beginPath(); ctx.arc(0, -18, 10, 0, Math.PI*2); ctx.fill();
    // karok (vet≈ëd√©skor kiny√∫lnak)
    ctx.fillStyle="#93c5fd";
    const armLen = 22 + 16*t;
    roundRectFill(-18-armLen, -6, armLen, 10, 5); // bal kar
    roundRectFill(18, -6, armLen, 10, 5); // jobb kar
    // keszty≈±k
    ctx.fillStyle="#bfdbfe"; roundRectFill(-18-armLen-6, -8, 8, 14, 4);
    ctx.fillStyle="#bfdbfe"; roundRectFill(18+armLen-2, -8, 8, 14, 4);

    ctx.restore();

    // debug hitboxhoz:
    // const r=keeper.saveBox(); ctx.strokeStyle="#fff"; ctx.strokeRect(r.x,r.y,r.w,r.h);
  }
  function roundRectFill(x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); ctx.fill(); }

  // --- Labda + cs√≥va ---
  function drawBall(){
    // cs√≥va
    ctx.save(); ctx.globalAlpha=0.25;
    for (let i=0;i<ball.trail.length;i++){
      const p = ball.trail[i]; const s = 1 - i/ball.trail.length;
      ctx.beginPath(); ctx.fillStyle="#ffffff";
      ctx.arc(p.x, p.y, ball.r*s*0.9, 0, Math.PI*2); ctx.fill();
    }
    ctx.restore();

    ctx.fillStyle="#ffffff"; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
    ctx.strokeStyle="#0f172a"; ctx.lineWidth=2; ctx.stroke();
  }

  // --- √útk√∂z√©sek ---
  function collideBallRect(b, r){
    const cx = Math.max(r.x, Math.min(b.x, r.x+r.w));
    const cy = Math.max(r.y, Math.min(b.y, r.y+r.h));
    const dx = b.x-cx, dy=b.y-cy;
    return (dx*dx + dy*dy) <= b.r*b.r;
  }

  // --- Ellenf√©l ‚Äûstat‚Äù l√∂v√©s ---
  function simulateOpponent(){
    let p = 0.52; if (diffSelect.value==='easy') p=0.36; if (diffSelect.value==='hard') p=0.68;
    if (Math.random()<p) oppGoals++;
  }

  // --- J√°t√©kciklus ---
  let last=0;
  function loop(ts){
    const dt = (ts-last)/1000 || 0.016; last=ts;
    update(dt); draw();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  function update(dt){
    if (state==='menu') return;

    // kapus oldalaz
    keeper.t += dt*keeper.speed;
    if (keeper.pose!=='idle') keeper.poseTime += dt; else keeper.poseTime = Math.max(0, keeper.poseTime - dt*0.5);

    if (state==='flying'){
      // g√∂rb√ºlet (finomabb)
      ball.vx += ball.spin * Math.abs(ball.vy) * 0.0011;
      // s√∫rl√≥d√°s
      ball.vx *= 0.999; ball.vy *= 0.9992;
      // poz friss√≠t√©s
      ball.x += ball.vx*dt; ball.y += ball.vy*dt;

      // cs√≥va friss√≠t√©s
      ball.trail.unshift({x:ball.x, y:ball.y}); if (ball.trail.length>16) ball.trail.pop();

      // kapufa
      const leftPost={x:GOAL.x1-4,y:GOAL.y,w:8,h:GOAL.postH};
      const rightPost={x:GOAL.x2-4,y:GOAL.y,w:8,h:GOAL.postH};
      if (collideBallRect(ball,leftPost)||collideBallRect(ball,rightPost)){
        ball.vx*=-0.6; ball.vy*=0.7; beep(220,0.06,'sawtooth',0.04);
        showToast("Kapufa! üòµ",700);
      }

      // kapus ment√©s (nagyobb ‚Äûkez≈±‚Äù hitbox)
      const kr = keeper.saveBox();
      if (collideBallRect(ball, kr)){
        // Par√°d√©: oldalra fel√ºt√©s kis v√©letlennel
        const side = (ball.x < (kr.x+kr.w/2)) ? -1 : 1;
        ball.vx = (120 + Math.random()*140) * side;
        ball.vy = Math.abs(ball.vy)*0.3 + 120;
        ball.spin *= -0.5;
        keeper.pose = side<0 ? 'diveL' : 'diveR';
        keeper.poseTime = 0;
        beep(330,0.08,'square',0.05);
        showToast("V√©d√©s! üß§",800);
        state='dead'; postShot(false);
      }

      // g√≥lvonal (kapuf√°k k√∂z√∂tt)
      if (ball.y <= GOAL.y && ball.x > GOAL.x1 && ball.x < GOAL.x2){
        goals++; state='dead';
        netKick = 4; // h√°l√≥ ‚Äûrezg√©s‚Äù
        beep(660,0.07,'triangle',0.05); setTimeout(()=>beep(880,0.09,'triangle',0.05),60);
        showToast("G√ì√ì√ìL! üéâ",1000);
        postShot(true);
      }

      // kifut / meg√°ll
      if (ball.y < -60 || ball.y > H+80 || (Math.abs(ball.vx)+Math.abs(ball.vy) < 8)){
        state='dead';
        if (!(ball.y <= GOAL.y && ball.x > GOAL.x1 && ball.x < GOAL.x2)){
          showToast("Mell√©... üò¨",800);
          postShot(false);
        }
      }
    }
  }

  function postShot(scored){
    shots++; updateHUD();
    simulateOpponent();
    setTimeout(()=>{
      if (shots>=maxShots) endMatch();
      else { resetBall(); state='aim'; keeper.pose='idle'; keeper.poseTime=0; keeper.xBias=0; }
    }, 650);
  }

  function endMatch(){
    state='gameover';
    scoreBox.classList.add('hidden');
    finalBox.classList.remove('hidden');
    youScoreEl.textContent=goals; oppScoreEl.textContent=oppGoals;
    if (goals>oppGoals){ showToast("Gy≈ëzelem! üèÜ",2000); beep(740,0.1,'triangle',0.06); setTimeout(()=>beep(880,0.12,'triangle',0.06),120) }
    else if (goals<oppGoals){ showToast("Veres√©g... üò¢",2000); beep(220,0.15,'sine',0.04) }
    else { showToast("D√∂ntetlen! ü§ù",2000); }
  }

  function draw(){
    drawField();
    drawKeeper();

    if (ball.dragging){
      // c√©lvonal + er≈ë cs√≠k
      ctx.strokeStyle="#fde68a"; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(ball.x, ball.y); ctx.lineTo(mouse.x, mouse.y); ctx.stroke();
      const dx=ball.x-mouse.x, dy=ball.y-mouse.y; const p=Math.min(1, Math.hypot(dx,dy)/200);
      ctx.fillStyle="#fde68a"; ctx.globalAlpha=.9; ctx.fillRect(24, H-36, 220*p, 12); ctx.strokeStyle="#e5e7eb"; ctx.strokeRect(24, H-36, 220, 12); ctx.globalAlpha=1;
    }

    drawBall();

    // als√≥ felirat
    ctx.fillStyle="#cbd5e1"; ctx.font="600 14px system-ui"; ctx.textAlign="center";
    if (state==='aim' && !ball.dragging) ctx.fillText("Fogd meg a labd√°t, h√∫zd h√°tra/oldalra, majd engedd el a l√∂v√©shez!", W/2, H-12);
    else if (state==='flying') ctx.fillText("L√∂v√©s folyamatban...", W/2, H-12);
    else if (state==='gameover') ctx.fillText("V√©ge ‚Äì fent √öj meccs.", W/2, H-12);
  }

  // --- Input (eg√©r + √©rint√©s) ---
  const mouse={x:0,y:0};
  function toLocal(e){
    const r=canvas.getBoundingClientRect(); const sx=W/r.width, sy=H/r.height;
    return { x:(e.clientX-r.left)*sx, y:(e.clientY-r.top)*sy };
  }
  canvas.addEventListener('mousemove',e=>{ const p=toLocal(e); mouse.x=p.x; mouse.y=p.y; });
  canvas.addEventListener('mousedown',()=>{ if (state!=='aim') return; if (dist2(mouse.x,mouse.y,ball.x,ball.y) <= (ball.r+20)*(ball.r+20)) { ball.dragging=true; hintBox.textContent="H√∫zd vissza, engedd el!"; } });
  window.addEventListener('mouseup', shootFromDrag);

  // √ârint√©s
  canvas.addEventListener('touchstart',e=>{ const t=e.touches[0]; const p=toLocal(t); mouse.x=p.x; mouse.y=p.y;
    if (state==='aim' && dist2(mouse.x,mouse.y,ball.x,ball.y) <= (ball.r+24)*(ball.r+24)) ball.dragging=true; }, {passive:true});
  canvas.addEventListener('touchmove',e=>{ const t=e.touches[0]; const p=toLocal(t); mouse.x=p.x; mouse.y=p.y; }, {passive:true});
  canvas.addEventListener('touchend',()=> shootFromDrag());

  function shootFromDrag(){
    if (state!=='aim' || !ball.dragging) return;
    const dx = ball.x - mouse.x, dy = ball.y - mouse.y;
    const scale = 6.8; // pix/s
    ball.vx = dx*scale; ball.vy = dy*scale;
    ball.spin = Math.max(-1, Math.min(1, dx/220));
    ball.dragging=false; state='flying'; hintBox.textContent="L√∂v√©s!";
    // Kapus reakci√≥ (el≈ëre jelzett c√©l)
    const aimX = ball.x + (ball.vx / Math.max(Math.abs(ball.vy), 1)) * (ball.y - GOAL.y);
    const target = clamp(aimX, GOAL.x1+24, GOAL.x2-24);
    const delay = 100 + (1 - keeper.react) * 220;
    setTimeout(()=> {
      const mid=(GOAL.x1+GOAL.x2)/2; const toAim = target - mid;
      keeper.xBias = toAim * 0.15;
      keeper.pose = (toAim<0) ? 'diveL' : 'diveR';
      keeper.poseTime = 0;
    }, delay);
  }

  function dist2(ax,ay,bx,by){ const dx=ax-bx, dy=ay-by; return dx*dx+dy*dy; }
  function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }

})();
</script>
</body>
</html>
